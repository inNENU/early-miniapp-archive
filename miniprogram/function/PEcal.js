"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var wxpage_1 = require("wxpage");
var component_1 = require("../utils/component");
var file_1 = require("../utils/file");
var setpage_1 = require("../utils/setpage");
var a = getApp().globalData;
var special = [
    { text: '引体向上', unit: '个', type: 'number', id: 'chinning' },
    { text: '仰卧起坐', unit: '个', type: 'number', id: 'situp' }
];
var longRunText = ['1000米跑', '800米跑'];
var longRunPicker = [['2分', '3分', '4分', '5分', '6分', '7分'], []];
for (var i = 0; i < 60; i++)
    longRunPicker[1].push(i + "\u79D2");
wxpage_1.default('PEcal', {
    data: {
        T: a.T,
        nm: a.nm,
        page: [{ tag: 'head', title: '体测计算器', grey: true, leftText: '功能大厅' }],
        gender: {
            picker: ['男', '女'],
            value: ['male', 'female']
        },
        grade: {
            picker: ['大一', '大二', '大三', '大四'],
            value: ['Low', 'Low', 'High', 'High']
        },
        list: [
            { text: '身高', unit: '厘米', type: 'number', id: 'height' },
            { text: '体重', unit: '千克', type: 'digit', id: 'weight' },
            { text: '坐位体前屈', unit: '厘米', type: 'digit', id: 'sitAndReach' },
            { text: '肺活量', unit: '毫升', type: 'number', id: 'vitalCapacity' },
            { text: '立定跳远', unit: '米', type: 'digit', id: 'standingLongJump' },
            { text: '50米跑', unit: '秒', type: 'digit', id: 'shortRun' }
        ],
        longRun: { text: '800米跑' },
        special: { text: '仰卧起坐', unit: '个', id: 'situp' },
        PEscore: {},
        result: {},
        scoreList: [
            { text: 'BMI', id: 'BMI' },
            { text: '坐位体前屈', id: 'sitAndReach' },
            { text: '肺活量', id: 'vitalCapacity' },
            { text: '立定跳远', id: 'standingLongJump' },
            { text: '50米跑', id: 'shortRun' }
        ]
    },
    onLoad: function (option) {
        setpage_1.default.Set({ option: option, ctx: this }, this.data.page);
        var genderIndex = wx.getStorageSync('gender');
        var gradeIndex = wx.getStorageSync('grade');
        if (genderIndex || genderIndex === 0)
            this.setData({
                'gender.index': genderIndex,
                'longRun.text': genderIndex === 0 ? longRunText[0] : longRunText[1],
                special: genderIndex === 0 ? special[0] : special[1],
                'result.gender': this.data.gender.value[genderIndex]
            });
        if (gradeIndex || gradeIndex === 0)
            this.setData({
                'grade.index': gradeIndex,
                'result.grade': this.data.grade.value[gradeIndex]
            });
        this.setData({ 'longRun.picker': longRunPicker });
        var _a = setpage_1.default.color(true), nc = _a.nc, bc = _a.bc;
        wx.setNavigationBarColor(nc);
        wx.setBackgroundColor(bc);
        setpage_1.default.Notice('PEcal');
    },
    onPageScroll: function (e) {
        component_1.default.nav(e, this);
    },
    cA: function (e) {
        component_1.default.trigger(e, this);
    },
    genderChange: function (event) {
        var index = Number(event.detail.value);
        var gender = this.data.gender.value[index];
        wx.setStorageSync('gender', index);
        this.setData({
            'result.gender': gender,
            'gender.index': index,
            special: gender === 'male' ? special[0] : special[1],
            'longRun.text': gender === 'male' ? longRunText[0] : longRunText[1]
        });
    },
    gradeChange: function (event) {
        var index = Number(event.detail.value);
        this.setData({
            'grade.index': index,
            'result.grade': this.data.grade.value[index]
        });
        wx.setStorageSync('grade', index);
    },
    focus: function (event) {
        console.log('focus', event);
        var id = event.currentTarget.id;
        var query = wx.createSelectorQuery();
        this.setData({ input: { status: true, height: event.detail.height } });
        query.select("#" + id)
            .boundingClientRect();
        query.selectViewport().fields({ size: true, scrollOffset: true });
        query.exec(function (res) {
            console.log(res);
            console.log('bottom是', res[0].bottom);
            console.log('scrollTop是', res[1].scrollTop);
            console.log('键盘高度是', event.detail.height);
            console.log('屏幕高度为', res[1].height);
            console.log(res[0].bottom + event.detail.height > res[1].height);
            if (res[0].bottom + event.detail.height > res[1].height) {
                console.log('scroll');
                console.log('计划向上滚动', res[0].bottom + event.detail.height - res[1].height + 10);
                console.log('新的应为', res[1].scrollTop + res[0].bottom + event.detail.height - res[1].height + 10);
                wx.pageScrollTo({ scrollTop: res[1].scrollTop + res[0].bottom + event.detail.height - res[1].height + 10 });
            }
        });
    },
    input: function (event) {
        var _a;
        console.log(event);
        var project = event.currentTarget.id;
        this.setData((_a = {}, _a["result." + project] = event.detail.value, _a));
    },
    blur: function () {
        this.setData({ 'input.status': false });
    },
    longRunHandler: function (event) {
        var value = event.detail.value;
        this.setData({
            'longRun.value': longRunPicker[0][value[0]] + " " + longRunPicker[1][value[1]],
            'result.longRun': (value[0] + 2) * 60 + value[1]
        });
    },
    calculate: function () {
        var _a;
        var _this = this;
        var result = this.data.result;
        wx.showLoading({ title: '计算中...', mask: true });
        console.info('输入结果为：', result);
        if (result.gender && result.grade) {
            var hash_1 = [10, 20, 30, 40, 50, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78, 80, 85, 90, 95, 100];
            var length_1 = hash_1.length;
            var PEscore_1 = {
                BMI: 0,
                vitalCapacity: 0,
                sitAndReach: 0,
                standingLongJump: 0,
                shortRun: 0,
                longRun: 0,
                special: 0,
                passScore: 60
            };
            if (result.height && result.weight) {
                var state = void 0;
                var score = Math.round(result.weight * 100000 / result.height / result.height) / 10;
                _a = result.gender === 'male'
                    ? score <= 17.8 ? ['低体重', 80] : score >= 28.0 ? ['肥胖', 60] : score >= 24.0 ? ['超重', 80] : ['正常', 100]
                    : score <= 17.1 ? ['低体重', 80] : score >= 28.0 ? ['肥胖', 60] : score >= 24.0 ? ['超重', 80] : ['正常', 100], state = _a[0], PEscore_1.BMI = _a[1];
                PEscore_1.passScore = result.grade === 'Low'
                    ? score <= 28 ? 60 : 60 - Math.ceil(score - 28) * 2
                    : 50;
                this.setData({ BMI: { score: score, state: state } });
            }
            file_1.default.getJson("function/PEcal/" + result.gender + result.grade, function (config) {
                config.longRun = config.longRun.map(function (element) {
                    var time = element.split('-');
                    return Number(time[0]) * 60 + Number(time[1]);
                });
                config.standingLongJump = config.standingLongJump.map(function (element) { return element / 100; });
                console.log(config);
                ['vitalCapacity', 'sitAndReach', 'standingLongJump'].forEach(function (x) {
                    if (result[x]) {
                        for (var i = 0; i < length_1; i++)
                            if (result[x] <= config[x][i]) {
                                PEscore_1[x] = hash_1[i];
                                break;
                            }
                            else if (i === length_1 - 1)
                                PEscore_1[x] = hash_1[i];
                    }
                    else
                        PEscore_1[x] = 0;
                });
                ['shortRun', 'longRun'].forEach(function (x) {
                    if (result[x]) {
                        for (var i = 0; i < length_1; i++)
                            if (result[x] >= config[x][i]) {
                                PEscore_1[x] = hash_1[i];
                                break;
                            }
                            else if (i === length_1 - 1)
                                PEscore_1[x] = hash_1[i];
                    }
                    else
                        PEscore_1[x] = 0;
                });
                var specialScore = result.gender === 'male' ? 'chinning' : 'situp';
                for (var i = 0; i < length_1; i++)
                    if (result[specialScore]) {
                        if (config[specialScore][i] !== '' && result[specialScore] && result[specialScore] <= config[specialScore][i]) {
                            PEscore_1.special = hash_1[i];
                            break;
                        }
                        else if (i === length_1 - 1)
                            PEscore_1.special = hash_1[i];
                    }
                    else
                        PEscore_1.special = 0;
                var finalScore = Math.round(PEscore_1.vitalCapacity * 15 + PEscore_1.shortRun * 20 + PEscore_1.sitAndReach * 10 +
                    PEscore_1.standingLongJump * 10 + PEscore_1.special * 10 + PEscore_1.longRun * 20 +
                    PEscore_1.BMI * 15) / 100;
                console.info('成绩为', PEscore_1);
                _this.setData({
                    showScore: true,
                    PEscore: PEscore_1,
                    PE: {
                        score: finalScore,
                        state: finalScore >= PEscore_1.passScore ? '及格' : '不及格'
                    }
                });
            });
            wx.hideLoading();
        }
        else {
            wx.hideLoading();
            wx.showToast({ title: '请选择性别年级', icon: 'none', duration: 2500, image: '/icon/close.png' });
        }
    },
    navigate: function () {
        this.$route('/module/module1?From=体测计算器&aim=test0&depth=1');
    },
    redirect: function () {
        this.$launch('/page/main');
    },
    onShareAppMessage: function () { return ({ title: '体测计算器', path: '/function/PEcal?share=true' }); }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUEVjYWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJQRWNhbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQU9BLGlDQUErQjtBQUMvQixnREFBNEM7QUFDNUMsc0NBQWtDO0FBQ2xDLDRDQUFxQztBQUM3QixJQUFBLHVCQUFhLENBQWM7QUFFbkMsSUFBTSxPQUFPLEdBQUc7SUFDZCxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUU7SUFDM0QsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFO0NBQ3pELENBQUM7QUFDRixJQUFNLFdBQVcsR0FBRyxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUN4QyxJQUFNLGFBQWEsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUVqRSxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRTtJQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUksQ0FBQyxXQUFHLENBQUMsQ0FBQztBQUU1RCxnQkFBUyxDQUFDLE9BQU8sRUFBRTtJQUNqQixJQUFJLEVBQUU7UUFDSixDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDTixFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUU7UUFDUixJQUFJLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsQ0FBQztRQUNyRSxNQUFNLEVBQUU7WUFD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QUcsQ0FBQztnQkFFMUIsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsU0FBTyxDQUFDLENBQUM7Z0JBQzdCLEtBQUksQ0FBQyxPQUFRLENBQUM7b0JBQ1osU0FBUyxFQUFFLElBQUk7b0JBQ2YsT0FBTyxXQUFBO29CQUNQLEVBQUUsRUFBRTt3QkFDRixLQUFLLEVBQUUsVUFBVTt3QkFDakIsS0FBSyxFQUFFLFVBQVUsSUFBSSxTQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUs7cUJBQ3REO2lCQUNGLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1lBQ0gsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO1NBQ2xCO2FBQU07WUFDTCxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDakIsRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxpQkFBaUIsRUFBRSxDQUFDLENBQUM7U0FDNUY7SUFDSCxDQUFDO0lBQ0QsUUFBUTtRQUNOLElBQUksQ0FBQyxNQUFNLENBQUMsOENBQThDLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUNELGlCQUFpQixFQUFFLGNBQU0sT0FBQSxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsNEJBQTRCLEVBQUUsQ0FBQyxFQUF4RCxDQUF3RDtDQUNsRixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQEF1dGhvcjogTXIuSG9wZVxuICogQERhdGU6IDIwMTktMDYtMjQgMjE6MTQ6MTFcbiAqIEBMYXN0RWRpdG9yczogTXIuSG9wZVxuICogQExhc3RFZGl0VGltZTogMjAxOS0wNi0yNCAyMzo0NTowNVxuICogQERlc2NyaXB0aW9uOiDkvZPmtYvorqHnrpflmahcbiAqL1xuaW1wb3J0ICRyZWdpc3RlciBmcm9tICd3eHBhZ2UnO1xuaW1wb3J0ICRjb21wb25lbnQgZnJvbSAnLi4vdXRpbHMvY29tcG9uZW50JztcbmltcG9ydCAkZmlsZSBmcm9tICcuLi91dGlscy9maWxlJztcbmltcG9ydCAkcGFnZSBmcm9tICcuLi91dGlscy9zZXRwYWdlJztcbmNvbnN0IHsgZ2xvYmFsRGF0YTogYSB9ID0gZ2V0QXBwKCk7XG5cbmNvbnN0IHNwZWNpYWwgPSBbXG4gIHsgdGV4dDogJ+W8leS9k+WQkeS4iicsIHVuaXQ6ICfkuKonLCB0eXBlOiAnbnVtYmVyJywgaWQ6ICdjaGlubmluZycgfSxcbiAgeyB0ZXh0OiAn5Luw5Y2n6LW35Z2QJywgdW5pdDogJ+S4qicsIHR5cGU6ICdudW1iZXInLCBpZDogJ3NpdHVwJyB9XG5dO1xuY29uc3QgbG9uZ1J1blRleHQgPSBbJzEwMDDnsbPot5EnLCAnODAw57Gz6LeRJ107XG5jb25zdCBsb25nUnVuUGlja2VyID0gW1snMuWIhicsICcz5YiGJywgJzTliIYnLCAnNeWIhicsICc25YiGJywgJzfliIYnXSwgW11dO1xuXG5mb3IgKGxldCBpID0gMDsgaSA8IDYwOyBpKyspIGxvbmdSdW5QaWNrZXJbMV0ucHVzaChgJHtpfeenkmApO1xuXG4kcmVnaXN0ZXIoJ1BFY2FsJywge1xuICBkYXRhOiB7XG4gICAgVDogYS5ULFxuICAgIG5tOiBhLm5tLFxuICAgIHBhZ2U6IFt7IHRhZzogJ2hlYWQnLCB0aXRsZTogJ+S9k+a1i+iuoeeul+WZqCcsIGdyZXk6IHRydWUsIGxlZnRUZXh0OiAn5Yqf6IO95aSn5Y6FJyB9XSxcbiAgICBnZW5kZXI6IHtcbiAgICAgIHBpY2tlcjogWyfnlLcnLCAn5aWzJ10sXG4gICAgICB2YWx1ZTogWydtYWxlJywgJ2ZlbWFsZSddXG4gICAgfSxcbiAgICBncmFkZToge1xuICAgICAgcGlja2VyOiBbJ+Wkp+S4gCcsICflpKfkuownLCAn5aSn5LiJJywgJ+Wkp+WbmyddLFxuICAgICAgdmFsdWU6IFsnTG93JywgJ0xvdycsICdIaWdoJywgJ0hpZ2gnXVxuICAgIH0sXG4gICAgbGlzdDogW1xuICAgICAgeyB0ZXh0OiAn6Lqr6auYJywgdW5pdDogJ+WOmOexsycsIHR5cGU6ICdudW1iZXInLCBpZDogJ2hlaWdodCcgfSxcbiAgICAgIHsgdGV4dDogJ+S9k+mHjScsIHVuaXQ6ICfljYPlhYsnLCB0eXBlOiAnZGlnaXQnLCBpZDogJ3dlaWdodCcgfSxcbiAgICAgIHsgdGV4dDogJ+WdkOS9jeS9k+WJjeWxiCcsIHVuaXQ6ICfljpjnsbMnLCB0eXBlOiAnZGlnaXQnLCBpZDogJ3NpdEFuZFJlYWNoJyB9LFxuICAgICAgeyB0ZXh0OiAn6IK65rS76YePJywgdW5pdDogJ+avq+WNhycsIHR5cGU6ICdudW1iZXInLCBpZDogJ3ZpdGFsQ2FwYWNpdHknIH0sXG4gICAgICB7IHRleHQ6ICfnq4vlrprot7Pov5wnLCB1bml0OiAn57GzJywgdHlwZTogJ2RpZ2l0JywgaWQ6ICdzdGFuZGluZ0xvbmdKdW1wJyB9LFxuICAgICAgeyB0ZXh0OiAnNTDnsbPot5EnLCB1bml0OiAn56eSJywgdHlwZTogJ2RpZ2l0JywgaWQ6ICdzaG9ydFJ1bicgfVxuICAgIF0sXG4gICAgbG9uZ1J1bjogeyB0ZXh0OiAnODAw57Gz6LeRJyB9LFxuICAgIHNwZWNpYWw6IHsgdGV4dDogJ+S7sOWNp+i1t+WdkCcsIHVuaXQ6ICfkuKonLCBpZDogJ3NpdHVwJyB9LFxuICAgIFBFc2NvcmU6IHt9LFxuICAgIHJlc3VsdDoge30sXG4gICAgc2NvcmVMaXN0OiBbXG4gICAgICB7IHRleHQ6ICdCTUknLCBpZDogJ0JNSScgfSxcbiAgICAgIHsgdGV4dDogJ+WdkOS9jeS9k+WJjeWxiCcsIGlkOiAnc2l0QW5kUmVhY2gnIH0sXG4gICAgICB7IHRleHQ6ICfogrrmtLvph48nLCBpZDogJ3ZpdGFsQ2FwYWNpdHknIH0sXG4gICAgICB7IHRleHQ6ICfnq4vlrprot7Pov5wnLCBpZDogJ3N0YW5kaW5nTG9uZ0p1bXAnIH0sXG4gICAgICB7IHRleHQ6ICc1MOexs+i3kScsIGlkOiAnc2hvcnRSdW4nIH1cbiAgICBdXG4gIH0sXG4gIG9uTG9hZChvcHRpb246IGFueSkge1xuICAgICRwYWdlLlNldCh7IG9wdGlvbiwgY3R4OiB0aGlzIH0sIHRoaXMuZGF0YS5wYWdlKTtcbiAgICBjb25zdCBnZW5kZXJJbmRleCA9IHd4LmdldFN0b3JhZ2VTeW5jKCdnZW5kZXInKTtcbiAgICBjb25zdCBncmFkZUluZGV4ID0gd3guZ2V0U3RvcmFnZVN5bmMoJ2dyYWRlJyk7XG5cbiAgICAvLyDlsIbnlKjmiLfkuIrmrKHpgInmi6nnmoTmgKfliKvlkozlubTnuqfovb3lhaVcbiAgICBpZiAoZ2VuZGVySW5kZXggfHwgZ2VuZGVySW5kZXggPT09IDApICAvLyDmlLnlj5jnibnliKvpobnnm67lkozplb/ot5HnmoTlkI3np7BcbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAnZ2VuZGVyLmluZGV4JzogZ2VuZGVySW5kZXgsXG4gICAgICAgICdsb25nUnVuLnRleHQnOiBnZW5kZXJJbmRleCA9PT0gMCA/IGxvbmdSdW5UZXh0WzBdIDogbG9uZ1J1blRleHRbMV0sXG4gICAgICAgIHNwZWNpYWw6IGdlbmRlckluZGV4ID09PSAwID8gc3BlY2lhbFswXSA6IHNwZWNpYWxbMV0sXG4gICAgICAgICdyZXN1bHQuZ2VuZGVyJzogdGhpcy5kYXRhLmdlbmRlci52YWx1ZVtnZW5kZXJJbmRleF1cbiAgICAgIH0pO1xuXG4gICAgaWYgKGdyYWRlSW5kZXggfHwgZ3JhZGVJbmRleCA9PT0gMCkgLy8g5YaZ5YWl5bm057qnXG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgJ2dyYWRlLmluZGV4JzogZ3JhZGVJbmRleCxcbiAgICAgICAgJ3Jlc3VsdC5ncmFkZSc6IHRoaXMuZGF0YS5ncmFkZS52YWx1ZVtncmFkZUluZGV4XVxuICAgICAgfSk7XG5cbiAgICAvLyDorr7nva7plb/ot5HpgInmi6nlmajmlbDmja5cbiAgICB0aGlzLnNldERhdGEhKHsgJ2xvbmdSdW4ucGlja2VyJzogbG9uZ1J1blBpY2tlciB9KTtcblxuICAgIC8vIOiuvue9ruiDtuWbiuWSjOiDjOaZr+minOiJslxuICAgIGNvbnN0IHsgbmMsIGJjIH0gPSAkcGFnZS5jb2xvcih0cnVlKTtcblxuICAgIHd4LnNldE5hdmlnYXRpb25CYXJDb2xvcihuYyk7XG4gICAgd3guc2V0QmFja2dyb3VuZENvbG9yKGJjKTtcblxuICAgIC8vIOiuvue9rumAmuefpVxuICAgICRwYWdlLk5vdGljZSgnUEVjYWwnKTtcbiAgfSxcbiAgb25QYWdlU2Nyb2xsKGU6IGFueSkge1xuICAgICRjb21wb25lbnQubmF2KGUsIHRoaXMpO1xuICB9LFxuICBjQShlOiBhbnkpIHtcbiAgICAkY29tcG9uZW50LnRyaWdnZXIoZSwgdGhpcyk7XG4gIH0sXG4gIGdlbmRlckNoYW5nZShldmVudDogYW55KSB7XG4gICAgY29uc3QgaW5kZXggPSBOdW1iZXIoZXZlbnQuZGV0YWlsLnZhbHVlKTtcbiAgICBjb25zdCBnZW5kZXIgPSB0aGlzLmRhdGEuZ2VuZGVyLnZhbHVlW2luZGV4XTtcblxuICAgIHd4LnNldFN0b3JhZ2VTeW5jKCdnZW5kZXInLCBpbmRleCk7XG5cbiAgICAvLyDmlLnlj5jnibnliKvpobnnm67lkozplb/ot5HnmoTlkI3np7BcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICdyZXN1bHQuZ2VuZGVyJzogZ2VuZGVyLFxuICAgICAgJ2dlbmRlci5pbmRleCc6IGluZGV4LFxuICAgICAgc3BlY2lhbDogZ2VuZGVyID09PSAnbWFsZScgPyBzcGVjaWFsWzBdIDogc3BlY2lhbFsxXSxcbiAgICAgICdsb25nUnVuLnRleHQnOiBnZW5kZXIgPT09ICdtYWxlJyA/IGxvbmdSdW5UZXh0WzBdIDogbG9uZ1J1blRleHRbMV1cbiAgICB9KTtcbiAgfSxcbiAgZ3JhZGVDaGFuZ2UoZXZlbnQ6IGFueSkge1xuICAgIGNvbnN0IGluZGV4ID0gTnVtYmVyKGV2ZW50LmRldGFpbC52YWx1ZSk7XG5cbiAgICAvLyDorr7nva7lubTnuqdcbiAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICdncmFkZS5pbmRleCc6IGluZGV4LFxuICAgICAgJ3Jlc3VsdC5ncmFkZSc6IHRoaXMuZGF0YS5ncmFkZS52YWx1ZVtpbmRleF1cbiAgICB9KTtcbiAgICB3eC5zZXRTdG9yYWdlU3luYygnZ3JhZGUnLCBpbmRleCk7XG4gIH0sXG4gIGZvY3VzKGV2ZW50OiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZygnZm9jdXMnLCBldmVudCk7XG4gICAgY29uc3QgeyBpZCB9ID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgICBjb25zdCBxdWVyeSA9IHd4LmNyZWF0ZVNlbGVjdG9yUXVlcnkoKTtcblxuICAgIHRoaXMuc2V0RGF0YSEoeyBpbnB1dDogeyBzdGF0dXM6IHRydWUsIGhlaWdodDogZXZlbnQuZGV0YWlsLmhlaWdodCB9IH0pO1xuXG4gICAgcXVlcnkuc2VsZWN0KGAjJHtpZH1gKVxuICAgICAgLmJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHF1ZXJ5LnNlbGVjdFZpZXdwb3J0KCkuZmllbGRzKHsgc2l6ZTogdHJ1ZSwgc2Nyb2xsT2Zmc2V0OiB0cnVlIH0pO1xuICAgIHF1ZXJ5LmV4ZWMoKHJlczogYW55KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgY29uc29sZS5sb2coJ2JvdHRvbeaYrycsIHJlc1swXS5ib3R0b20pO1xuICAgICAgY29uc29sZS5sb2coJ3Njcm9sbFRvcOaYrycsIHJlc1sxXS5zY3JvbGxUb3ApO1xuICAgICAgY29uc29sZS5sb2coJ+mUruebmOmrmOW6puaYrycsIGV2ZW50LmRldGFpbC5oZWlnaHQpO1xuICAgICAgY29uc29sZS5sb2coJ+Wxj+W5lemrmOW6puS4uicsIHJlc1sxXS5oZWlnaHQpO1xuICAgICAgY29uc29sZS5sb2cocmVzWzBdLmJvdHRvbSArIGV2ZW50LmRldGFpbC5oZWlnaHQgPiByZXNbMV0uaGVpZ2h0KTtcbiAgICAgIGlmIChyZXNbMF0uYm90dG9tICsgZXZlbnQuZGV0YWlsLmhlaWdodCA+IHJlc1sxXS5oZWlnaHQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3Njcm9sbCcpO1xuICAgICAgICBjb25zb2xlLmxvZygn6K6h5YiS5ZCR5LiK5rua5YqoJywgcmVzWzBdLmJvdHRvbSArIGV2ZW50LmRldGFpbC5oZWlnaHQgLSByZXNbMV0uaGVpZ2h0ICsgMTApO1xuICAgICAgICBjb25zb2xlLmxvZygn5paw55qE5bqU5Li6JywgcmVzWzFdLnNjcm9sbFRvcCArIHJlc1swXS5ib3R0b20gKyBldmVudC5kZXRhaWwuaGVpZ2h0IC0gcmVzWzFdLmhlaWdodCArIDEwKTtcbiAgICAgICAgd3gucGFnZVNjcm9sbFRvKHsgc2Nyb2xsVG9wOiByZXNbMV0uc2Nyb2xsVG9wICsgcmVzWzBdLmJvdHRvbSArIGV2ZW50LmRldGFpbC5oZWlnaHQgLSByZXNbMV0uaGVpZ2h0ICsgMTAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIGlucHV0KGV2ZW50OiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZyhldmVudCk7XG4gICAgY29uc3QgcHJvamVjdCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuaWQ7XG5cbiAgICB0aGlzLnNldERhdGEhKHsgW2ByZXN1bHQuJHtwcm9qZWN0fWBdOiBldmVudC5kZXRhaWwudmFsdWUgfSk7XG4gIH0sXG4gIGJsdXIoKSB7XG4gICAgdGhpcy5zZXREYXRhISh7ICdpbnB1dC5zdGF0dXMnOiBmYWxzZSB9KTtcbiAgfSxcbiAgbG9uZ1J1bkhhbmRsZXIoZXZlbnQ6IGFueSkge1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IGV2ZW50LmRldGFpbDtcblxuICAgIC8vIOiuvue9ruaYvuekuuaVsOaNrlxuICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgJ2xvbmdSdW4udmFsdWUnOiBgJHtsb25nUnVuUGlja2VyWzBdW3ZhbHVlWzBdXX0gJHtsb25nUnVuUGlja2VyWzFdW3ZhbHVlWzFdXX1gLFxuICAgICAgJ3Jlc3VsdC5sb25nUnVuJzogKHZhbHVlWzBdICsgMikgKiA2MCArIHZhbHVlWzFdXG4gICAgfSk7XG5cblxuICB9LFxuICBjYWxjdWxhdGUoKSB7XG4gICAgY29uc3QgeyByZXN1bHQgfSA9IHRoaXMuZGF0YTtcblxuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICforqHnrpfkuK0uLi4nLCBtYXNrOiB0cnVlIH0pO1xuICAgIGNvbnNvbGUuaW5mbygn6L6T5YWl57uT5p6c5Li677yaJywgcmVzdWx0KTtcblxuICAgIGlmIChyZXN1bHQuZ2VuZGVyICYmIHJlc3VsdC5ncmFkZSkgeyAvLyDlj6/ku6XorqHnrpdcbiAgICAgIGludGVyZmFjZSBQRVNjb3JlIHtcbiAgICAgICAgQk1JOiBudW1iZXIsXG4gICAgICAgIHZpdGFsQ2FwYWNpdHk6IG51bWJlcixcbiAgICAgICAgc2l0QW5kUmVhY2g6IG51bWJlcixcbiAgICAgICAgc3RhbmRpbmdMb25nSnVtcDogbnVtYmVyLFxuICAgICAgICBzaG9ydFJ1bjogbnVtYmVyLFxuICAgICAgICBsb25nUnVuOiBudW1iZXIsXG4gICAgICAgIHNwZWNpYWw6IG51bWJlcjtcbiAgICAgICAgcGFzc1Njb3JlOiBudW1iZXI7XG4gICAgICAgIFtwcm9wczogc3RyaW5nXTogbnVtYmVyO1xuICAgICAgfVxuXG5cbiAgICAgIGNvbnN0IGhhc2ggPSBbMTAsIDIwLCAzMCwgNDAsIDUwLCA2MCwgNjIsIDY0LCA2NiwgNjgsIDcwLCA3MiwgNzQsIDc2LCA3OCwgODAsIDg1LCA5MCwgOTUsIDEwMF07XG4gICAgICBjb25zdCB7IGxlbmd0aCB9ID0gaGFzaDtcbiAgICAgIGNvbnN0IFBFc2NvcmU6IFBFU2NvcmUgPSB7XG4gICAgICAgIEJNSTogMCxcbiAgICAgICAgdml0YWxDYXBhY2l0eTogMCxcbiAgICAgICAgc2l0QW5kUmVhY2g6IDAsXG4gICAgICAgIHN0YW5kaW5nTG9uZ0p1bXA6IDAsXG4gICAgICAgIHNob3J0UnVuOiAwLFxuICAgICAgICBsb25nUnVuOiAwLFxuICAgICAgICBzcGVjaWFsOiAwLFxuICAgICAgICBwYXNzU2NvcmU6IDYwXG4gICAgICB9O1xuXG4gICAgICBpZiAocmVzdWx0LmhlaWdodCAmJiByZXN1bHQud2VpZ2h0KSB7IC8vIOWPr+S7peiuoeeul0JNSVxuICAgICAgICBsZXQgc3RhdGU7XG4gICAgICAgIGNvbnN0IHNjb3JlID0gTWF0aC5yb3VuZChyZXN1bHQud2VpZ2h0ICogMTAwMDAwIC8gcmVzdWx0LmhlaWdodCAvIHJlc3VsdC5oZWlnaHQpIC8gMTA7XG5cbiAgICAgICAgLy8g6K6h566XQk1J54q25oCB5LiO5YiG5YC8XG4gICAgICAgIFtzdGF0ZSwgUEVzY29yZS5CTUldID0gcmVzdWx0LmdlbmRlciA9PT0gJ21hbGUnXG4gICAgICAgICAgPyBzY29yZSA8PSAxNy44ID8gWyfkvY7kvZPph40nLCA4MF0gOiBzY29yZSA+PSAyOC4wID8gWyfogqXog5YnLCA2MF0gOiBzY29yZSA+PSAyNC4wID8gWyfotoXph40nLCA4MF0gOiBbJ+ato+W4uCcsIDEwMF1cbiAgICAgICAgICA6IHNjb3JlIDw9IDE3LjEgPyBbJ+S9juS9k+mHjScsIDgwXSA6IHNjb3JlID49IDI4LjAgPyBbJ+iCpeiDlicsIDYwXSA6IHNjb3JlID49IDI0LjAgPyBbJ+i2hemHjScsIDgwXSA6IFsn5q2j5bi4JywgMTAwXTtcblxuICAgICAgICAvLyDorqHnrpflj4rmoLzliIbmlbBcbiAgICAgICAgUEVzY29yZS5wYXNzU2NvcmUgPSByZXN1bHQuZ3JhZGUgPT09ICdMb3cnXG4gICAgICAgICAgPyBzY29yZSA8PSAyOCA/IDYwIDogNjAgLSBNYXRoLmNlaWwoc2NvcmUgLSAyOCkgKiAyXG4gICAgICAgICAgOiA1MDtcblxuICAgICAgICB0aGlzLnNldERhdGEhKHsgQk1JOiB7IHNjb3JlLCBzdGF0ZSB9IH0pO1xuICAgICAgfVxuXG4gICAgICAkZmlsZS5nZXRKc29uKGBmdW5jdGlvbi9QRWNhbC8ke3Jlc3VsdC5nZW5kZXJ9JHtyZXN1bHQuZ3JhZGV9YCwgKGNvbmZpZzogYW55KSA9PiB7IC8vIOivu+WPluebuOW6lOmFjee9ruaWh+S7tlxuXG4gICAgICAgIC8vIOi9rOaNoumVv+i3keaXtumXtFxuICAgICAgICBjb25maWcubG9uZ1J1biA9IGNvbmZpZy5sb25nUnVuLm1hcCgoZWxlbWVudDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgY29uc3QgdGltZSA9IGVsZW1lbnQuc3BsaXQoJy0nKTtcblxuICAgICAgICAgIHJldHVybiBOdW1iZXIodGltZVswXSkgKiA2MCArIE51bWJlcih0aW1lWzFdKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8g6L2s5o2i56uL5a6a6Lez6L+c5Y2V5L2NXG4gICAgICAgIGNvbmZpZy5zdGFuZGluZ0xvbmdKdW1wID0gY29uZmlnLnN0YW5kaW5nTG9uZ0p1bXAubWFwKChlbGVtZW50OiBudW1iZXIpID0+IGVsZW1lbnQgLyAxMDApO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGNvbmZpZyk7XG5cbiAgICAgICAgLy8g5Lul5LiL5LiJ6aG56LaK6auY6LaK5aW977yM6L+b6KGM6K6h566XXG4gICAgICAgIFsndml0YWxDYXBhY2l0eScsICdzaXRBbmRSZWFjaCcsICdzdGFuZGluZ0xvbmdKdW1wJ10uZm9yRWFjaCh4ID0+IHtcbiAgICAgICAgICBpZiAocmVzdWx0W3hdKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgICBpZiAocmVzdWx0W3hdIDw9IGNvbmZpZ1t4XVtpXSkge1xuICAgICAgICAgICAgICAgIFBFc2NvcmVbeF0gPSBoYXNoW2ldO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPT09IGxlbmd0aCAtIDEpXG4gICAgICAgICAgICAgICAgUEVzY29yZVt4XSA9IGhhc2hbaV07XG4gICAgICAgICAgfSBlbHNlIFBFc2NvcmVbeF0gPSAwO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyDku6XkuIvkuKTpobnotorkvY7otorlpb1cbiAgICAgICAgWydzaG9ydFJ1bicsICdsb25nUnVuJ10uZm9yRWFjaCh4ID0+IHtcbiAgICAgICAgICBpZiAocmVzdWx0W3hdKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgICBpZiAocmVzdWx0W3hdID49IGNvbmZpZ1t4XVtpXSkge1xuICAgICAgICAgICAgICAgIFBFc2NvcmVbeF0gPSBoYXNoW2ldO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPT09IGxlbmd0aCAtIDEpXG4gICAgICAgICAgICAgICAgUEVzY29yZVt4XSA9IGhhc2hbaV07XG4gICAgICAgICAgfSBlbHNlIFBFc2NvcmVbeF0gPSAwO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyDorqHnrpfnibnliKvnsbvpobnnm67liIbmlbBcbiAgICAgICAgY29uc3Qgc3BlY2lhbFNjb3JlID0gcmVzdWx0LmdlbmRlciA9PT0gJ21hbGUnID8gJ2NoaW5uaW5nJyA6ICdzaXR1cCc7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKylcbiAgICAgICAgICBpZiAocmVzdWx0W3NwZWNpYWxTY29yZV0pIHtcbiAgICAgICAgICAgIGlmIChjb25maWdbc3BlY2lhbFNjb3JlXVtpXSAhPT0gJycgJiYgcmVzdWx0W3NwZWNpYWxTY29yZV0gJiYgcmVzdWx0W3NwZWNpYWxTY29yZV0gPD0gY29uZmlnW3NwZWNpYWxTY29yZV1baV0pIHtcbiAgICAgICAgICAgICAgUEVzY29yZS5zcGVjaWFsID0gaGFzaFtpXTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGkgPT09IGxlbmd0aCAtIDEpXG4gICAgICAgICAgICAgIFBFc2NvcmUuc3BlY2lhbCA9IGhhc2hbaV07XG4gICAgICAgICAgfSBlbHNlIFBFc2NvcmUuc3BlY2lhbCA9IDA7XG5cbiAgICAgICAgLy8gVE9ETzrorqHnrpfliqDliIZcblxuXG4gICAgICAgIC8vIOiuoeeul+acgOe7iOaIkOe7qVxuICAgICAgICBjb25zdCBmaW5hbFNjb3JlID0gTWF0aC5yb3VuZChQRXNjb3JlLnZpdGFsQ2FwYWNpdHkgKiAxNSArIFBFc2NvcmUuc2hvcnRSdW4gKiAyMCArIFBFc2NvcmUuc2l0QW5kUmVhY2ggKiAxMCArXG4gICAgICAgICAgUEVzY29yZS5zdGFuZGluZ0xvbmdKdW1wICogMTAgKyBQRXNjb3JlLnNwZWNpYWwgKiAxMCArIFBFc2NvcmUubG9uZ1J1biAqIDIwICtcbiAgICAgICAgICBQRXNjb3JlLkJNSSAqIDE1KSAvIDEwMDtcblxuICAgICAgICBjb25zb2xlLmluZm8oJ+aIkOe7qeS4uicsIFBFc2NvcmUpO1xuICAgICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgICBzaG93U2NvcmU6IHRydWUsXG4gICAgICAgICAgUEVzY29yZSxcbiAgICAgICAgICBQRToge1xuICAgICAgICAgICAgc2NvcmU6IGZpbmFsU2NvcmUsXG4gICAgICAgICAgICBzdGF0ZTogZmluYWxTY29yZSA+PSBQRXNjb3JlLnBhc3NTY29yZSA/ICflj4rmoLwnIDogJ+S4jeWPiuagvCdcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICB3eC5oaWRlTG9hZGluZygpO1xuICAgIH0gZWxzZSB7XG4gICAgICB3eC5oaWRlTG9hZGluZygpO1xuICAgICAgd3guc2hvd1RvYXN0KHsgdGl0bGU6ICfor7fpgInmi6nmgKfliKvlubTnuqcnLCBpY29uOiAnbm9uZScsIGR1cmF0aW9uOiAyNTAwLCBpbWFnZTogJy9pY29uL2Nsb3NlLnBuZycgfSk7XG4gICAgfVxuICB9LFxuICBuYXZpZ2F0ZSgpIHtcbiAgICB0aGlzLiRyb3V0ZSgnL21vZHVsZS9tb2R1bGUxP0Zyb2095L2T5rWL6K6h566X5ZmoJmFpbT10ZXN0MCZkZXB0aD0xJyk7XG4gIH0sXG5cbiAgcmVkaXJlY3QoKSB7XG4gICAgdGhpcy4kbGF1bmNoKCcvcGFnZS9tYWluJyk7XG4gIH0sXG4gIG9uU2hhcmVBcHBNZXNzYWdlOiAoKSA9PiAoeyB0aXRsZTogJ+S9k+a1i+iuoeeul+WZqCcsIHBhdGg6ICcvZnVuY3Rpb24vUEVjYWw/c2hhcmU9dHJ1ZScgfSlcbn0pO1xuIl19