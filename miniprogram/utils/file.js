"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var fileManager = wx.getFileSystemManager();
var userPath = wx.env.USER_DATA_PATH;
var logger = wx.getLogManager({ level: 1 });
var Delete = function (path, isDir) {
    if (isDir === void 0) { isDir = false; }
    if (isDir === null)
        try {
            if (fileManager.statSync(userPath + "/" + path).isFile())
                fileManager.unlinkSync(userPath + "/" + path);
            else
                fileManager.rmdirSync(userPath + "/" + path, true);
        }
        catch (err) {
            console.error("\u5220\u9664" + path + "\u51FA\u9519,\u9519\u8BEF\u4E3A:", err);
            logger.warn("\u5220\u9664" + path + "\u51FA\u9519,\u9519\u8BEF\u4E3A:", err);
        }
    else if (isDir)
        try {
            fileManager.rmdirSync(userPath + "/" + path, true);
        }
        catch (err) {
            console.error("\u5220\u9664" + path + "\u51FA\u9519,\u9519\u8BEF\u4E3A:", err);
            logger.warn("\u5220\u9664" + path + "\u51FA\u9519,\u9519\u8BEF\u4E3A:", err);
        }
    else
        try {
            fileManager.unlinkSync(userPath + "/" + path);
        }
        catch (err) {
            console.error("\u5220\u9664" + path + "\u51FA\u9519,\u9519\u8BEF\u4E3A:", err);
            logger.warn("\u5220\u9664" + path + "\u51FA\u9519,\u9519\u8BEF\u4E3A:", err);
        }
};
var listFile = function (path) {
    try {
        var fileList = fileManager.readdirSync(userPath + "/" + path);
        console.info(path + "\u6587\u4EF6\u5939\u4E0B\u6587\u4EF6\u4E3A\uFF1A", fileList);
        return fileList;
    }
    catch (err) {
        console.error("\u5217\u51FA" + path + "\u6587\u4EF6\u5939\u4E0B\u6587\u4EF6\u9519\u8BEF\uFF1A", err);
        logger.warn("\u5217\u51FA" + path + "\u6587\u4EF6\u5939\u4E0B\u6587\u4EF6\u9519\u8BEF\uFF1A", err);
        return [];
    }
};
var readFile = function (path, encoding) {
    if (encoding === void 0) { encoding = 'utf-8'; }
    try {
        return fileManager.readFileSync(userPath + "/" + path, encoding);
    }
    catch (err) {
        console.warn(path + "\u4E0D\u5B58\u5728");
        logger.debug(path + "\u4E0D\u5B58\u5728");
        return null;
    }
};
var readJson = function (path, encoding) {
    if (encoding === void 0) { encoding = 'utf-8'; }
    var fileContent;
    var data;
    try {
        fileContent = fileManager.readFileSync(userPath + "/" + path + ".json", encoding);
        try {
            data = JSON.parse(fileContent);
            console.log("read " + path + ".json\u6210\u529F\uFF1A", data);
        }
        catch (err) {
            data = null;
            console.warn(path + "\u89E3\u6790\u5931\u8D25");
            logger.debug(path + "\u89E3\u6790\u5931\u8D25");
        }
    }
    catch (err) {
        data = null;
        console.warn(path + "\u4E0D\u5B58\u5728");
        logger.debug(path + "\u4E0D\u5B58\u5728");
    }
    return data;
};
var makeDir = function (path, recursive) {
    if (recursive === void 0) { recursive = true; }
    try {
        fileManager.mkdirSync(userPath + "/" + path, recursive);
    }
    catch (err) {
        console.info(path + "\u76EE\u5F55\u5DF2\u5B58\u5728", err);
        logger.debug(path + "\u76EE\u5F55\u5DF2\u5B58\u5728", err);
    }
};
var saveFile = function (tempFilePath, path) {
    try {
        fileManager.saveFileSync(tempFilePath, userPath + "/" + path);
    }
    catch (err) {
        console.error("\u4FDD\u5B58\u6587\u4EF6\u5230" + path + "\u5931\u8D25\uFF1A", err);
        logger.warn("\u4FDD\u5B58\u6587\u4EF6\u5230" + path + "\u5931\u8D25\uFF1A", err);
    }
};
var saveOnlineFile = function (_a, successFunc, failFunc, errorFunc) {
    var onlinePath = _a[0], savePath = _a[1], fileName = _a[2];
    makeDir(savePath);
    wx.downloadFile({
        url: "https://mp.nenuyouth.com/" + onlinePath,
        filePath: userPath + "/" + savePath + "/" + fileName,
        success: function (res) {
            if (res.statusCode === 200) {
                console.info("save " + onlinePath + " success");
                successFunc(res.tempFilePath);
            }
            else {
                if (errorFunc)
                    errorFunc(res.statusCode);
                console.warn("\u4E0B\u8F7D" + onlinePath + "\u5931\u8D25\uFF0C\u72B6\u6001\u7801\u4E3A" + res.statusCode);
                logger.warn("\u4E0B\u8F7D" + onlinePath + "\u5931\u8D25\uFF0C\u72B6\u6001\u7801\u4E3A" + res.statusCode);
            }
        },
        fail: function (failMsg) {
            if (failFunc)
                failFunc(failMsg);
            console.warn("\u4E0B\u8F7D" + onlinePath + "\u5931\u8D25\uFF0C\u9519\u8BEF\u4E3A", failMsg);
            logger.warn("\u4E0B\u8F7D" + onlinePath + "\u5931\u8D25\uFF0C\u9519\u8BEF\u4E3A", failMsg);
        }
    });
};
var writeFile = function (path, fileName, data, encoding) {
    if (encoding === void 0) { encoding = 'utf-8'; }
    var jsonString = JSON.stringify(data);
    makeDir(path);
    fileManager.writeFileSync(userPath + "/" + path + "/" + fileName, jsonString, encoding);
};
var writeJson = function (path, fileName, data, encoding) {
    if (encoding === void 0) { encoding = 'utf-8'; }
    var jsonString = JSON.stringify(data);
    makeDir(path);
    fileManager.writeFileSync(userPath + "/" + path + "/" + fileName + ".json", jsonString, encoding);
};
var getJson = function (path, callback, failFunc) {
    var data = readJson(path);
    if (data)
        return callback(data);
    var temp = path.split('/');
    var fileName = temp.pop();
    var folder = temp.join('/');
    makeDir(folder);
    wx.downloadFile({
        url: "https://mp.nenuyouth.com/" + path + ".json",
        filePath: userPath + "/" + folder + "/" + fileName,
        success: function (res) {
            if (res.statusCode === 200) {
                console.info("Save " + path + ".json success");
                data = readJson(path);
                return callback(data);
            }
            console.warn("\u83B7\u53D6" + path + ".json\u5931\u8D25\uFF0C\u72B6\u6001\u7801\u4E3A" + res.statusCode);
            logger.warn("\u83B7\u53D6" + path + ".json\u5931\u8D25\uFF0C\u72B6\u6001\u7801\u4E3A" + res.statusCode);
            if (failFunc)
                return failFunc();
            return null;
        },
        fail: function (failMsg) {
            console.warn("\u4E0B\u8F7D" + path + ".json\u5931\u8D25\uFF0C\u9519\u8BEF\u4E3A", failMsg);
            logger.warn("\u4E0B\u8F7D" + path + ".json\u5931\u8D25\uFF0C\u9519\u8BEF\u4E3A", failMsg);
            if (failFunc)
                return failFunc();
            return null;
        }
    });
    return null;
};
var unzip = function (path, unzipPath, callback) {
    var args = [];
    for (var _i = 3; _i < arguments.length; _i++) {
        args[_i - 3] = arguments[_i];
    }
    fileManager.unzip({
        zipFilePath: userPath + "/" + path, targetPath: userPath + "/" + unzipPath,
        success: function () {
            if (callback)
                return callback.apply(void 0, args);
            return null;
        },
        fail: function (failMsg) {
            console.error("unzip " + path + " fail:", failMsg);
            logger.warn("unzip " + path + " fail:", failMsg);
        }
    });
};
exports.default = {
    Delete: Delete, getJson: getJson, Manager: fileManager, listFile: listFile, readFile: readFile, readJson: readJson,
    makeDir: makeDir, saveFile: saveFile, saveOnlineFile: saveOnlineFile, writeFile: writeFile, writeJson: writeJson, unzip: unzip
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZpbGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFTQSxJQUFNLFdBQVcsR0FBRyxFQUFFLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztBQUM5QyxJQUFNLFFBQVEsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQztBQUN2QyxJQUFNLE1BQU0sR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7QUFPOUMsSUFBTSxNQUFNLEdBQUcsVUFBQyxJQUFZLEVBQUUsS0FBYTtJQUFiLHNCQUFBLEVBQUEsYUFBYTtJQUN6QyxJQUFJLEtBQUssS0FBSyxJQUFJO1FBQ2hCLElBQUk7WUFFRixJQUFJLFdBQVcsQ0FBQyxRQUFRLENBQUksUUFBUSxTQUFJLElBQU0sQ0FBQyxDQUFDLE1BQU0sRUFBRTtnQkFDdEQsV0FBVyxDQUFDLFVBQVUsQ0FBSSxRQUFRLFNBQUksSUFBTSxDQUFDLENBQUM7O2dCQUMzQyxXQUFXLENBQUMsU0FBUyxDQUFJLFFBQVEsU0FBSSxJQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FFekQ7UUFBQyxPQUFPLEdBQUcsRUFBRTtZQUNaLE9BQU8sQ0FBQyxLQUFLLENBQUMsaUJBQUssSUFBSSxxQ0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZDLE1BQU0sQ0FBQyxJQUFJLENBQUMsaUJBQUssSUFBSSxxQ0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQ3RDO1NBRUUsSUFBSSxLQUFLO1FBQUUsSUFBSTtZQUVsQixXQUFXLENBQUMsU0FBUyxDQUFJLFFBQVEsU0FBSSxJQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FFcEQ7UUFBQyxPQUFPLEdBQUcsRUFBRTtZQUNaLE9BQU8sQ0FBQyxLQUFLLENBQUMsaUJBQUssSUFBSSxxQ0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZDLE1BQU0sQ0FBQyxJQUFJLENBQUMsaUJBQUssSUFBSSxxQ0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQ3RDOztRQUVJLElBQUk7WUFFUCxXQUFXLENBQUMsVUFBVSxDQUFJLFFBQVEsU0FBSSxJQUFNLENBQUMsQ0FBQztTQUUvQztRQUFDLE9BQU8sR0FBRyxFQUFFO1lBQ1osT0FBTyxDQUFDLEtBQUssQ0FBQyxpQkFBSyxJQUFJLHFDQUFTLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLElBQUksQ0FBQyxpQkFBSyxJQUFJLHFDQUFTLEVBQUUsR0FBRyxDQUFDLENBQUM7U0FDdEM7QUFDSCxDQUFDLENBQUM7QUFPRixJQUFNLFFBQVEsR0FBRyxVQUFDLElBQVk7SUFDNUIsSUFBSTtRQUNGLElBQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxXQUFXLENBQUksUUFBUSxTQUFJLElBQU0sQ0FBQyxDQUFDO1FBRWhFLE9BQU8sQ0FBQyxJQUFJLENBQUksSUFBSSxxREFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRTFDLE9BQU8sUUFBUSxDQUFDO0tBQ2pCO0lBQUMsT0FBTyxHQUFHLEVBQUU7UUFDWixPQUFPLENBQUMsS0FBSyxDQUFDLGlCQUFLLElBQUksMkRBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUN6QyxNQUFNLENBQUMsSUFBSSxDQUFDLGlCQUFLLElBQUksMkRBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUV2QyxPQUFPLEVBQUUsQ0FBQztLQUNYO0FBQ0gsQ0FBQyxDQUFDO0FBUUYsSUFBTSxRQUFRLEdBQUcsVUFBQyxJQUFZLEVBQUUsUUFBa0I7SUFBbEIseUJBQUEsRUFBQSxrQkFBa0I7SUFDaEQsSUFBSTtRQUNGLE9BQU8sV0FBVyxDQUFDLFlBQVksQ0FBSSxRQUFRLFNBQUksSUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0tBQ2xFO0lBQUMsT0FBTyxHQUFHLEVBQUU7UUFDWixPQUFPLENBQUMsSUFBSSxDQUFJLElBQUksdUJBQUssQ0FBQyxDQUFDO1FBQzNCLE1BQU0sQ0FBQyxLQUFLLENBQUksSUFBSSx1QkFBSyxDQUFDLENBQUM7UUFFM0IsT0FBTyxJQUFJLENBQUM7S0FDYjtBQUNILENBQUMsQ0FBQztBQVFGLElBQU0sUUFBUSxHQUFHLFVBQUMsSUFBWSxFQUFFLFFBQWtCO0lBQWxCLHlCQUFBLEVBQUEsa0JBQWtCO0lBQ2hELElBQUksV0FBVyxDQUFDO0lBQ2hCLElBQUksSUFBSSxDQUFDO0lBRVQsSUFBSTtRQUNGLFdBQVcsR0FBRyxXQUFXLENBQUMsWUFBWSxDQUFJLFFBQVEsU0FBSSxJQUFJLFVBQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztRQUM3RSxJQUFJO1lBQ0YsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7WUFFL0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFRLElBQUksNEJBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQztTQUUzQztRQUFDLE9BQU8sR0FBRyxFQUFFO1lBQ1osSUFBSSxHQUFHLElBQUksQ0FBQztZQUdaLE9BQU8sQ0FBQyxJQUFJLENBQUksSUFBSSw2QkFBTSxDQUFDLENBQUM7WUFDNUIsTUFBTSxDQUFDLEtBQUssQ0FBSSxJQUFJLDZCQUFNLENBQUMsQ0FBQztTQUM3QjtLQUVGO0lBQUMsT0FBTyxHQUFHLEVBQUU7UUFDWixJQUFJLEdBQUcsSUFBSSxDQUFDO1FBR1osT0FBTyxDQUFDLElBQUksQ0FBSSxJQUFJLHVCQUFLLENBQUMsQ0FBQztRQUMzQixNQUFNLENBQUMsS0FBSyxDQUFJLElBQUksdUJBQUssQ0FBQyxDQUFDO0tBQzVCO0lBRUQsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDLENBQUM7QUFPRixJQUFNLE9BQU8sR0FBRyxVQUFDLElBQVksRUFBRSxTQUFnQjtJQUFoQiwwQkFBQSxFQUFBLGdCQUFnQjtJQUM3QyxJQUFJO1FBQ0YsV0FBVyxDQUFDLFNBQVMsQ0FBSSxRQUFRLFNBQUksSUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0tBRXpEO0lBQUMsT0FBTyxHQUFHLEVBQUU7UUFDWixPQUFPLENBQUMsSUFBSSxDQUFJLElBQUksbUNBQU8sRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNsQyxNQUFNLENBQUMsS0FBSyxDQUFJLElBQUksbUNBQU8sRUFBRSxHQUFHLENBQUMsQ0FBQztLQUNuQztBQUVILENBQUMsQ0FBQztBQU9GLElBQU0sUUFBUSxHQUFHLFVBQUMsWUFBb0IsRUFBRSxJQUFZO0lBQ2xELElBQUk7UUFDRixXQUFXLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBSyxRQUFRLFNBQUksSUFBTSxDQUFDLENBQUM7S0FFL0Q7SUFBQyxPQUFPLEdBQUcsRUFBRTtRQUNaLE9BQU8sQ0FBQyxLQUFLLENBQUMsbUNBQVEsSUFBSSx1QkFBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sQ0FBQyxJQUFJLENBQUMsbUNBQVEsSUFBSSx1QkFBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0tBQ3JDO0FBQ0gsQ0FBQyxDQUFDO0FBV0YsSUFBTSxjQUFjLEdBQUcsVUFDckIsRUFBMEMsRUFDMUMsV0FBbUMsRUFDbkMsUUFBcUQsRUFDckQsU0FBd0M7UUFIdkMsa0JBQVUsRUFBRSxnQkFBUSxFQUFFLGdCQUFRO0lBSy9CLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNsQixFQUFFLENBQUMsWUFBWSxDQUFDO1FBQ2QsR0FBRyxFQUFFLDhCQUE0QixVQUFZO1FBQzdDLFFBQVEsRUFBSyxRQUFRLFNBQUksUUFBUSxTQUFJLFFBQVU7UUFDL0MsT0FBTyxFQUFFLFVBQUEsR0FBRztZQUNWLElBQUksR0FBRyxDQUFDLFVBQVUsS0FBSyxHQUFHLEVBQUU7Z0JBQzFCLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBUSxVQUFVLGFBQVUsQ0FBQyxDQUFDO2dCQUMzQyxXQUFXLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO2FBQy9CO2lCQUFNO2dCQUNMLElBQUksU0FBUztvQkFBRSxTQUFTLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUN6QyxPQUFPLENBQUMsSUFBSSxDQUFDLGlCQUFLLFVBQVUsa0RBQVUsR0FBRyxDQUFDLFVBQVksQ0FBQyxDQUFDO2dCQUN4RCxNQUFNLENBQUMsSUFBSSxDQUFDLGlCQUFLLFVBQVUsa0RBQVUsR0FBRyxDQUFDLFVBQVksQ0FBQyxDQUFDO2FBQ3hEO1FBQ0gsQ0FBQztRQUNELElBQUksRUFBRSxVQUFBLE9BQU87WUFDWCxJQUFJLFFBQVE7Z0JBQUUsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ2hDLE9BQU8sQ0FBQyxJQUFJLENBQUMsaUJBQUssVUFBVSx5Q0FBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQy9DLE1BQU0sQ0FBQyxJQUFJLENBQUMsaUJBQUssVUFBVSx5Q0FBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ2hELENBQUM7S0FDRixDQUFDLENBQUM7QUFDTCxDQUFDLENBQUM7QUFTRixJQUFNLFNBQVMsR0FBRyxVQUFDLElBQVksRUFBRSxRQUFnQixFQUFFLElBQVMsRUFBRSxRQUFrQjtJQUFsQix5QkFBQSxFQUFBLGtCQUFrQjtJQUM5RSxJQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXhDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNkLFdBQVcsQ0FBQyxhQUFhLENBQUksUUFBUSxTQUFJLElBQUksU0FBSSxRQUFVLEVBQUUsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQ3JGLENBQUMsQ0FBQztBQVNGLElBQU0sU0FBUyxHQUFHLFVBQUMsSUFBWSxFQUFFLFFBQWdCLEVBQUUsSUFBUyxFQUFFLFFBQWtCO0lBQWxCLHlCQUFBLEVBQUEsa0JBQWtCO0lBQzlFLElBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFeEMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2QsV0FBVyxDQUFDLGFBQWEsQ0FBSSxRQUFRLFNBQUksSUFBSSxTQUFJLFFBQVEsVUFBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQztBQUMxRixDQUFDLENBQUM7QUFTRixJQUFNLE9BQU8sR0FBRyxVQUFDLElBQVksRUFBRSxRQUE2QixFQUFFLFFBQXFCO0lBQ2pGLElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUUxQixJQUFJLElBQUk7UUFBRSxPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVoQyxJQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLElBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUM1QixJQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRTlCLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUVoQixFQUFFLENBQUMsWUFBWSxDQUFDO1FBQ2QsR0FBRyxFQUFFLDhCQUE0QixJQUFJLFVBQU87UUFDNUMsUUFBUSxFQUFLLFFBQVEsU0FBSSxNQUFNLFNBQUksUUFBVTtRQUM3QyxPQUFPLEVBQUUsVUFBQSxHQUFHO1lBQ1YsSUFBSSxHQUFHLENBQUMsVUFBVSxLQUFLLEdBQUcsRUFBRTtnQkFDMUIsT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFRLElBQUksa0JBQWUsQ0FBQyxDQUFDO2dCQUUxQyxJQUFJLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUV0QixPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUN2QjtZQUNELE9BQU8sQ0FBQyxJQUFJLENBQUMsaUJBQUssSUFBSSx1REFBZSxHQUFHLENBQUMsVUFBWSxDQUFDLENBQUM7WUFDdkQsTUFBTSxDQUFDLElBQUksQ0FBQyxpQkFBSyxJQUFJLHVEQUFlLEdBQUcsQ0FBQyxVQUFZLENBQUMsQ0FBQztZQUN0RCxJQUFJLFFBQVE7Z0JBQUUsT0FBTyxRQUFRLEVBQUUsQ0FBQztZQUVoQyxPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFDRCxJQUFJLEVBQUUsVUFBQSxPQUFPO1lBQ1gsT0FBTyxDQUFDLElBQUksQ0FBQyxpQkFBSyxJQUFJLDhDQUFhLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDOUMsTUFBTSxDQUFDLElBQUksQ0FBQyxpQkFBSyxJQUFJLDhDQUFhLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDN0MsSUFBSSxRQUFRO2dCQUFFLE9BQU8sUUFBUSxFQUFFLENBQUM7WUFFaEMsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO0tBQ0YsQ0FBQyxDQUFDO0lBRUgsT0FBTyxJQUFJLENBQUM7QUFDZCxDQUFDLENBQUM7QUFTRixJQUFNLEtBQUssR0FBRyxVQUFDLElBQVksRUFBRSxTQUFpQixFQUFFLFFBQW1DO0lBQUUsY0FBYztTQUFkLFVBQWMsRUFBZCxxQkFBYyxFQUFkLElBQWM7UUFBZCw2QkFBYzs7SUFDakcsV0FBVyxDQUFDLEtBQUssQ0FBQztRQUNoQixXQUFXLEVBQUssUUFBUSxTQUFJLElBQU0sRUFBRSxVQUFVLEVBQUssUUFBUSxTQUFJLFNBQVc7UUFDMUUsT0FBTyxFQUFFO1lBQ1AsSUFBSSxRQUFRO2dCQUFFLE9BQU8sUUFBUSxlQUFJLElBQUksRUFBRTtZQUV2QyxPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFDRCxJQUFJLEVBQUUsVUFBQSxPQUFPO1lBQ1gsT0FBTyxDQUFDLEtBQUssQ0FBQyxXQUFTLElBQUksV0FBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBUyxJQUFJLFdBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM5QyxDQUFDO0tBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDO0FBRUYsa0JBQWU7SUFDYixNQUFNLFFBQUEsRUFBRSxPQUFPLFNBQUEsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFFBQVEsVUFBQSxFQUFFLFFBQVEsVUFBQSxFQUFFLFFBQVEsVUFBQTtJQUNuRSxPQUFPLFNBQUEsRUFBRSxRQUFRLFVBQUEsRUFBRSxjQUFjLGdCQUFBLEVBQUUsU0FBUyxXQUFBLEVBQUUsU0FBUyxXQUFBLEVBQUUsS0FBSyxPQUFBO0NBQy9ELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQEF1dGhvcjogTXIuSG9wZVxuICogQExhc3RFZGl0b3JzOiBNci5Ib3BlXG4gKiBARGVzY3JpcHRpb246IOaWh+S7tueuoeeQhuaooeWdl1xuICogQERhdGU6IDIwMTktMDItMTIgMTY6NDU6NDRcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMDYtMjQgMjA6NTk6MjJcbiAqL1xuXG4vLyDliJ3lp4vljJbmlofku7bnrqHnkIblmajjgIHnlKjmiLfot6/lvoTkuI7ml6Xlv5fnrqHnkIblmahcbmNvbnN0IGZpbGVNYW5hZ2VyID0gd3guZ2V0RmlsZVN5c3RlbU1hbmFnZXIoKTtcbmNvbnN0IHVzZXJQYXRoID0gd3guZW52LlVTRVJfREFUQV9QQVRIO1xuY29uc3QgbG9nZ2VyID0gd3guZ2V0TG9nTWFuYWdlcih7IGxldmVsOiAxIH0pO1xuXG4vKipcbiAqIOWIoOmZpOaWh+S7tuaIluaWh+S7tuWkuVxuICogQHBhcmFtIHBhdGgg6KaB5Yig6Zmk55qE5paH5Lu25oiW5paH5Lu25aS56Lev5b6EXG4gKiBAcGFyYW0gaXNEaXIg6KaB5Yig6Zmk55qE5piv5ZCm5piv5paH5Lu25aS5XG4gKi9cbmNvbnN0IERlbGV0ZSA9IChwYXRoOiBzdHJpbmcsIGlzRGlyID0gZmFsc2UpID0+IHtcbiAgaWYgKGlzRGlyID09PSBudWxsKVxuICAgIHRyeSB7XG4gICAgICAvLyDliKTmlq3ot6/lvoTmmK/lkKbmmK/mlofku7bvvIzlubbmiafooYzlr7nlupTliKDpmaTmk43kvZxcbiAgICAgIGlmIChmaWxlTWFuYWdlci5zdGF0U3luYyhgJHt1c2VyUGF0aH0vJHtwYXRofWApLmlzRmlsZSgpKVxuICAgICAgICBmaWxlTWFuYWdlci51bmxpbmtTeW5jKGAke3VzZXJQYXRofS8ke3BhdGh9YCk7XG4gICAgICBlbHNlIGZpbGVNYW5hZ2VyLnJtZGlyU3luYyhgJHt1c2VyUGF0aH0vJHtwYXRofWAsIHRydWUpO1xuXG4gICAgfSBjYXRjaCAoZXJyKSB7IC8vIOiwg+ivlVxuICAgICAgY29uc29sZS5lcnJvcihg5Yig6ZmkJHtwYXRofeWHuumUmSzplJnor6/kuLo6YCwgZXJyKTtcbiAgICAgIGxvZ2dlci53YXJuKGDliKDpmaQke3BhdGh95Ye66ZSZLOmUmeivr+S4ujpgLCBlcnIpO1xuICAgIH1cbiAgLy8g5piv55uu5b2VXG4gIGVsc2UgaWYgKGlzRGlyKSB0cnkge1xuXG4gICAgZmlsZU1hbmFnZXIucm1kaXJTeW5jKGAke3VzZXJQYXRofS8ke3BhdGh9YCwgdHJ1ZSk7XG5cbiAgfSBjYXRjaCAoZXJyKSB7IC8vIOiwg+ivlVxuICAgIGNvbnNvbGUuZXJyb3IoYOWIoOmZpCR7cGF0aH3lh7rplJks6ZSZ6K+v5Li6OmAsIGVycik7XG4gICAgbG9nZ2VyLndhcm4oYOWIoOmZpCR7cGF0aH3lh7rplJks6ZSZ6K+v5Li6OmAsIGVycik7XG4gIH1cbiAgLy8g5piv5paH5Lu2XG4gIGVsc2UgdHJ5IHtcblxuICAgIGZpbGVNYW5hZ2VyLnVubGlua1N5bmMoYCR7dXNlclBhdGh9LyR7cGF0aH1gKTtcblxuICB9IGNhdGNoIChlcnIpIHsgLy8g6LCD6K+VXG4gICAgY29uc29sZS5lcnJvcihg5Yig6ZmkJHtwYXRofeWHuumUmSzplJnor6/kuLo6YCwgZXJyKTtcbiAgICBsb2dnZXIud2Fybihg5Yig6ZmkJHtwYXRofeWHuumUmSzplJnor6/kuLo6YCwgZXJyKTtcbiAgfVxufTtcblxuLyoqXG4gKiDliJflh7rnm67lvZXkuIvmlofku7ZcbiAqIEBwYXJhbSBwYXRoIOimgeafpeeci+eahOaWh+S7tuWkuei3r+W+hFxuICogQHJldHVybiB7c3RyaW5nW119IOaMh+WumuebruW9leS4i+eahOaWh+S7tuWQjeaVsOe7hFxuICovXG5jb25zdCBsaXN0RmlsZSA9IChwYXRoOiBzdHJpbmcpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBmaWxlTGlzdCA9IGZpbGVNYW5hZ2VyLnJlYWRkaXJTeW5jKGAke3VzZXJQYXRofS8ke3BhdGh9YCk7XG5cbiAgICBjb25zb2xlLmluZm8oYCR7cGF0aH3mlofku7blpLnkuIvmlofku7bkuLrvvJpgLCBmaWxlTGlzdCk7Ly8g6LCD6K+VXG5cbiAgICByZXR1cm4gZmlsZUxpc3Q7XG4gIH0gY2F0Y2ggKGVycikgeyAvLyDosIPor5VcbiAgICBjb25zb2xlLmVycm9yKGDliJflh7oke3BhdGh95paH5Lu25aS55LiL5paH5Lu26ZSZ6K+v77yaYCwgZXJyKTtcbiAgICBsb2dnZXIud2Fybihg5YiX5Ye6JHtwYXRofeaWh+S7tuWkueS4i+aWh+S7tumUmeivr++8mmAsIGVycik7XG5cbiAgICByZXR1cm4gW107XG4gIH1cbn07XG5cbi8qKlxuICog5paH5Lu2566h55CG5Zmo6K+75Y+W5paH5Lu25YyF6KOFXG4gKiBAcGFyYW0gcGF0aCDlvoXor7vlj5bmlofku7bnm7jlr7nnlKjmiLfmlofku7blpLnnmoTot6/lvoRcbiAqIEBwYXJhbSBlbmNvZGluZyDmlofku7bnmoTnvJbnoIHmoLzlvI9cbiAqIEByZXR1cm4ge3N0cmluZ30g5paH5Lu25YaF5a65XG4gKi9cbmNvbnN0IHJlYWRGaWxlID0gKHBhdGg6IHN0cmluZywgZW5jb2RpbmcgPSAndXRmLTgnKSA9PiB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGZpbGVNYW5hZ2VyLnJlYWRGaWxlU3luYyhgJHt1c2VyUGF0aH0vJHtwYXRofWAsIGVuY29kaW5nKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc29sZS53YXJuKGAke3BhdGh95LiN5a2Y5ZyoYCk7XG4gICAgbG9nZ2VyLmRlYnVnKGAke3BhdGh95LiN5a2Y5ZyoYCk7XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufTtcblxuLyoqXG4gKiDor7vlj5blubbop6PmnpBKc29u5paH5Lu2XG4gKiBAcGFyYW0gcGF0aCBKc29u5paH5Lu255u45a+555So5oi35paH5Lu25aS555qE6Lev5b6EXG4gKiBAcGFyYW0gZW5jb2Rpbmcg5paH5Lu255qE57yW56CB5qC85byPXG4gKiBAcmV0dXJuIHtvYmplY3R9IOino+aekOWQjueahGpzb25cbiAqL1xuY29uc3QgcmVhZEpzb24gPSAocGF0aDogc3RyaW5nLCBlbmNvZGluZyA9ICd1dGYtOCcpID0+IHtcbiAgbGV0IGZpbGVDb250ZW50O1xuICBsZXQgZGF0YTtcblxuICB0cnkge1xuICAgIGZpbGVDb250ZW50ID0gZmlsZU1hbmFnZXIucmVhZEZpbGVTeW5jKGAke3VzZXJQYXRofS8ke3BhdGh9Lmpzb25gLCBlbmNvZGluZyk7XG4gICAgdHJ5IHtcbiAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGZpbGVDb250ZW50KTtcblxuICAgICAgY29uc29sZS5sb2coYHJlYWQgJHtwYXRofS5qc29u5oiQ5Yqf77yaYCwgZGF0YSk7XG5cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGRhdGEgPSBudWxsO1xuXG4gICAgICAvLyDosIPor5VcbiAgICAgIGNvbnNvbGUud2FybihgJHtwYXRofeino+aekOWksei0pWApO1xuICAgICAgbG9nZ2VyLmRlYnVnKGAke3BhdGh96Kej5p6Q5aSx6LSlYCk7XG4gICAgfVxuXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGRhdGEgPSBudWxsO1xuXG4gICAgLy8g6LCD6K+VXG4gICAgY29uc29sZS53YXJuKGAke3BhdGh95LiN5a2Y5ZyoYCk7XG4gICAgbG9nZ2VyLmRlYnVnKGAke3BhdGh95LiN5a2Y5ZyoYCk7XG4gIH1cblxuICByZXR1cm4gZGF0YTtcbn07XG5cbi8qKlxuICog5Yib5bu655uu5b2VXG4gKiBAcGFyYW0gcGF0aCDopoHliJvlu7rnmoTnm67lvZXot6/lvoRcbiAqIEBwYXJhbSByZWN1cnNpdmUg5piv5ZCm6YCS5b2S5Yib5bu655uu5b2VXG4gKi9cbmNvbnN0IG1ha2VEaXIgPSAocGF0aDogc3RyaW5nLCByZWN1cnNpdmUgPSB0cnVlKSA9PiB7XG4gIHRyeSB7XG4gICAgZmlsZU1hbmFnZXIubWtkaXJTeW5jKGAke3VzZXJQYXRofS8ke3BhdGh9YCwgcmVjdXJzaXZlKTtcblxuICB9IGNhdGNoIChlcnIpIHsgLy8g6LCD6K+VXG4gICAgY29uc29sZS5pbmZvKGAke3BhdGh955uu5b2V5bey5a2Y5ZyoYCwgZXJyKTtcbiAgICBsb2dnZXIuZGVidWcoYCR7cGF0aH3nm67lvZXlt7LlrZjlnKhgLCBlcnIpO1xuICB9XG5cbn07XG5cbi8qKlxuICog5L+d5a2Y5paH5Lu2XG4gKiBAcGFyYW0gdGVtcEZpbGVQYXRoIOe8k+WtmOaWh+S7tui3r+W+hFxuICogQHBhcmFtIHBhdGgg5L+d5a2Y5paH5Lu26Lev5b6EXG4gKi9cbmNvbnN0IHNhdmVGaWxlID0gKHRlbXBGaWxlUGF0aDogc3RyaW5nLCBwYXRoOiBzdHJpbmcpID0+IHtcbiAgdHJ5IHtcbiAgICBmaWxlTWFuYWdlci5zYXZlRmlsZVN5bmModGVtcEZpbGVQYXRoLCBgJHt1c2VyUGF0aH0vJHtwYXRofWApO1xuXG4gIH0gY2F0Y2ggKGVycikgeyAvLyDosIPor5VcbiAgICBjb25zb2xlLmVycm9yKGDkv53lrZjmlofku7bliLAke3BhdGh95aSx6LSl77yaYCwgZXJyKTtcbiAgICBsb2dnZXIud2Fybihg5L+d5a2Y5paH5Lu25YiwJHtwYXRofeWksei0pe+8mmAsIGVycik7XG4gIH1cbn07XG5cbi8qKlxuICog5L+d5a2Y5Zyo57q/5paH5Lu2XG4gKiBAcGFyYW0gb25saW5lUGF0aCDlnKjnur/mlofku7bot6/lvoRcbiAqIEBwYXJhbSBzYXZlUGF0aCDmnKzlnLDkv53lrZjot6/lvoRcbiAqIEBwYXJhbSBmaWxlTmFtZSDmnKzlnLDkv53lrZjmlofku7blkI1cbiAqIEBwYXJhbSBzdWNjZXNzRnVuYyDmiJDlip/lm57osIPlh73mlbBcbiAqIEBwYXJhbSBmYWlsRnVuYyAg5aSx6LSl5Zue6LCD5Ye95pWwXG4gKiBAcGFyYW0gZXJyb3JGdW5jIOWksei0peWbnuiwg+WHveaVsFxuICovXG5jb25zdCBzYXZlT25saW5lRmlsZSA9IChcbiAgW29ubGluZVBhdGgsIHNhdmVQYXRoLCBmaWxlTmFtZV06IHN0cmluZ1tdLFxuICBzdWNjZXNzRnVuYzogKHBhdGg6IHN0cmluZykgPT4gdm9pZCxcbiAgZmFpbEZ1bmM/OiAoZXJyTXNnOiB3eC5HZW5lcmFsQ2FsbGJhY2tSZXN1bHQpID0+IHZvaWQsXG4gIGVycm9yRnVuYz86IChzdGF0dXNDb2RlOiBudW1iZXIpID0+IHZvaWRcbikgPT4ge1xuICBtYWtlRGlyKHNhdmVQYXRoKTtcbiAgd3guZG93bmxvYWRGaWxlKHtcbiAgICB1cmw6IGBodHRwczovL21wLm5lbnV5b3V0aC5jb20vJHtvbmxpbmVQYXRofWAsXG4gICAgZmlsZVBhdGg6IGAke3VzZXJQYXRofS8ke3NhdmVQYXRofS8ke2ZpbGVOYW1lfWAsXG4gICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgIGlmIChyZXMuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XG4gICAgICAgIGNvbnNvbGUuaW5mbyhgc2F2ZSAke29ubGluZVBhdGh9IHN1Y2Nlc3NgKTtcbiAgICAgICAgc3VjY2Vzc0Z1bmMocmVzLnRlbXBGaWxlUGF0aCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoZXJyb3JGdW5jKSBlcnJvckZ1bmMocmVzLnN0YXR1c0NvZGUpO1xuICAgICAgICBjb25zb2xlLndhcm4oYOS4i+i9vSR7b25saW5lUGF0aH3lpLHotKXvvIznirbmgIHnoIHkuLoke3Jlcy5zdGF0dXNDb2RlfWApO1xuICAgICAgICBsb2dnZXIud2Fybihg5LiL6L29JHtvbmxpbmVQYXRofeWksei0pe+8jOeKtuaAgeeggeS4uiR7cmVzLnN0YXR1c0NvZGV9YCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBmYWlsOiBmYWlsTXNnID0+IHtcbiAgICAgIGlmIChmYWlsRnVuYykgZmFpbEZ1bmMoZmFpbE1zZyk7XG4gICAgICBjb25zb2xlLndhcm4oYOS4i+i9vSR7b25saW5lUGF0aH3lpLHotKXvvIzplJnor6/kuLpgLCBmYWlsTXNnKTtcbiAgICAgIGxvZ2dlci53YXJuKGDkuIvovb0ke29ubGluZVBhdGh95aSx6LSl77yM6ZSZ6K+v5Li6YCwgZmFpbE1zZyk7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICog5YaZ5YWl5paH5Lu2XG4gKiBAcGFyYW0gcGF0aCDlhpnlhaXmlofku7bnmoTot6/lvoRcbiAqIEBwYXJhbSBmaWxlTmFtZSDlhpnlhaXmlofku7bnmoTmlofku7blkI1cbiAqIEBwYXJhbSBkYXRhIOWGmeWFpeaWh+S7tueahOaVsOaNrlxuICogQHBhcmFtIGVuY29kaW5nIOaWh+S7tue8lueggemAiemhuVxuICovXG5jb25zdCB3cml0ZUZpbGUgPSAocGF0aDogc3RyaW5nLCBmaWxlTmFtZTogc3RyaW5nLCBkYXRhOiBhbnksIGVuY29kaW5nID0gJ3V0Zi04JykgPT4ge1xuICBjb25zdCBqc29uU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XG5cbiAgbWFrZURpcihwYXRoKTtcbiAgZmlsZU1hbmFnZXIud3JpdGVGaWxlU3luYyhgJHt1c2VyUGF0aH0vJHtwYXRofS8ke2ZpbGVOYW1lfWAsIGpzb25TdHJpbmcsIGVuY29kaW5nKTtcbn07XG5cbi8qKlxuICog5YaZ5YWlSnNvbuaWh+S7tlxuICogQHBhcmFtIHBhdGgg5YaZ5YWl5paH5Lu255qE6Lev5b6EXG4gKiBAcGFyYW0gZmlsZU5hbWUg5YaZ5YWl5paH5Lu255qE5paH5Lu25ZCNXG4gKiBAcGFyYW0gZGF0YSDlhpnlhaXmlofku7bnmoTmlbDmja5cbiAqIEBwYXJhbSBlbmNvZGluZyDmlofku7bnvJbnoIHpgInpoblcbiAqL1xuY29uc3Qgd3JpdGVKc29uID0gKHBhdGg6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZywgZGF0YTogYW55LCBlbmNvZGluZyA9ICd1dGYtOCcpID0+IHtcbiAgY29uc3QganNvblN0cmluZyA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xuXG4gIG1ha2VEaXIocGF0aCk7XG4gIGZpbGVNYW5hZ2VyLndyaXRlRmlsZVN5bmMoYCR7dXNlclBhdGh9LyR7cGF0aH0vJHtmaWxlTmFtZX0uanNvbmAsIGpzb25TdHJpbmcsIGVuY29kaW5nKTtcbn07XG5cbi8qKlxuICog6I635Y+WSnNvblxuICpcbiAqIEBwYXJhbSBwYXRoIEpTT07mlofku7bot6/lvoRcbiAqIEBwYXJhbSBjYWxsYmFjayBKc29u6I635Y+W5oiQ5Yqf5ZCO55qE5Zue6LCDXG4gKiBAcGFyYW0gZmFpbEZ1bmMgSnNvbuiOt+WPluWksei0peWQjueahOWbnuiwg1xuICovXG5jb25zdCBnZXRKc29uID0gKHBhdGg6IHN0cmluZywgY2FsbGJhY2s6IChkYXRhOiBhbnkpID0+IHZvaWQsIGZhaWxGdW5jPzogKCkgPT4gdm9pZCkgPT4ge1xuICBsZXQgZGF0YSA9IHJlYWRKc29uKHBhdGgpO1xuXG4gIGlmIChkYXRhKSByZXR1cm4gY2FsbGJhY2soZGF0YSk7XG5cbiAgY29uc3QgdGVtcCA9IHBhdGguc3BsaXQoJy8nKTtcbiAgY29uc3QgZmlsZU5hbWUgPSB0ZW1wLnBvcCgpO1xuICBjb25zdCBmb2xkZXIgPSB0ZW1wLmpvaW4oJy8nKTtcblxuICBtYWtlRGlyKGZvbGRlcik7XG5cbiAgd3guZG93bmxvYWRGaWxlKHtcbiAgICB1cmw6IGBodHRwczovL21wLm5lbnV5b3V0aC5jb20vJHtwYXRofS5qc29uYCxcbiAgICBmaWxlUGF0aDogYCR7dXNlclBhdGh9LyR7Zm9sZGVyfS8ke2ZpbGVOYW1lfWAsXG4gICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgIGlmIChyZXMuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XG4gICAgICAgIGNvbnNvbGUuaW5mbyhgU2F2ZSAke3BhdGh9Lmpzb24gc3VjY2Vzc2ApO1xuXG4gICAgICAgIGRhdGEgPSByZWFkSnNvbihwYXRoKTtcblxuICAgICAgICByZXR1cm4gY2FsbGJhY2soZGF0YSk7XG4gICAgICB9XG4gICAgICBjb25zb2xlLndhcm4oYOiOt+WPliR7cGF0aH0uanNvbuWksei0pe+8jOeKtuaAgeeggeS4uiR7cmVzLnN0YXR1c0NvZGV9YCk7XG4gICAgICBsb2dnZXIud2Fybihg6I635Y+WJHtwYXRofS5qc29u5aSx6LSl77yM54q25oCB56CB5Li6JHtyZXMuc3RhdHVzQ29kZX1gKTtcbiAgICAgIGlmIChmYWlsRnVuYykgcmV0dXJuIGZhaWxGdW5jKCk7XG5cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG4gICAgZmFpbDogZmFpbE1zZyA9PiB7XG4gICAgICBjb25zb2xlLndhcm4oYOS4i+i9vSR7cGF0aH0uanNvbuWksei0pe+8jOmUmeivr+S4umAsIGZhaWxNc2cpO1xuICAgICAgbG9nZ2VyLndhcm4oYOS4i+i9vSR7cGF0aH0uanNvbuWksei0pe+8jOmUmeivr+S4umAsIGZhaWxNc2cpO1xuICAgICAgaWYgKGZhaWxGdW5jKSByZXR1cm4gZmFpbEZ1bmMoKTtcblxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gbnVsbDtcbn07XG5cbi8qKlxuICog6Kej5Y6L5paH5Lu2XG4gKiBAcGFyYW0gcGF0aCDljovnvKnmlofku7bot6/lvoRcbiAqIEBwYXJhbSB1bnppcFBhdGgg6Kej5Y6L6Lev5b6EXG4gKiBAcGFyYW0gY2FsbGJhY2sg5Zue6LCD5Ye95pWwXG4gKiBAcGFyYW0gYXJncyDlm57osIPlh73mlbDnmoTlj4LmlbBcbiAqL1xuY29uc3QgdW56aXAgPSAocGF0aDogc3RyaW5nLCB1bnppcFBhdGg6IHN0cmluZywgY2FsbGJhY2s/OiAoLi4uYXJnczogYW55W10pID0+IHZvaWQsIC4uLmFyZ3M6IGFueVtdKSA9PiB7XG4gIGZpbGVNYW5hZ2VyLnVuemlwKHtcbiAgICB6aXBGaWxlUGF0aDogYCR7dXNlclBhdGh9LyR7cGF0aH1gLCB0YXJnZXRQYXRoOiBgJHt1c2VyUGF0aH0vJHt1bnppcFBhdGh9YCxcbiAgICBzdWNjZXNzOiAoKSA9PiB7XG4gICAgICBpZiAoY2FsbGJhY2spIHJldHVybiBjYWxsYmFjayguLi5hcmdzKTtcblxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcbiAgICBmYWlsOiBmYWlsTXNnID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYHVuemlwICR7cGF0aH0gZmFpbDpgLCBmYWlsTXNnKTtcbiAgICAgIGxvZ2dlci53YXJuKGB1bnppcCAke3BhdGh9IGZhaWw6YCwgZmFpbE1zZyk7XG4gICAgfVxuICB9KTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgRGVsZXRlLCBnZXRKc29uLCBNYW5hZ2VyOiBmaWxlTWFuYWdlciwgbGlzdEZpbGUsIHJlYWRGaWxlLCByZWFkSnNvbixcbiAgbWFrZURpciwgc2F2ZUZpbGUsIHNhdmVPbmxpbmVGaWxlLCB3cml0ZUZpbGUsIHdyaXRlSnNvbiwgdW56aXBcbn07Il19