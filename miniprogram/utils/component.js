"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var wx_1 = require("./wx");
var logger = wx.getLogManager({ level: 1 });
var list = function (res, ctx, callback) {
    var _a;
    var id = res.currentTarget.id;
    ctx.setData((_a = {}, _a["page[" + id + "].display"] = !ctx.data.page[id].display, _a), function () { return callback ? callback() : ''; });
};
var image = function (res, ctx) {
    var _a, _b;
    switch (res.type) {
        case 'load':
            ctx.setData((_a = {}, _a["page[" + res.target.id + "].load"] = true, _a));
            break;
        case 'error':
            console.warn('图片加载失败');
            wx.reportMonitor('10', 1);
            ctx.setData((_b = {}, _b["page[" + res.target.id + "].error"] = true, _b));
            break;
        case 'tap':
        default: wx.previewImage({ current: ctx.data.page[res.target.id].res, urls: ctx.data.page[0].url });
    }
};
var picker = function (res, ctx, callback) {
    var _a, _b;
    var position = res.currentTarget.dataset.id.split('-');
    var content = ctx.data.page[position[0]].content[position[1]];
    if (res.type === 'tap')
        ctx.setData((_a = {}, _a["page[" + position[0] + "].content[" + position[1] + "].visible"] = !content.visible, _a), function () { return callback ? callback(res.type) : ''; });
    else if (res.type === 'change') {
        var value = res.detail.value;
        if (content.single) {
            content.value = content.pickerValue[Number(value)];
            content.currentValue = Number(value);
            wx.setStorageSync(content.key, Number(value));
        }
        else {
            value.forEach(function (x, y) {
                content.value[y] = content.pickerValue[y][Number(x)];
                content.currentValue[y] = x;
            });
            wx.setStorageSync(content.key, value.join('-'));
        }
        ctx.setData((_b = {}, _b["page[" + position[0] + "].content[" + position[1] + "]"] = content, _b), function () { return callback ? callback(res.type) : ''; });
    }
};
var slider = function (res, ctx, callback) {
    var _a;
    var pos = res.currentTarget.dataset.id.split('-');
    var content = ctx.data.page[pos[0]].content[pos[1]];
    var value = res.detail.value;
    switch (res.type) {
        case 'tap':
            content.visible = !content.visible;
            break;
        case 'changing':
            content.value = value;
            break;
        case 'change':
        default:
            content.value = value;
            wx.setStorageSync(content.sliKey, value);
    }
    ctx.setData((_a = {}, _a["page[" + pos[0] + "].content[" + pos[1] + "]"] = content, _a), function () { return callback ? callback(res.type) : ''; });
};
var Switch = function (res, ctx, callback) {
    var _a;
    var pos = res.target.dataset.id.split('-');
    ctx.setData((_a = {}, _a["page[" + pos[0] + "].content[" + pos[1] + "].status"] = res.detail.value, _a), function () { return callback ? callback() : ''; });
    wx.setStorageSync(ctx.data.page[pos[0]].content[pos[1]].swiKey, res.detail.value);
};
var documentHandler = function (res) {
    var _a = res.currentTarget.dataset, doctype = _a.doctype, url = _a.url;
    if (['doc', 'ppt', 'xls', 'pdf'].includes(doctype)) {
        wx.showLoading({ title: '下载中...0%', mask: true });
        var docTask = wx.downloadFile({
            url: url,
            success: function (data) {
                wx.hideLoading();
                wx.openDocument({ filePath: data.tempFilePath });
            },
            fail: function () {
                wx.hideLoading();
                wx_1.default.tip('文档下载失败');
                wx.reportMonitor('9', 1);
            }
        });
        docTask.onProgressUpdate(function (data) {
            wx.showLoading({ title: "\u4E0B\u8F7D\u4E2D..." + data.progress + "%", mask: true });
        });
    }
    else if (['jpg', 'png', 'gif'].includes(doctype))
        wx.previewImage({ urls: [url] });
};
var phone = function (res, ctx) {
    var Type = res.target.dataset.type;
    var info = ctx.data.page[res.currentTarget.id];
    if (Type === 'call')
        wx.makePhoneCall({ phoneNumber: info.num.toString() });
    else if (Type === 'add')
        wx.addPhoneContact({
            firstName: info.fName,
            lastName: info.lName,
            mobilePhoneNumber: info.num,
            organization: info.org,
            workPhoneNumber: info.workNum,
            remark: info.remark,
            photoFilePath: info.head,
            nickName: info.nickName,
            weChatNumber: info.wechat,
            addressState: info.province,
            addressCity: info.city,
            addressStreet: info.street,
            addressPostalCode: info.postCode,
            title: info.title,
            hostNumber: info.hostNum,
            email: info.email,
            url: info.website,
            homePhoneNumber: info.homeNum
        });
};
var share = function (res, ctx) {
    var touch = res.touches[0];
    if (res.type === 'touchstart') {
        ctx.left = touch.pageX - res.currentTarget.offsetLeft;
        ctx.top = touch.pageY - res.currentTarget.offsetTop;
        ctx.time = res.timeStamp;
    }
    else if (res.type === 'touchmove')
        ctx.setData({ 'page[0].top': touch.pageY - ctx.top, 'page[0].left': touch.pageX - ctx.left });
    else if (res.type === 'touchend' && ctx.time > res.timeStamp - 200)
        ctx.setData({ 'page[0].menuDisplay': true });
    else if (res.type === 'tap') {
        ctx.setData({ 'page[0].menuDisplay': false });
        if (res.target.dataset.object === 'download') {
            console.log('Start QRCode download.');
            wx_1.default.downLoad("img/share/" + ctx.data.page[0].aim + ".jpg", function (path) {
                wx.getSetting({
                    success: function (res2) {
                        if (res2.authSetting['scope.writePhotosAlbum'])
                            wx.saveImageToPhotosAlbum({
                                filePath: path,
                                success: function () {
                                    wx_1.default.tip('二维码保存成功');
                                    logger.debug('二维码保存成功');
                                    wx.reportMonitor('8', 1);
                                },
                                fail: function (msg) {
                                    wx_1.default.tip('二维码保存失败');
                                    console.warn('二维码保存失败:', msg);
                                    logger.warn('二维码保存失败', msg);
                                    wx.reportMonitor('6', 1);
                                }
                            });
                        else
                            wx.authorize({
                                scope: 'scope.writePhotosAlbum',
                                success: function () {
                                    wx.saveImageToPhotosAlbum({
                                        filePath: path,
                                        success: function () {
                                            wx_1.default.tip('二维码保存成功');
                                            wx.reportMonitor('8', 1);
                                        },
                                        fail: function (msg) {
                                            wx_1.default.tip('二维码保存失败');
                                            console.warn('二维码保存失败:', msg);
                                            logger.warn('二维码保存失败', msg);
                                            wx.reportMonitor('6', 1);
                                        }
                                    });
                                },
                                fail: function () {
                                    wx.showModal({
                                        title: '权限被拒', content: '您拒绝了相册写入权限，如果想要保存图片，请在小程序设置页允许权限',
                                        showCancel: false, confirmText: '确定', confirmColor: '#3CC51F',
                                        complete: function () {
                                            wx_1.default.tip('二维码保存失败');
                                            logger.warn('用户拒绝相册授权');
                                        }
                                    });
                                }
                            });
                    }
                });
            }, function () {
                wx_1.default.tip('二维码下载失败');
                console.warn("\u4E0B\u8F7D\u4E8C\u7EF4\u7801\u5931\u8D25" + ctx.data.page[0].aim);
                logger.warn("\u4E0B\u8F7D\u4E8C\u7EF4\u7801\u5931\u8D25" + ctx.data.page[0].aim);
                wx.reportMonitor('6', 1);
            }, function (statusCode) {
                wx_1.default.tip('二维码下载失败，服务器出错');
                console.warn("\u4E8C\u7EF4\u7801\u72B6\u6001\u7801\u5F02\u5E38:" + statusCode);
                logger.warn("\u4E8C\u7EF4\u7801\u72B6\u6001\u7801\u5F02\u5E38:" + statusCode);
                wx.reportMonitor('7', 1);
            });
        }
        ;
    }
};
var video = function (res) {
    console.info("\u89C6\u9891\u72B6\u6001\u4E3A" + res.type);
    if (res.type === 'waiting')
        wx_1.default.tip('缓冲中..');
    else if (res.type === 'play')
        wx.hideToast();
    else if (res.type === 'error') {
        wx_1.default.tip('视频加载出错');
        wx.reportMonitor('5', 1);
        logger.warn('视频加载出错');
    }
};
var componentAction = function (res, ctx, callback) {
    switch (res.currentTarget.dataset.action) {
        case 'img':
            image(res, ctx);
            break;
        case 'navigate':
            ctx.$route(res.currentTarget.dataset.url);
            break;
        case 'back':
            ctx.$back();
            break;
        case 'share':
            share(res, ctx);
            break;
        case 'doc':
            documentHandler(res);
            break;
        case 'phone':
            phone(res, ctx);
            break;
        case 'picker':
            picker(res, ctx, callback);
            break;
        case 'switch':
            Switch(res, ctx, callback);
            break;
        case 'slider':
            slider(res, ctx, callback);
            break;
        case 'video':
            video(res);
            break;
        case 'list':
            list(res, ctx);
            break;
        default:
            console.warn('ComponentAction error');
            logger.warn('ComponentAction error');
            wx.reportMonitor('11', 1);
    }
};
var changeNav = function (option, ctx) {
    var pageHead = ctx.data.page[0];
    var titleDisplay;
    var borderDisplay;
    var shadow;
    if (option.scrollTop <= 1)
        titleDisplay = borderDisplay = shadow = false;
    else if (option.scrollTop <= 42) {
        titleDisplay = borderDisplay = false;
        shadow = true;
    }
    else if (option.scrollTop >= 53)
        titleDisplay = borderDisplay = shadow = true;
    else {
        titleDisplay = shadow = true;
        borderDisplay = false;
    }
    if (pageHead.titleDisplay !== titleDisplay)
        ctx.setData({ 'page[0].titleDisplay': titleDisplay });
    else if (pageHead.borderDisplay !== borderDisplay)
        ctx.setData({ 'page[0].borderDisplay': borderDisplay });
    else if (pageHead.shadow !== shadow)
        ctx.setData({ 'page[0].shadow': shadow });
};
exports.default = {
    nav: changeNav,
    trigger: componentAction
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsMkJBQXVCO0FBRXZCLElBQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQyxhQUFhLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQVM5QyxJQUFNLElBQUksR0FBRyxVQUFDLEdBQVEsRUFBRSxHQUFRLEVBQUUsUUFBcUI7O0lBQzdDLElBQUEseUJBQUUsQ0FBdUI7SUFFakMsR0FBRyxDQUFDLE9BQU8sV0FBRyxHQUFDLFVBQVEsRUFBRSxjQUFXLElBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLE9BQUksY0FBTSxPQUFBLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBMUIsQ0FBMEIsQ0FBQyxDQUFDO0FBQ3pHLENBQUMsQ0FBQztBQVFGLElBQU0sS0FBSyxHQUFHLFVBQUMsR0FBUSxFQUFFLEdBQVE7O0lBQy9CLFFBQVEsR0FBRyxDQUFDLElBQUksRUFBRTtRQUdoQixLQUFLLE1BQU07WUFBRSxHQUFHLENBQUMsT0FBTyxXQUFHLEdBQUMsVUFBUSxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsV0FBUSxJQUFHLElBQUksTUFBRyxDQUFDO1lBQ2xFLE1BQU07UUFHUixLQUFLLE9BQU87WUFDVixPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3ZCLEVBQUUsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzFCLEdBQUcsQ0FBQyxPQUFPLFdBQUcsR0FBQyxVQUFRLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxZQUFTLElBQUcsSUFBSSxNQUFHLENBQUM7WUFDeEQsTUFBTTtRQUdSLEtBQUssS0FBSyxDQUFDO1FBQ1gsT0FBTyxDQUFDLENB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LENBQUM7QUFDakYsQ0FBQyxDQUFDO0FBRUYsa0JBQWU7SUFDYixHQUFHLEVBQUUsU0FBUztJQUNkLE9BQU8sRUFBRSxlQUFlO0NBQ3pCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJHd4IGZyb20gJy4vd3gnO1xuXG5jb25zdCBsb2dnZXIgPSB3eC5nZXRMb2dNYW5hZ2VyKHsgbGV2ZWw6IDEgfSk7XG5cbi8qKlxuICog5YiX6KGo5Ye95pWwIGZvciBBbmRyb2lk77yM5o6n5Yi25YiX6KGo5pi+6ZqQXG4gKlxuICogQHBhcmFtIHJlcyDnu4Tku7blj4LmlbBcbiAqIEBwYXJhbSBjdHgg6aG16Z2i5oyH6ZKIXG4gKiBAcGFyYW0gY2FsbGJhY2sg5Ye95pWw5Zue6LCDXG4gKi9cbmNvbnN0IGxpc3QgPSAocmVzOiBhbnksIGN0eDogYW55LCBjYWxsYmFjaz86ICgpID0+IHZvaWQpID0+IHtcbiAgY29uc3QgeyBpZCB9ID0gcmVzLmN1cnJlbnRUYXJnZXQ7XG5cbiAgY3R4LnNldERhdGEoeyBbYHBhZ2VbJHtpZH1dLmRpc3BsYXlgXTogIWN0eC5kYXRhLnBhZ2VbaWRdLmRpc3BsYXkgfSwgKCkgPT4gY2FsbGJhY2sgPyBjYWxsYmFjaygpIDogJycpO1xufTtcblxuLyoqXG4gKiDlm77niYflh73mlbBcbiAqXG4gKiBAcGFyYW0gcmVzIOe7hOS7tuWPguaVsFxuICogQHBhcmFtIGN0eCDpobXpnaLmjIfpkohcbiAqL1xuY29uc3QgaW1hZ2UgPSAocmVzOiBhbnksIGN0eDogYW55KSA9PiB7XG4gIHN3aXRjaCAocmVzLnR5cGUpIHtcblxuICAgIC8vIOWbvueJh+WKoOi9veWujOaIkFxuICAgIGNhc2UgJ2xvYWQnOiBjdHguc2V0RGF0YSh7IFtgcGFnZVske3Jlcy50YXJnZXQuaWR9XS5sb2FkYF06IHRydWUgfSk7XG4gICAgICBicmVhaztcblxuICAgIC8vIOWbvueJh+WKoOi9veWHuumUmVxuICAgIGNhc2UgJ2Vycm9yJzpcbiAgICAgIGNvbnNvbGUud2Fybign5Zu+54mH5Yqg6L295aSx6LSlJyk7XG4gICAgICB3eC5yZXBvcnRNb25pdG9yKCcxMCcsIDEpO1xuICAgICAgY3R4LnNldERhdGEoeyBbYHBhZ2VbJHtyZXMudGFyZ2V0LmlkfV0uZXJyb3JgXTogdHJ1ZSB9KTtcbiAgICAgIGJyZWFrO1xuXG4gICAgLy8g5byA5aeL6aKE6KeI5Zu+54mHXG4gICAgY2FzZSAndGFwJzpcbiAgICBkZWZhdWx0OiB3eC5wcmV2aWV3SW1hZ2UoeyBjdXJyZW50OiBjdHguZGF0YS5wYWdlW3Jlcy50YXJnZXQuaWRdLnJlcywgdXJsczogY3R4LmRhdGEucGFnZVswXS51cmwgfSk7XG4gIH1cbn07XG5cbi8qKlxuICog6YCJ5oup5Zmo5Ye95pWwXG4gKlxuICogQHBhcmFtIHJlcyDnu4Tku7blj4LmlbBcbiAqIEBwYXJhbSBjdHgg6aG16Z2i5oyH6ZKIXG4gKiBAcGFyYW0gY2FsbGJhY2sg5Ye95pWw5Zue6LCDXG4gKi9cbmNvbnN0IHBpY2tlciA9IChyZXM6IGFueSwgY3R4OiBhbnksIGNhbGxiYWNrPzogKHR5cGU6IHN0cmluZykgPT4gdm9pZCkgPT4ge1xuICBjb25zdCBwb3NpdGlvbiA9IHJlcy5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaWQuc3BsaXQoJy0nKTtcbiAgY29uc3QgY29udGVudCA9IGN0eC5kYXRhLnBhZ2VbcG9zaXRpb25bMF1dLmNvbnRlbnRbcG9zaXRpb25bMV1dOy8vIOiOt+W+l+mAieaLqeWZqOS9jee9ruS4juWGheWuuVxuXG4gIC8vIOWIh+aNouW1jOWFpemAieaLqeWZqOaYvumakFxuICBpZiAocmVzLnR5cGUgPT09ICd0YXAnKSBjdHguc2V0RGF0YShcbiAgICB7IFtgcGFnZVske3Bvc2l0aW9uWzBdfV0uY29udGVudFske3Bvc2l0aW9uWzFdfV0udmlzaWJsZWBdOiAhY29udGVudC52aXNpYmxlIH0sXG4gICAgKCkgPT4gY2FsbGJhY2sgPyBjYWxsYmFjayhyZXMudHlwZSkgOiAnJ1xuICApO1xuICBlbHNlIGlmIChyZXMudHlwZSA9PT0gJ2NoYW5nZScpIHtcbiAgICBjb25zdCB7IHZhbHVlIH0gPSByZXMuZGV0YWlsO1xuXG4gICAgaWYgKGNvbnRlbnQuc2luZ2xlKSB7XG4gICAgICAvLyDliKTmlq3kuLrljZXliJfpgInmi6nlmajvvIzmm7TmlrDpobXpnaLmlbDmja7lubblrZjlgqjpgInmi6nlmajlgLxcbiAgICAgIGNvbnRlbnQudmFsdWUgPSBjb250ZW50LnBpY2tlclZhbHVlW051bWJlcih2YWx1ZSldO1xuICAgICAgY29udGVudC5jdXJyZW50VmFsdWUgPSBOdW1iZXIodmFsdWUpO1xuICAgICAgd3guc2V0U3RvcmFnZVN5bmMoY29udGVudC5rZXksIE51bWJlcih2YWx1ZSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyDliKTmlq3kuLrlpJrliJfpgInmi6nlmajvvIzpgY3ljobmr4/kuIDliJfmm7TmlrDpobXpnaLmlbDmja7jgIHlubblrZjlgqjpgInmi6nlmajlgLxcbiAgICAgIHZhbHVlLmZvckVhY2goKHg6IHN0cmluZyB8IG51bWJlciwgeTogbnVtYmVyKSA9PiB7XG4gICAgICAgIGNvbnRlbnQudmFsdWVbeV0gPSBjb250ZW50LnBpY2tlclZhbHVlW3ldW051bWJlcih4KV07XG4gICAgICAgIGNvbnRlbnQuY3VycmVudFZhbHVlW3ldID0geDtcbiAgICAgIH0pO1xuICAgICAgd3guc2V0U3RvcmFnZVN5bmMoY29udGVudC5rZXksIHZhbHVlLmpvaW4oJy0nKSk7XG4gICAgfVxuXG4gICAgLy8g5bCG6YCJ5oup5Zmo55qE5Y+Y5pu05ZON5bqU5Yiw6aG16Z2i5LiKXG4gICAgY3R4LnNldERhdGEoXG4gICAgICB7IFtgcGFnZVske3Bvc2l0aW9uWzBdfV0uY29udGVudFske3Bvc2l0aW9uWzFdfV1gXTogY29udGVudCB9LFxuICAgICAgKCkgPT4gY2FsbGJhY2sgPyBjYWxsYmFjayhyZXMudHlwZSkgOiAnJ1xuICAgICk7XG4gIH1cbn07XG5cbi8qKlxuICog5ruR5Z2X5Ye95pWwXG4gKlxuICogQHBhcmFtIHJlcyDnu4Tku7blj4LmlbBcbiAqIEBwYXJhbSBjdHgg6aG16Z2i5oyH6ZKIXG4gKiBAcGFyYW0gY2FsbGJhY2sg5Ye95pWw5Zue6LCDXG4gKi9cbmNvbnN0IHNsaWRlciA9IChyZXM6IGFueSwgY3R4OiBhbnksIGNhbGxiYWNrPzogKHR5cGU6IHN0cmluZykgPT4gdm9pZCkgPT4ge1xuICBjb25zdCBwb3MgPSByZXMuY3VycmVudFRhcmdldC5kYXRhc2V0LmlkLnNwbGl0KCctJyk7XG4gIGNvbnN0IGNvbnRlbnQgPSBjdHguZGF0YS5wYWdlW3Bvc1swXV0uY29udGVudFtwb3NbMV1dO1xuICBjb25zdCB7IHZhbHVlIH0gPSByZXMuZGV0YWlsO1xuXG4gIHN3aXRjaCAocmVzLnR5cGUpIHtcblxuICAgIC8vIOWIh+aNoua7keWdl+aYvumakFxuICAgIGNhc2UgJ3RhcCc6IGNvbnRlbnQudmlzaWJsZSA9ICFjb250ZW50LnZpc2libGU7XG4gICAgICBicmVhaztcblxuICAgIC8vIOenu+WKqOaXtuWunuaXtuabtOaWsOmhtemdouaYvuekulxuICAgIGNhc2UgJ2NoYW5naW5nJzogY29udGVudC52YWx1ZSA9IHZhbHVlO1xuICAgICAgYnJlYWs7XG5cbiAgICAvLyDmm7TmlrDpobXpnaLmlbDmja7vvIzlubblhpnlhaXlgLzliLDlrZjlgqhcbiAgICBjYXNlICdjaGFuZ2UnOlxuICAgIGRlZmF1bHQ6XG4gICAgICBjb250ZW50LnZhbHVlID0gdmFsdWU7XG4gICAgICB3eC5zZXRTdG9yYWdlU3luYyhjb250ZW50LnNsaUtleSwgdmFsdWUpO1xuICB9XG5cbiAgLy8g5YaZ5YWl6aG16Z2i5pWw5o2uXG4gIGN0eC5zZXREYXRhKHsgW2BwYWdlWyR7cG9zWzBdfV0uY29udGVudFske3Bvc1sxXX1dYF06IGNvbnRlbnQgfSwgKCkgPT4gY2FsbGJhY2sgPyBjYWxsYmFjayhyZXMudHlwZSkgOiAnJyk7XG59O1xuXG4vKipcbiAqIOW8gOWFs+WHveaVsFxuICpcbiAqIEBwYXJhbSByZXMg57uE5Lu25Y+C5pWwXG4gKiBAcGFyYW0gY3R4IOmhtemdouaMh+mSiFxuICogQHBhcmFtIGNhbGxiYWNrIOWHveaVsOWbnuiwg1xuICovXG5jb25zdCBTd2l0Y2ggPSAocmVzOiBhbnksIGN0eDogYW55LCBjYWxsYmFjaz86ICgpID0+IHZvaWQpID0+IHtcbiAgY29uc3QgcG9zID0gcmVzLnRhcmdldC5kYXRhc2V0LmlkLnNwbGl0KCctJyk7XG5cbiAgLy8g5pu05paw6aG16Z2i5pWw5o2uXG4gIGN0eC5zZXREYXRhKFxuICAgIHsgW2BwYWdlWyR7cG9zWzBdfV0uY29udGVudFske3Bvc1sxXX1dLnN0YXR1c2BdOiByZXMuZGV0YWlsLnZhbHVlIH0sXG4gICAgKCkgPT4gY2FsbGJhY2sgPyBjYWxsYmFjaygpIDogJydcbiAgKTtcbiAgd3guc2V0U3RvcmFnZVN5bmMoY3R4LmRhdGEucGFnZVtwb3NbMF1dLmNvbnRlbnRbcG9zWzFdXS5zd2lLZXksIHJlcy5kZXRhaWwudmFsdWUpOyAvLyDlsIblvIDlhbPlgLzlhpnlhaXlrZjlgqjnmoRzd2lLZXnlj5jph4/kuK1cbn07XG5cbi8qKlxuICog5omT5byA5paH5qGjXG4gKlxuICogQHBhcmFtIHJlcyDnu4Tku7blj4LmlbBcbiAqL1xuY29uc3QgZG9jdW1lbnRIYW5kbGVyID0gKHJlczogYW55KSA9PiB7XG4gIGNvbnN0IHsgZG9jdHlwZSwgdXJsIH0gPSByZXMuY3VycmVudFRhcmdldC5kYXRhc2V0OyAvLyDop6PmnoTotYvlgLxcblxuICBpZiAoWydkb2MnLCAncHB0JywgJ3hscycsICdwZGYnXS5pbmNsdWRlcyhkb2N0eXBlKSkge1xuICAgIC8vIOajgOa1i+WIsOaWh+aho1xuXG4gICAgd3guc2hvd0xvYWRpbmcoeyB0aXRsZTogJ+S4i+i9veS4rS4uLjAlJywgbWFzazogdHJ1ZSB9KTsvLyDmmL7npLrkuIvovb3mj5DnpLpcblxuICAgIC8vIOW8gOWni+S4i+i9veaWh+S7tlxuICAgIGNvbnN0IGRvY1Rhc2sgPSB3eC5kb3dubG9hZEZpbGUoe1xuICAgICAgdXJsLFxuXG4gICAgICAvLyDkuIvovb3miJDlip/vvIzpmpDol4/kuIvovb3mj5DnpLrlubbmiZPlvIDmlofmoaNcbiAgICAgIHN1Y2Nlc3M6IGRhdGEgPT4ge1xuICAgICAgICB3eC5oaWRlTG9hZGluZygpO1xuICAgICAgICB3eC5vcGVuRG9jdW1lbnQoeyBmaWxlUGF0aDogZGF0YS50ZW1wRmlsZVBhdGggfSk7XG4gICAgICB9LFxuXG4gICAgICAvLyDkuIvovb3lpLHotKXvvIzpmpDol4/kuIvovb3mj5DnpLrlkYrnn6XnlKjmiLfkuIvovb3lpLHotKXlubbkuIrmiqVcbiAgICAgIGZhaWw6ICgpID0+IHtcbiAgICAgICAgd3guaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgJHd4LnRpcCgn5paH5qGj5LiL6L295aSx6LSlJyk7XG4gICAgICAgIHd4LnJlcG9ydE1vbml0b3IoJzknLCAxKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIOebkeWQrOS4i+i9vei/m+W6pu+8jOW5tuabtOaWsOW8ueeql+aYvuekulxuICAgIGRvY1Rhc2sub25Qcm9ncmVzc1VwZGF0ZShkYXRhID0+IHtcbiAgICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6IGDkuIvovb3kuK0uLi4ke2RhdGEucHJvZ3Jlc3N9JWAsIG1hc2s6IHRydWUgfSk7XG4gICAgfSk7XG5cbiAgICAvLyDmo4DmtYvliLDlm77niYfvvIzlvIDlp4vlm77niYfmtY/op4hcbiAgfSBlbHNlIGlmIChbJ2pwZycsICdwbmcnLCAnZ2lmJ10uaW5jbHVkZXMoZG9jdHlwZSkpIHd4LnByZXZpZXdJbWFnZSh7IHVybHM6IFt1cmxdIH0pO1xufTtcblxuLyoqXG4gKiDnlLXor53nu4Tku7blh73mlbBcbiAqXG4gKiBAcGFyYW0gcmVzIOe7hOS7tuWPguaVsFxuICogQHBhcmFtIGN0eCDpobXpnaLmjIfpkohcbiAqL1xuY29uc3QgcGhvbmUgPSAocmVzOiBhbnksIGN0eDogYW55KSA9PiB7XG4gIGNvbnN0IFR5cGUgPSByZXMudGFyZ2V0LmRhdGFzZXQudHlwZTtcbiAgY29uc3QgaW5mbyA9IGN0eC5kYXRhLnBhZ2VbcmVzLmN1cnJlbnRUYXJnZXQuaWRdO1xuXG4gIGlmIChUeXBlID09PSAnY2FsbCcpIHd4Lm1ha2VQaG9uZUNhbGwoeyBwaG9uZU51bWJlcjogaW5mby5udW0udG9TdHJpbmcoKSB9KTsvLyDmi6jmiZPnlLXor51cbiAgZWxzZSBpZiAoVHlwZSA9PT0gJ2FkZCcpIHd4LmFkZFBob25lQ29udGFjdCh7Ly8g5re75Yqg6IGU57O75Lq6XG4gICAgZmlyc3ROYW1lOiBpbmZvLmZOYW1lLFxuICAgIGxhc3ROYW1lOiBpbmZvLmxOYW1lLFxuICAgIG1vYmlsZVBob25lTnVtYmVyOiBpbmZvLm51bSxcbiAgICBvcmdhbml6YXRpb246IGluZm8ub3JnLFxuICAgIHdvcmtQaG9uZU51bWJlcjogaW5mby53b3JrTnVtLFxuICAgIHJlbWFyazogaW5mby5yZW1hcmssXG4gICAgcGhvdG9GaWxlUGF0aDogaW5mby5oZWFkLFxuICAgIG5pY2tOYW1lOiBpbmZvLm5pY2tOYW1lLFxuICAgIHdlQ2hhdE51bWJlcjogaW5mby53ZWNoYXQsXG4gICAgYWRkcmVzc1N0YXRlOiBpbmZvLnByb3ZpbmNlLFxuICAgIGFkZHJlc3NDaXR5OiBpbmZvLmNpdHksXG4gICAgYWRkcmVzc1N0cmVldDogaW5mby5zdHJlZXQsXG4gICAgYWRkcmVzc1Bvc3RhbENvZGU6IGluZm8ucG9zdENvZGUsXG4gICAgdGl0bGU6IGluZm8udGl0bGUsXG4gICAgaG9zdE51bWJlcjogaW5mby5ob3N0TnVtLFxuICAgIGVtYWlsOiBpbmZvLmVtYWlsLFxuICAgIHVybDogaW5mby53ZWJzaXRlLFxuICAgIGhvbWVQaG9uZU51bWJlcjogaW5mby5ob21lTnVtXG4gIH0pO1xufTtcblxuLyoqXG4gKiDliIbkuqvmjInpkq5cbiAqXG4gKiBAcGFyYW0gcmVzIOe7hOS7tuWPguaVsFxuICogQHBhcmFtIGN0eCDpobXpnaLmjIfpkohcbiAqL1xuY29uc3Qgc2hhcmUgPSAocmVzOiBhbnksIGN0eDogYW55KSA9PiB7XG4gIGNvbnN0IHRvdWNoID0gcmVzLnRvdWNoZXNbMF07XG5cbiAgLy8g6K6w5b2V6Kem5pG454K55LiO5oyJ6ZKu5bem5LiK6KeS55qE5YOP57Sg5YGP5beu5LiO54K55Ye75pe26Ze0XG4gIGlmIChyZXMudHlwZSA9PT0gJ3RvdWNoc3RhcnQnKSB7XG4gICAgY3R4LmxlZnQgPSB0b3VjaC5wYWdlWCAtIHJlcy5jdXJyZW50VGFyZ2V0Lm9mZnNldExlZnQ7XG4gICAgY3R4LnRvcCA9IHRvdWNoLnBhZ2VZIC0gcmVzLmN1cnJlbnRUYXJnZXQub2Zmc2V0VG9wO1xuICAgIGN0eC50aW1lID0gcmVzLnRpbWVTdGFtcDtcblxuICAgIC8vIOenu+WKqOWIhuS6q+aMiemSrlxuICB9IGVsc2UgaWYgKHJlcy50eXBlID09PSAndG91Y2htb3ZlJylcbiAgICBjdHguc2V0RGF0YSh7ICdwYWdlWzBdLnRvcCc6IHRvdWNoLnBhZ2VZIC0gY3R4LnRvcCwgJ3BhZ2VbMF0ubGVmdCc6IHRvdWNoLnBhZ2VYIC0gY3R4LmxlZnQgfSk7XG5cbiAgLy8g6KeG5Li654K55Ye75pON5L2c77yM5bGV56S66I+c5Y2VXG4gIGVsc2UgaWYgKHJlcy50eXBlID09PSAndG91Y2hlbmQnICYmIGN0eC50aW1lID4gcmVzLnRpbWVTdGFtcCAtIDIwMClcbiAgICBjdHguc2V0RGF0YSh7ICdwYWdlWzBdLm1lbnVEaXNwbGF5JzogdHJ1ZSB9KTtcblxuICAvLyDlj5bmtojmmL7npLroj5zljZXvvIzlubbmiafooYzlr7nlupTpgLvovpFcbiAgZWxzZSBpZiAocmVzLnR5cGUgPT09ICd0YXAnKSB7XG4gICAgY3R4LnNldERhdGEoeyAncGFnZVswXS5tZW51RGlzcGxheSc6IGZhbHNlIH0pO1xuXG4gICAgLy8g5LiL6L295LqM57u056CBXG4gICAgaWYgKHJlcy50YXJnZXQuZGF0YXNldC5vYmplY3QgPT09ICdkb3dubG9hZCcpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdTdGFydCBRUkNvZGUgZG93bmxvYWQuJyk7Ly8g6LCD6K+VXG4gICAgICAkd3guZG93bkxvYWQoYGltZy9zaGFyZS8ke2N0eC5kYXRhLnBhZ2VbMF0uYWltfS5qcGdgLCBwYXRoID0+IHtcbiAgICAgICAgd3guZ2V0U2V0dGluZyh7Ly8g6I635Y+W55So5oi36K6+572uXG4gICAgICAgICAgc3VjY2VzczogcmVzMiA9PiB7XG5cbiAgICAgICAgICAgIC8vIOWmguaenOW3sue7j+aOiOadg+ebuOWGjOebtOaOpeWGmeWFpeWbvueJh1xuICAgICAgICAgICAgaWYgKHJlczIuYXV0aFNldHRpbmdbJ3Njb3BlLndyaXRlUGhvdG9zQWxidW0nXSlcbiAgICAgICAgICAgICAgd3guc2F2ZUltYWdlVG9QaG90b3NBbGJ1bSh7XG4gICAgICAgICAgICAgICAgZmlsZVBhdGg6IHBhdGgsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgJHd4LnRpcCgn5LqM57u056CB5L+d5a2Y5oiQ5YqfJyk7XG5cbiAgICAgICAgICAgICAgICAgIC8vIOiwg+ivlVxuICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCfkuoznu7TnoIHkv53lrZjmiJDlip8nKTtcbiAgICAgICAgICAgICAgICAgIHd4LnJlcG9ydE1vbml0b3IoJzgnLCAxKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZhaWw6IG1zZyA9PiB7XG4gICAgICAgICAgICAgICAgICAkd3gudGlwKCfkuoznu7TnoIHkv53lrZjlpLHotKUnKTtcblxuICAgICAgICAgICAgICAgICAgLy8g6LCD6K+VXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ+S6jOe7tOeggeS/neWtmOWksei0pTonLCBtc2cpO1xuICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oJ+S6jOe7tOeggeS/neWtmOWksei0pScsIG1zZyk7XG4gICAgICAgICAgICAgICAgICB3eC5yZXBvcnRNb25pdG9yKCc2JywgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8g5rKh5pyJ5o6I5p2D4oCU4oCUPuaPkOekuueUqOaIt+aOiOadg1xuICAgICAgICAgICAgZWxzZSB3eC5hdXRob3JpemUoe1xuICAgICAgICAgICAgICBzY29wZTogJ3Njb3BlLndyaXRlUGhvdG9zQWxidW0nLFxuICAgICAgICAgICAgICBzdWNjZXNzOiAoKSA9PiB7XG5cbiAgICAgICAgICAgICAgICAvLyDojrflvpfmjojmnYPvvIzlhpnlhaXlm77niYdcbiAgICAgICAgICAgICAgICB3eC5zYXZlSW1hZ2VUb1Bob3Rvc0FsYnVtKHtcbiAgICAgICAgICAgICAgICAgIGZpbGVQYXRoOiBwYXRoLFxuICAgICAgICAgICAgICAgICAgc3VjY2VzczogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAkd3gudGlwKCfkuoznu7TnoIHkv53lrZjmiJDlip8nKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyDosIPor5VcbiAgICAgICAgICAgICAgICAgICAgd3gucmVwb3J0TW9uaXRvcignOCcsIDEpO1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIGZhaWw6IG1zZyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICR3eC50aXAoJ+S6jOe7tOeggeS/neWtmOWksei0pScpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIOiwg+ivlVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ+S6jOe7tOeggeS/neWtmOWksei0pTonLCBtc2cpO1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2Fybign5LqM57u056CB5L+d5a2Y5aSx6LSlJywgbXNnKTtcbiAgICAgICAgICAgICAgICAgICAgd3gucmVwb3J0TW9uaXRvcignNicsIDEpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgIC8vIOeUqOaIt+aLkue7neadg+mZkO+8jOaPkOekuueUqOaIt+W8gOWQr+adg+mZkFxuICAgICAgICAgICAgICBmYWlsOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5p2D6ZmQ6KKr5ouSJywgY29udGVudDogJ+aCqOaLkue7neS6huebuOWGjOWGmeWFpeadg+mZkO+8jOWmguaenOaDs+imgeS/neWtmOWbvueJh++8jOivt+WcqOWwj+eoi+W6j+iuvue9rumhteWFgeiuuOadg+mZkCcsXG4gICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsOiBmYWxzZSwgY29uZmlybVRleHQ6ICfnoa7lrponLCBjb25maXJtQ29sb3I6ICcjM0NDNTFGJyxcbiAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICR3eC50aXAoJ+S6jOe7tOeggeS/neWtmOWksei0pScpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIOiwg+ivlVxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2Fybign55So5oi35ouS57ud55u45YaM5o6I5p2DJyk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9LCAoKSA9PiB7XG4gICAgICAgICR3eC50aXAoJ+S6jOe7tOeggeS4i+i9veWksei0pScpO1xuXG4gICAgICAgIC8vIOiwg+ivlVxuICAgICAgICBjb25zb2xlLndhcm4oYOS4i+i9veS6jOe7tOeggeWksei0pSR7Y3R4LmRhdGEucGFnZVswXS5haW19YCk7XG4gICAgICAgIGxvZ2dlci53YXJuKGDkuIvovb3kuoznu7TnoIHlpLHotKUke2N0eC5kYXRhLnBhZ2VbMF0uYWltfWApO1xuICAgICAgICB3eC5yZXBvcnRNb25pdG9yKCc2JywgMSk7XG4gICAgICB9LCBzdGF0dXNDb2RlID0+IHtcbiAgICAgICAgJHd4LnRpcCgn5LqM57u056CB5LiL6L295aSx6LSl77yM5pyN5Yqh5Zmo5Ye66ZSZJyk7XG5cbiAgICAgICAgLy8g6LCD6K+VXG4gICAgICAgIGNvbnNvbGUud2Fybihg5LqM57u056CB54q25oCB56CB5byC5bi4OiR7c3RhdHVzQ29kZX1gKTtcbiAgICAgICAgbG9nZ2VyLndhcm4oYOS6jOe7tOeggeeKtuaAgeeggeW8guW4uDoke3N0YXR1c0NvZGV9YCk7XG4gICAgICAgIHd4LnJlcG9ydE1vbml0b3IoJzcnLCAxKTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH1cbn07XG5cbi8qKlxuICog6KeG6aKR57uE5Lu25Ye95pWwXG4gKlxuICogQHBhcmFtIHJlcyDnu4Tku7blj4LmlbBcbiAqL1xuY29uc3QgdmlkZW8gPSAocmVzOiBhbnkpID0+IHtcbiAgY29uc29sZS5pbmZvKGDop4bpopHnirbmgIHkuLoke3Jlcy50eXBlfWApOyAvLyDovpPlh7rop4bpopHnu4Tku7bnirbmgIFcbiAgaWYgKHJlcy50eXBlID09PSAnd2FpdGluZycpICR3eC50aXAoJ+e8k+WGsuS4rS4uJyk7Ly8g6KeG6aKR57yT5Yay5pe25o+Q56S655So5oi3562J5b6FXG4gIGVsc2UgaWYgKHJlcy50eXBlID09PSAncGxheScpIHd4LmhpZGVUb2FzdCgpOyAvLyDmraPluLjmkq3mlL7ml7bpmpDol4/mj5DnpLpcbiAgLy8g5o+Q56S655So5oi35pKt5pS+6ZSZ6K+vXG4gIGVsc2UgaWYgKHJlcy50eXBlID09PSAnZXJyb3InKSB7XG4gICAgJHd4LnRpcCgn6KeG6aKR5Yqg6L295Ye66ZSZJyk7XG5cbiAgICAvLyDosIPor5VcbiAgICB3eC5yZXBvcnRNb25pdG9yKCc1JywgMSk7XG4gICAgbG9nZ2VyLndhcm4oJ+inhumikeWKoOi9veWHuumUmScpO1xuICB9XG59O1xuXG4vKipcbiAqIOe7hOS7tuWHveaVsFxuICpcbiAqIEBwYXJhbSByZXMg57uE5Lu25Y+C5pWwXG4gKiBAcGFyYW0gY3R4IOmhtemdouaMh+mSiFxuICogQHBhcmFtIGNhbGxiYWNrIOWbnuiwg+WHveaVsFxuICovXG5jb25zdCBjb21wb25lbnRBY3Rpb24gPSAocmVzOiBhbnksIGN0eDogYW55LCBjYWxsYmFjaz86ICh0eXBlPzogc3RyaW5nKSA9PiB2b2lkKSA9PiB7XG4gIHN3aXRjaCAocmVzLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5hY3Rpb24pIHsgLy8g5Yik5patYWN0aW9u57G75Z6L5bm26LCD55So5ZCE57uE5Lu25Ye95pWwXG4gICAgY2FzZSAnaW1nJzogaW1hZ2UocmVzLCBjdHgpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnbmF2aWdhdGUnOlxuICAgICAgY3R4LiRyb3V0ZShyZXMuY3VycmVudFRhcmdldC5kYXRhc2V0LnVybCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdiYWNrJzogY3R4LiRiYWNrKCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdzaGFyZSc6IHNoYXJlKHJlcywgY3R4KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2RvYyc6IGRvY3VtZW50SGFuZGxlcihyZXMpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAncGhvbmUnOiBwaG9uZShyZXMsIGN0eCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdwaWNrZXInOiBwaWNrZXIocmVzLCBjdHgsIGNhbGxiYWNrKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3N3aXRjaCc6IFN3aXRjaChyZXMsIGN0eCwgY2FsbGJhY2spO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc2xpZGVyJzogc2xpZGVyKHJlcywgY3R4LCBjYWxsYmFjayk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICd2aWRlbyc6IHZpZGVvKHJlcyk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdsaXN0JzogbGlzdChyZXMsIGN0eCk7XG4gICAgICBicmVhaztcblxuICAgIC8vIOaJvuS4jeWIsOWvueW6lOWHveaVsO+8jOmUmeivr+aKpeitplxuICAgIGRlZmF1bHQ6XG4gICAgICBjb25zb2xlLndhcm4oJ0NvbXBvbmVudEFjdGlvbiBlcnJvcicpO1xuICAgICAgbG9nZ2VyLndhcm4oJ0NvbXBvbmVudEFjdGlvbiBlcnJvcicpO1xuICAgICAgd3gucmVwb3J0TW9uaXRvcignMTEnLCAxKTtcbiAgfVxufTtcblxuLyoqXG4gKiDlr7zoiKrmoI/liqjmgIHmlLnlj5hcbiAqXG4gKiBAcGFyYW0gb3B0aW9uIOe7hOS7tuWPguaVsFxuICogQHBhcmFtIGN0eCDpobXpnaLmjIfpkohcbiAqL1xuY29uc3QgY2hhbmdlTmF2ID0gKG9wdGlvbjogYW55LCBjdHg6IGFueSkgPT4ge1xuICBjb25zdCB7IDA6IHBhZ2VIZWFkIH0gPSBjdHguZGF0YS5wYWdlO1xuICBsZXQgdGl0bGVEaXNwbGF5O1xuICBsZXQgYm9yZGVyRGlzcGxheTtcbiAgbGV0IHNoYWRvdztcblxuICAvLyDliKTmlq3mg4XlhrXlubbotYvlgLxcbiAgaWYgKG9wdGlvbi5zY3JvbGxUb3AgPD0gMSkgdGl0bGVEaXNwbGF5ID0gYm9yZGVyRGlzcGxheSA9IHNoYWRvdyA9IGZhbHNlO1xuICBlbHNlIGlmIChvcHRpb24uc2Nyb2xsVG9wIDw9IDQyKSB7XG4gICAgdGl0bGVEaXNwbGF5ID0gYm9yZGVyRGlzcGxheSA9IGZhbHNlO1xuICAgIHNoYWRvdyA9IHRydWU7XG4gIH0gZWxzZSBpZiAob3B0aW9uLnNjcm9sbFRvcCA+PSA1MykgdGl0bGVEaXNwbGF5ID0gYm9yZGVyRGlzcGxheSA9IHNoYWRvdyA9IHRydWU7XG4gIGVsc2Uge1xuICAgIHRpdGxlRGlzcGxheSA9IHNoYWRvdyA9IHRydWU7XG4gICAgYm9yZGVyRGlzcGxheSA9IGZhbHNlO1xuICB9XG5cbiAgLy8g5Yik5pat57uT5p6c5bm25pu05paw55WM6Z2i5pWw5o2uXG4gIGlmIChwYWdlSGVhZC50aXRsZURpc3BsYXkgIT09IHRpdGxlRGlzcGxheSkgY3R4LnNldERhdGEoeyAncGFnZVswXS50aXRsZURpc3BsYXknOiB0aXRsZURpc3BsYXkgfSk7XG4gIGVsc2UgaWYgKHBhZ2VIZWFkLmJvcmRlckRpc3BsYXkgIT09IGJvcmRlckRpc3BsYXkpIGN0eC5zZXREYXRhKHsgJ3BhZ2VbMF0uYm9yZGVyRGlzcGxheSc6IGJvcmRlckRpc3BsYXkgfSk7XG4gIGVsc2UgaWYgKHBhZ2VIZWFkLnNoYWRvdyAhPT0gc2hhZG93KSBjdHguc2V0RGF0YSh7ICdwYWdlWzBdLnNoYWRvdyc6IHNoYWRvdyB9KTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgbmF2OiBjaGFuZ2VOYXYsXG4gIHRyaWdnZXI6IGNvbXBvbmVudEFjdGlvblxufTtcbiJdfQ==