"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var wxpage_1 = require("wxpage");
var component_1 = require("../utils/component");
var page_1 = require("../utils/page");
wxpage_1.default('cal', {
    data: {
        page: [
            { tag: 'head', title: '绩点计算(beta)', leftText: '功能大厅' },
            { tag: 'title', text: '绩点计算器' }
        ],
        grade: [],
        totalCredit: null,
        gradePointAverage: null,
        editText: '编辑',
        display: false
    },
    onLoad: function (option) {
        page_1.default.Set({ option: option, ctx: this });
        var _a = page_1.default.color(false), nc = _a.nc, bc = _a.bc;
        wx.setNavigationBarColor(nc);
        wx.setBackgroundColor(bc);
    },
    addNew: function () {
        var length = this.data.grade.length;
        var gradeNew = this.data.grade.concat({
            id: length,
            course: null,
            courseFocus: false,
            grade: null,
            gradeFocus: false,
            credit: null,
            creditFocus: false
        });
        this.setData({ grade: gradeNew });
    },
    input: function (e) {
        console.log(e);
        var grade = this.data.grade;
        var id = e.currentTarget.dataset.id;
        var target = e.currentTarget.dataset.class;
        grade[id][target + "Focus"] = true;
        console.log(e.detail.value.length);
        if (Number(e.detail.value))
            grade[id][target] = Number(e.detail.value);
        else
            grade[id][target] = e.detail.value;
        console.log(grade);
        this.setData({ grade: grade });
    },
    next: function (e) {
        var grade = this.data.grade;
        var id = e.currentTarget.dataset.id;
        grade[id].gradeFocus = true;
        this.setData({ grade: grade });
    },
    edit: function () {
        var editText = this.data.display ? '编辑' : '完成';
        this.setData({
            display: !this.data.display,
            editText: editText
        });
    },
    sort: function (e) {
        console.log(e);
    },
    remove: function (e) {
        console.log(e);
        var currentID = e.target.id[e.target.id.length - 1];
        var grade = this.data.grade;
        console.log("currentID\u662F" + currentID + ";grade\u662F" + grade);
        grade.splice(currentID, 1);
        console.log("\u65B0grade\u662F" + grade);
        for (var i = 0; i < grade.length; i++)
            grade[i].id = i;
        this.setData({ grade: grade });
    },
    calculate: function () {
        var _this = this;
        var courseNumber = this.data.grade.length;
        console.log("\u8BFE\u7A0B\u6570\u662F" + courseNumber);
        var totalCredit = 0;
        var totalGradeCal = 0;
        var flunkingCredit = 0;
        var flunkingGradeCal = 0;
        for (var i = 0; i < courseNumber; i++) {
            var grade = this.data.grade[i].grade;
            var credit = this.data.grade[i].credit;
            if (grade !== 0 && grade && credit && credit !== 0)
                if (grade < 60) {
                    flunkingCredit = credit + flunkingCredit;
                    if (grade > 50)
                        flunkingGradeCal = (grade - 50) / 10 * credit + flunkingGradeCal;
                }
                else {
                    totalCredit = credit + totalCredit;
                    totalGradeCal = (grade - 50) / 10 * credit + totalGradeCal;
                }
        }
        console.log("\u603B\u5B66\u5206\u662F" + totalCredit);
        console.log("\u603B\u8BA1\u7B97\u662F" + totalGradeCal);
        console.log("\u6302\u79D1\u5B66\u5206\u662F" + flunkingCredit);
        console.log("\u603B\u6302\u79D1\u8BA1\u7B97\u662F" + flunkingGradeCal);
        if (Number(flunkingCredit) === 0) {
            console.log('都及格了');
            this.setData({
                totalCredit: totalCredit,
                gradePointAverage: totalGradeCal / totalCredit
            });
            console.log(totalCredit);
            console.log(totalGradeCal / totalCredit);
        }
        else
            wx.showModal({
                title: '请选择计算方式',
                content: '平均绩点是否包含未达到60的成绩？\n★为建议项',
                cancelText: '包含',
                cancelColor: '#ff0000',
                confirmText: '排除★',
                success: function (res) {
                    if (res.cancel) {
                        totalCredit += flunkingCredit;
                        totalGradeCal += flunkingGradeCal;
                        console.log('不及格学分成绩被计入');
                        console.log("\u65B0\u603B\u5B66\u5206\u662F" + totalCredit);
                        console.log("\u65B0\u603B\u8BA1\u7B97\u662F" + totalGradeCal);
                    }
                    else if (res.confirm)
                        console.log('都及格了');
                    _this.setData({ totalCredit: totalCredit, gradePointAverage: totalGradeCal / totalCredit });
                }
            });
    },
    onPageScroll: function (e) {
        component_1.default.nav(e, this);
    },
    cA: function (e) {
        component_1.default.trigger(e, this);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2FsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBT0EsaUNBQStCO0FBQy9CLGdEQUE0QztBQUM1QyxzQ0FBa0M7QUFFbEMsZ0JBQVMsQ0FBQyxLQUFLLEVBQUU7SUFDZixJQUFJLEVBQUU7UUFDSixJQUFJLEVBQUU7WUFDSixFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFO1lBQ3RELEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFO1NBQ2hDO1FBQ0QsS0FBSyxFQUFFLEVBQUU7UUFFVCxXQUFXLEVBQUUsSUFBSTtRQUNqQixpQkFBaUIsRUFBRSxJQUFJO1FBQ3ZCLFFBQVEsRUFBRSxJQUFJO1FBQ2QsT0FBTyxFQUFFLEtBQUs7S0FDZjtJQUNELE1BQU0sRUFBTixVQUFPLE1BQVc7UUFDaEIsY0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLE1BQU0sUUFBQSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBRzNCLElBQUEsZ0NBQStCLEVBQTdCLFVBQUUsRUFBRSxVQUF5QixDQUFDO1FBRXRDLEVBQUUsQ0FBQyxxQkFBcUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM3QixFQUFFLENBQUMsa0JBQWtCLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUNELE1BQU0sRUFBTjtRQUNVLElBQUEsK0JBQU0sQ0FBcUI7UUFFbkMsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO1lBQ3RDLEVBQUUsRUFBRSxNQUFNO1lBQ1YsTUFBTSxFQUFFLElBQUk7WUFDWixXQUFXLEVBQUUsS0FBSztZQUNsQixLQUFLLEVBQUUsSUFBSTtZQUNYLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLE1BQU0sRUFBRSxJQUFJO1lBQ1osV0FBVyxFQUFF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LENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBQ0QsRUFBRSxFQUFGLFVBQUcsQ0FBTTtRQUNQLG1CQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM5QixDQUFDO0NBQ0YsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIEBBdXRob3I6IE1yLkhvcGVcbiAqIEBEYXRlOiAyMDE5LTA2LTI0IDIzOjQ3OjIxXG4gKiBATGFzdEVkaXRvcnM6IE1yLkhvcGVcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMDYtMjQgMjM6NTQ6NTBcbiAqIEBEZXNjcmlwdGlvbjog57up54K56K6h566XXG4gKi9cbmltcG9ydCAkcmVnaXN0ZXIgZnJvbSAnd3hwYWdlJztcbmltcG9ydCAkY29tcG9uZW50IGZyb20gJy4uL3V0aWxzL2NvbXBvbmVudCc7XG5pbXBvcnQgJHBhZ2UgZnJvbSAnLi4vdXRpbHMvcGFnZSc7XG5cbiRyZWdpc3RlcignY2FsJywge1xuICBkYXRhOiB7XG4gICAgcGFnZTogW1xuICAgICAgeyB0YWc6ICdoZWFkJywgdGl0bGU6ICfnu6nngrnorqHnrpcoYmV0YSknLCBsZWZ0VGV4dDogJ+WKn+iDveWkp+WOhScgfSxcbiAgICAgIHsgdGFnOiAndGl0bGUnLCB0ZXh0OiAn57up54K56K6h566X5ZmoJyB9XG4gICAgXSxcbiAgICBncmFkZTogW10sXG4gICAgLy8g5Zyo6L+Z6YeM5b+F6aG75a6a5LmJ5LiA5LiqZ3JhZGXnmoTnqbrmlbDnu4RcbiAgICB0b3RhbENyZWRpdDogbnVsbCxcbiAgICBncmFkZVBvaW50QXZlcmFnZTogbnVsbCxcbiAgICBlZGl0VGV4dDogJ+e8lui+kScsXG4gICAgZGlzcGxheTogZmFsc2VcbiAgfSxcbiAgb25Mb2FkKG9wdGlvbjogYW55KSB7XG4gICAgJHBhZ2UuU2V0KHsgb3B0aW9uLCBjdHg6IHRoaXMgfSk7XG5cbiAgICAvLyDorr7nva7og7blm4rlkozog4zmma/popzoibJcbiAgICBjb25zdCB7IG5jLCBiYyB9ID0gJHBhZ2UuY29sb3IoZmFsc2UpO1xuXG4gICAgd3guc2V0TmF2aWdhdGlvbkJhckNvbG9yKG5jKTtcbiAgICB3eC5zZXRCYWNrZ3JvdW5kQ29sb3IoYmMpO1xuICB9LFxuICBhZGROZXcoKSB7XG4gICAgY29uc3QgeyBsZW5ndGggfSA9IHRoaXMuZGF0YS5ncmFkZTtcbiAgICAvLyDojrflj5ZncmFkZeWGheWMheWQq+eahOS4quaVsO+8jOS7peS+v+eUn+aIkOaWsOeahGlkXG4gICAgY29uc3QgZ3JhZGVOZXcgPSB0aGlzLmRhdGEuZ3JhZGUuY29uY2F0KHtcbiAgICAgIGlkOiBsZW5ndGgsXG4gICAgICBjb3Vyc2U6IG51bGwsXG4gICAgICBjb3Vyc2VGb2N1czogZmFsc2UsXG4gICAgICBncmFkZTogbnVsbCxcbiAgICAgIGdyYWRlRm9jdXM6IGZhbHNlLFxuICAgICAgY3JlZGl0OiBudWxsLFxuICAgICAgY3JlZGl0Rm9jdXM6IGZhbHNlXG4gICAgfSk7XG5cbiAgICAvLyDlkJFncmFkZeacgOWQjuaPkuWFpeS4gOS4quaWsOWFg+e0oFxuICAgIHRoaXMuc2V0RGF0YSEoeyBncmFkZTogZ3JhZGVOZXcgfSk7XG4gICAgLy8g5a+5ZGF0Yei1i+WAvFxuICB9LFxuICBpbnB1dChlOiBhbnkpIHtcbiAgICBjb25zb2xlLmxvZyhlKTtcbiAgICBjb25zdCB7IGdyYWRlIH0gPSB0aGlzLmRhdGE7XG5cbiAgICAvKlxuICAgICAqIOiOt+WPlmdyYWRlXG4gICAgICogY29uc29sZS5sb2coTnVtYmVyKGUuZGV0YWlsLnZhbHVlKSk7XG4gICAgICovXG4gICAgY29uc3QgeyBpZCB9ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQ7XG4gICAgY29uc3QgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuY2xhc3M7XG5cbiAgICAvLyDojrflj5bmraPlnKjovpPlhaXnmoTovpPlhaXmoYZpZCAg6I635Y+W5q2j5Zyo6L6T5YWl5a+56LGhXG4gICAgZ3JhZGVbaWRdW2Ake3RhcmdldH1Gb2N1c2BdID0gdHJ1ZTtcbiAgICBjb25zb2xlLmxvZyhlLmRldGFpbC52YWx1ZS5sZW5ndGgpO1xuXG4gICAgLypcbiAgICAgKiBJZiAoZS5kZXRhaWwudmFsdWUubGVuZ3RoIDwgZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQubWF4TGVuZ3RoKSB7XG4gICAgICogICBncmFkZVtpZF1bdGFyZ2V0ICsgJ0ZvY3VzJ10gPSB0cnVlO1xuICAgICAqIH0gZWxzZSB7XG4gICAgICogICBncmFkZVtpZF1bdGFyZ2V0ICsgJ0ZvY3VzJ10gPSBmYWxzZTtcbiAgICAgKiB9XG4gICAgICovXG4gICAgaWYgKE51bWJlcihlLmRldGFpbC52YWx1ZSkpIGdyYWRlW2lkXVt0YXJnZXRdID0gTnVtYmVyKGUuZGV0YWlsLnZhbHVlKTtcbiAgICAvLyDlpoLmnpx2YWx1ZeWPr+S7pei9rOaNouS4um51bWJlcu+8jOW+l+WIsOWvueW6lOivvueoi+eahGdyYWRl5pWw57uE5bm25a+55YW25Lit55qE55u45bqU5a+56LGh6LWL5YC85pWw5a2XXG4gICAgZWxzZSBncmFkZVtpZF1bdGFyZ2V0XSA9IGUuZGV0YWlsLnZhbHVlO1xuICAgIC8vIOWmguaenHZhbHVl5peg5rOV6L2s5o2i5Li6bnVtYmVy77yM5b6X5Yiw5a+55bqU6K++56iL55qEZ3JhZGXmlbDnu4Tlubblr7nlhbbkuK3nmoTnm7jlupTlr7nosaHotYvlgLzlrZfnrKZcbiAgICBjb25zb2xlLmxvZyhncmFkZSk7XG4gICAgdGhpcy5zZXREYXRhISh7IGdyYWRlIH0pO1xuICAgIC8vIOWwhuaWsOWAvOWGmeWbnmRhdGHkuK1cbiAgfSxcbiAgbmV4dChlOiBhbnkpIHtcbiAgICBjb25zdCB7IGdyYWRlIH0gPSB0aGlzLmRhdGE7XG4gICAgY29uc3QgeyBpZCB9ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQ7XG5cbiAgICBncmFkZVtpZF0uZ3JhZGVGb2N1cyA9IHRydWU7XG4gICAgdGhpcy5zZXREYXRhISh7IGdyYWRlIH0pO1xuICB9LFxuICBlZGl0KCkge1xuICAgIGNvbnN0IGVkaXRUZXh0ID0gdGhpcy5kYXRhLmRpc3BsYXkgPyAn57yW6L6RJyA6ICflrozmiJAnO1xuXG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBkaXNwbGF5OiAhdGhpcy5kYXRhLmRpc3BsYXksXG4gICAgICBlZGl0VGV4dFxuICAgIH0pO1xuICB9LFxuICBzb3J0KGU6IGFueSkge1xuICAgIGNvbnNvbGUubG9nKGUpO1xuICB9LFxuICByZW1vdmUoZTogYW55KSB7XG4gICAgY29uc29sZS5sb2coZSk7XG4gICAgY29uc3QgY3VycmVudElEID0gZS50YXJnZXQuaWRbZS50YXJnZXQuaWQubGVuZ3RoIC0gMV07XG4gICAgY29uc3QgeyBncmFkZSB9ID0gdGhpcy5kYXRhO1xuXG4gICAgY29uc29sZS5sb2coYGN1cnJlbnRJROaYryR7Y3VycmVudElEfTtncmFkZeaYryR7Z3JhZGV9YCk7XG4gICAgZ3JhZGUuc3BsaWNlKGN1cnJlbnRJRCwgMSk7XG4gICAgY29uc29sZS5sb2coYOaWsGdyYWRl5pivJHtncmFkZX1gKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdyYWRlLmxlbmd0aDsgaSsrKVxuICAgICAgZ3JhZGVbaV0uaWQgPSBpO1xuXG4gICAgLy8g6YeN5paw6K6+5a6aaWRcbiAgICB0aGlzLnNldERhdGEhKHsgZ3JhZGUgfSk7XG4gIH0sXG4gIGNhbGN1bGF0ZSgpIHtcbiAgICBjb25zdCBjb3Vyc2VOdW1iZXIgPSB0aGlzLmRhdGEuZ3JhZGUubGVuZ3RoO1xuXG4gICAgLy8g6I635b6X6K++56iL5pWwXG4gICAgY29uc29sZS5sb2coYOivvueoi+aVsOaYryR7Y291cnNlTnVtYmVyfWApO1xuXG4gICAgbGV0IHRvdGFsQ3JlZGl0ID0gMDtcbiAgICBsZXQgdG90YWxHcmFkZUNhbCA9IDA7XG4gICAgbGV0IGZsdW5raW5nQ3JlZGl0ID0gMDtcbiAgICBsZXQgZmx1bmtpbmdHcmFkZUNhbCA9IDA7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdXJzZU51bWJlcjsgaSsrKSB7XG4gICAgICBjb25zdCB7IGdyYWRlIH0gPSB0aGlzLmRhdGEuZ3JhZGVbaV07XG4gICAgICBjb25zdCB7IGNyZWRpdCB9ID0gdGhpcy5kYXRhLmdyYWRlW2ldO1xuXG4gICAgICBpZiAoZ3JhZGUgIT09IDAgJiYgZ3JhZGUgJiYgY3JlZGl0ICYmIGNyZWRpdCAhPT0gMClcbiAgICAgICAgLy8g5Yik5patZ3JhZGXlkoxjcmVkaXTmmK/lkKblnYfmnInlgLxcbiAgICAgICAgaWYgKGdyYWRlIDwgNjApIHtcbiAgICAgICAgICAvLyDljZXni6zliJflh7rkuI3lj4rmoLznmoTlrabliIblkozmiJDnu6ks5LiU5Y+q5pyJ5aSn5LqONTDliIbnu6nngrnkuLrmraPlgLzmiY3orqHnrpfjgIJcbiAgICAgICAgICBmbHVua2luZ0NyZWRpdCA9IGNyZWRpdCArIGZsdW5raW5nQ3JlZGl0O1xuICAgICAgICAgIGlmIChncmFkZSA+IDUwKVxuICAgICAgICAgICAgZmx1bmtpbmdHcmFkZUNhbCA9IChncmFkZSAtIDUwKSAvIDEwICogY3JlZGl0ICsgZmx1bmtpbmdHcmFkZUNhbDtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIOWPiuagvOeahOWtpuWIhuWSjOaIkOe7qVxuICAgICAgICAgIHRvdGFsQ3JlZGl0ID0gY3JlZGl0ICsgdG90YWxDcmVkaXQ7XG4gICAgICAgICAgdG90YWxHcmFkZUNhbCA9IChncmFkZSAtIDUwKSAvIDEwICogY3JlZGl0ICsgdG90YWxHcmFkZUNhbDtcbiAgICAgICAgfVxuXG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGDmgLvlrabliIbmmK8ke3RvdGFsQ3JlZGl0fWApO1xuICAgIGNvbnNvbGUubG9nKGDmgLvorqHnrpfmmK8ke3RvdGFsR3JhZGVDYWx9YCk7XG4gICAgY29uc29sZS5sb2coYOaMguenkeWtpuWIhuaYryR7Zmx1bmtpbmdDcmVkaXR9YCk7XG4gICAgY29uc29sZS5sb2coYOaAu+aMguenkeiuoeeul+aYryR7Zmx1bmtpbmdHcmFkZUNhbH1gKTtcbiAgICBpZiAoTnVtYmVyKGZsdW5raW5nQ3JlZGl0KSA9PT0gMCkge1xuICAgICAgY29uc29sZS5sb2coJ+mDveWPiuagvOS6hicpO1xuICAgICAgLy8g5aaC5p6c6YO95Y+K5qC85LuA5LmI5Lmf5LiN5YGaXG4gICAgICB0aGlzLnNldERhdGEhKHtcbiAgICAgICAgdG90YWxDcmVkaXQsXG4gICAgICAgIGdyYWRlUG9pbnRBdmVyYWdlOiB0b3RhbEdyYWRlQ2FsIC8gdG90YWxDcmVkaXRcbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5sb2codG90YWxDcmVkaXQpO1xuICAgICAgY29uc29sZS5sb2codG90YWxHcmFkZUNhbCAvIHRvdGFsQ3JlZGl0KTtcbiAgICAgIC8vIOWQkWRhdGHotYvlgLzorqHnrpfnu5PmnpxcbiAgICB9IGVsc2Ugd3guc2hvd01vZGFsKHtcbiAgICAgIC8vIOW8ueeql+iuqeeUqOaIt+mAieaLqVxuICAgICAgdGl0bGU6ICfor7fpgInmi6norqHnrpfmlrnlvI8nLFxuICAgICAgY29udGVudDogJ+W5s+Wdh+e7qeeCueaYr+WQpuWMheWQq+acqui+vuWIsDYw55qE5oiQ57up77yfXFxu4piF5Li65bu66K6u6aG5JyxcbiAgICAgIGNhbmNlbFRleHQ6ICfljIXlkKsnLFxuICAgICAgY2FuY2VsQ29sb3I6ICcjZmYwMDAwJyxcbiAgICAgIGNvbmZpcm1UZXh0OiAn5o6S6Zmk4piFJyxcbiAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XG4gICAgICAgIGlmIChyZXMuY2FuY2VsKSB7XG4gICAgICAgICAgLy8g5YyF5ZCr5LiN5Y+K5qC85oiQ57upXG4gICAgICAgICAgdG90YWxDcmVkaXQgKz0gZmx1bmtpbmdDcmVkaXQ7XG4gICAgICAgICAgdG90YWxHcmFkZUNhbCArPSBmbHVua2luZ0dyYWRlQ2FsO1xuICAgICAgICAgIC8vIOWGmeWFpeS4jeWPiuagvOWtpuWIhuS4juaIkOe7qeiuoeeul1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfkuI3lj4rmoLzlrabliIbmiJDnu6nooqvorqHlhaUnKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg5paw5oC75a2m5YiG5pivJHt0b3RhbENyZWRpdH1gKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg5paw5oC76K6h566X5pivJHt0b3RhbEdyYWRlQ2FsfWApO1xuICAgICAgICB9IGVsc2UgaWYgKHJlcy5jb25maXJtKVxuICAgICAgICAgIGNvbnNvbGUubG9nKCfpg73lj4rmoLzkuoYnKTtcblxuICAgICAgICAvKlxuICAgICAgICAgKiDkuI3ljIXlkKvkuI3lj4rmoLzmiJDnu6nvvIzku4DkuYjpg73kuI3lgZpcbiAgICAgICAgICogY29uc29sZS5sb2codG90YWxDcmVkaXQpXG4gICAgICAgICAqIGNvbnNvbGUubG9nKHRvdGFsR3JhZGVDYWwgLyB0b3RhbENyZWRpdClcbiAgICAgICAgICovXG4gICAgICAgIC8vIOWQkWRhdGHotYvlgLzorqHnrpfnu5PmnpxcbiAgICAgICAgdGhpcy5zZXREYXRhISh7IHRvdGFsQ3JlZGl0LCBncmFkZVBvaW50QXZlcmFnZTogdG90YWxHcmFkZUNhbCAvIHRvdGFsQ3JlZGl0IH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gIH0sXG4gIG9uUGFnZVNjcm9sbChlKSB7XG4gICAgJGNvbXBvbmVudC5uYXYoZSwgdGhpcyk7XG4gIH0sXG4gIGNBKGU6IGFueSkge1xuICAgICRjb21wb25lbnQudHJpZ2dlcihlLCB0aGlzKTtcbiAgfVxufSk7XG4iXX0=