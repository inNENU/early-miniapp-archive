"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var wxpage_1 = require("wxpage");
var component_1 = require("../utils/component");
var file_1 = require("../utils/file");
var page_1 = require("../utils/page");
var wx_1 = require("../utils/wx");
var a = getApp().globalData;
var manager = wx.getBackgroundAudioManager();
wxpage_1.default('music', {
    data: {
        canplay: false,
        currentTime: 0,
        songLength: 1,
        currentSong: {},
        songListDisplay: false
    },
    onNavigate: function () {
        var songList = file_1.default.readJson('function/song');
        if (!songList)
            wx_1.default.request('function/song', function (data) {
                file_1.default.writeJson('function', 'song', data);
            });
    },
    onLoad: function (option) {
        var _this = this;
        wx.loadFontFace({
            family: 'FZSSJW', source: 'url("https://mp.nenuyouth.com/fonts/FZSSJW.ttf")',
            complete: function (res) {
                console.log('宋体字体', res);
            }
        });
        var currentSong;
        if (option.index)
            a.music.index = option.index;
        var index = a.music.index;
        var songList = file_1.default.readJson('function/song');
        var mode = wx.getStorageSync('playMode');
        this.setData({
            share: option.share ? option.share : false,
            index: index,
            info: a.info,
            nm: a.nm,
            play: a.music.play,
            mode: mode ? mode : (wx.setStorageSync('playMode', 0), 0)
        });
        if (songList) {
            currentSong = songList[index];
            this.setData({ songList: songList, currentSong: currentSong });
            if (a.music.played)
                this.setData({ canplay: true });
            else {
                manager.epname = 'NenuYouth';
                manager.src = currentSong.src;
                manager.title = currentSong.title;
                manager.singer = currentSong.singer;
                manager.coverImgUrl = currentSong.cover;
            }
        }
        else
            wx_1.default.request('function/song', function (data) {
                currentSong = data[index];
                _this.setData({ songList: data, currentSong: currentSong });
                if (a.music.played)
                    _this.setData({ canplay: true });
                else {
                    manager.epname = 'NenuYouth';
                    manager.src = currentSong.src;
                    manager.title = currentSong.title;
                    manager.singer = currentSong.singer;
                    manager.coverImgUrl = currentSong.cover;
                }
                file_1.default.writeJson('function', 'song', data);
            });
        manager.onCanplay(function () {
            setTimeout(function () {
                console.log('Canplay');
                _this.setData({ canplay: true });
            }, 100);
        });
        manager.onPlay(function () {
            _this.setData({ play: true });
            a.music.play = true;
        });
        manager.onPause(function () {
            _this.setData({ play: false });
            a.music.play = false;
        });
        manager.onTimeUpdate(function () {
            var presentSecond = Math.round(manager.currentTime % 60).toString();
            var totalSecond = Math.round(manager.duration % 60).toString();
            _this.setData({
                songLength: Math.round(manager.duration * 100) / 100,
                total: [
                    Math.round(manager.duration / 60).toString(),
                    totalSecond.length === 1 ? "0" + totalSecond : totalSecond
                ],
                currentTime: Math.round(manager.currentTime * 100) / 100,
                present: [
                    Math.round(manager.currentTime / 60).toString(),
                    presentSecond.length === 1 ? "0" + presentSecond : presentSecond
                ],
                bufferedTime: manager.buffered,
                canplay: true
            });
            a.music.played = true;
        });
        manager.onWaiting(function () {
            console.warn('waiting');
            _this.setData({ canplay: false });
        });
        manager.onPrev(function () {
            _this.previous();
        });
        manager.onEnded(function () {
            _this.end();
        });
        manager.onNext(function () {
            _this.next();
        });
        manager.onError(function () {
            wx_1.default.tip('获取音乐出错，请稍后重试');
        });
        var _a = page_1.default.color(false), nc = _a.nc, bc = _a.bc;
        wx.setNavigationBarColor(nc);
        wx.setBackgroundColor(bc);
        page_1.default.Notice('music');
    },
    loadCover: function (event) {
        if (event.type === 'load')
            this.setData({ coverLoad: true });
    },
    play: function () {
        if (this.data.play)
            manager.pause();
        else
            manager.play();
    },
    drag: function (event) {
        manager.seek(event.detail.value / 100);
        if (event.type === 'change') {
            this.setData({ currentTime: event.detail.value / 100 });
            console.log(event.detail.value);
        }
    },
    end: function () {
        var index = this.data.index;
        var total = this.data.songList.length;
        switch (this.data.mode) {
            case 3:
                var temp = void 0;
                do
                    temp = Math.round(Math.random() * total - 0.5);
                while (index === temp);
                index = temp;
                break;
            case 2:
                index = index + 1 === total ? 'stop' : index + 1;
                wx_1.default.tip('播放完毕');
                break;
            case 1:
                break;
            case 0:
            default: index = index + 1 === total ? 0 : index + 1;
        }
        this.Switch(index);
    },
    next: function () {
        var index = this.data.index;
        var total = this.data.songList.length;
        switch (this.data.mode) {
            case 3:
                var temp = void 0;
                do
                    temp = Math.round(Math.random() * total - 0.5);
                while (index === temp);
                index = temp;
                break;
            case 2:
                if (index + 1 === total) {
                    index = 'nothing';
                    wx_1.default.tip('已是最后一曲');
                }
                else
                    index += 1;
                break;
            case 1:
            case 0:
            default: index = index + 1 === total ? 0 : index + 1;
        }
        this.Switch(index);
    },
    previous: function () {
        var index = this.data.index;
        var total = this.data.songList.length;
        switch (this.data.mode) {
            case 3:
                var temp = void 0;
                do
                    temp = Math.round(Math.random() * total - 0.5);
                while (index === temp);
                index = temp;
                break;
            case 2:
                if (index === 0) {
                    index = 'nothing';
                    wx_1.default.tip('已是第一曲');
                }
                else
                    index -= 1;
                break;
            case 1:
            case 0:
            default: index = index === 0 ? total - 1 : index - 1;
        }
        this.Switch(index);
    },
    Switch: function (index) {
        if (index === 'stop') {
            this.setData({
                play: false,
                canPlay: false
            });
            manager.stop();
        }
        else if (index !== 'nothing') {
            var currentSong = this.data.songList[index];
            this.setData({
                index: index,
                currentSong: currentSong,
                play: false,
                canPlay: false
            });
            manager.src = currentSong.src;
            manager.title = currentSong.title;
            manager.singer = currentSong.singer;
            manager.coverImgUrl = currentSong.cover;
            a.music.index = index;
        }
    },
    modeSwitch: function () {
        var modeName;
        var mode = this.data.mode === 3 ? 0 : this.data.mode + 1;
        this.setData({ mode: mode });
        switch (mode) {
            case 1:
                modeName = '单曲循环';
                break;
            case 2:
                modeName = '顺序播放';
                break;
            case 3:
                modeName = '随机播放';
                break;
            case 0:
            default:
                modeName = '列表循环';
        }
        wx.setStorageSync('playMode', mode);
        wx_1.default.tip(modeName + "\u6A21\u5F0F");
    },
    list: function () {
        this.setData({ songListDisplay: !this.data.songListDisplay });
    },
    change: function (res) {
        this.list();
        this.Switch(res.currentTarget.dataset.index);
    },
    cA: function (e) {
        component_1.default.trigger(e, this);
    },
    onShareAppMessage: function () {
        return {
            title: this.data.title,
            path: "/function/player?index=" + this.data.index + "&share=true"
        };
    },
    redirect: function () {
        wx.switchTab({ url: '/page/main' });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicGxheWVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBT0EsaUNBQStCO0FBQy9CLGdEQUE0QztBQUM1QyxzQ0FBa0M7QUFDbEMsc0NBQWtDO0FBQ2xDLGtDQUE4QjtBQUN0QixJQUFBLHVCQUFhLENBQWM7QUFDbkMsSUFBTSxPQUFPLEdBQUcsRUFBRSxDQUFDLHlCQUF5QixFQUFFLENBQUM7QUFFL0MsZ0JBQVMsQ0FBQyxPQUFPLEVBQUU7SUFDakIsSUFBSSxFQUFFO1FBQ0osT0FBTyxFQUFFLEtBQUs7UUFDZCxXQUFXLEVBQUUsQ0FBQztRQUNkLFVBQVUsRUFBRSxDQUFDO1FBQ2IsV0FBVyxFQUFFLEVBQUU7UUFDZixlQUFlLEVBQUUsS0FBSztLQUN2QjtJQUNELFVBQVUsRUFBVjtRQUNFLElBQU0sUUFBUSxHQUFHLGNBQUssQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLENBQUM7UUFFakQsSUFBSSxDQUFDLFFBQVE7WUFBRSxZQUFHLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxVQUFDLElBQVM7Z0JBRXBELGNBQUssQ0FBQyxTQUFTLENBQUMsVUFBVSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztZQUM1QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFDRCxNQUFNLEVBQU4sVUFBTyxNQUFXO1FBQWxCLGlCQWtKQztRQWhKQyxFQUFFLENBQUMsWUFBWSxDQUFDO1lBQ2QsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsa0RBQWtEO1lBQzVFLFFBQVEsRUFBRSxVQUFBLEdBQUc7Z0JBQ1gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDM0IsQ0FBQztTQUNGLENBQUMsQ0FBQztRQUVILElBQUksV0FBVyxDQUFDO1FBRWhCLElBQUksTUFBTSxDQUFDLEtBQUs7WUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxN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R0FBRyxNQUFNLENBQUM7Z0JBQ3hCLE1BQU07WUFDUixLQUFLLENBQUMsQ0FBQztZQUNQO2dCQUNFLFFBQVEsR0FBRyxNQUFNLENBQUM7U0FDckI7UUFDRCxFQUFFLENBQUMsY0FBYyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNwQyxZQUFHLENBQUMsR0FBRyxDQUFJLFFBQVEsaUJBQUksQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFDRCxJQUFJLEVBQUo7UUFDRSxJQUFJLENBQUMsT0FBUSxDQUFDLEVBQUUsZUFBZSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDO0lBQ2pFLENBQUM7SUFDRCxNQUFNLEVBQU4sVUFBTyxHQUFRO1FBQ2IsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ1osSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBQ0QsRUFBRSxFQUFGLFVBQUcsQ0FBTTtRQUNQLG1CQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBQ0QsaUJBQWlCO1FBQ2YsT0FBTztZQUNMLEtBQUssRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUs7WUFDdEIsSUFBSSxFQUFFLDRCQUEwQixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssZ0JBQWE7U0FDN0QsQ0FBQztJQUNKLENBQUM7SUFDRCxRQUFRO1FBQ04sRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7Q0FDRixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQEF1dGhvcjogTXIuSG9wZVxuICogQERhdGU6IDIwMTktMDYtMjQgMjE6MjA6NTdcbiAqIEBMYXN0RWRpdG9yczogTXIuSG9wZVxuICogQExhc3RFZGl0VGltZTogMjAxOS0wNi0yNCAyMzo1Nzo1MVxuICogQERlc2NyaXB0aW9uOiDpn7PkuZDmkq3mlL7lmahcbiAqL1xuaW1wb3J0ICRyZWdpc3RlciBmcm9tICd3eHBhZ2UnO1xuaW1wb3J0ICRjb21wb25lbnQgZnJvbSAnLi4vdXRpbHMvY29tcG9uZW50JztcbmltcG9ydCAkZmlsZSBmcm9tICcuLi91dGlscy9maWxlJztcbmltcG9ydCAkcGFnZSBmcm9tICcuLi91dGlscy9wYWdlJztcbmltcG9ydCAkbXkgZnJvbSAnLi4vdXRpbHMvd3gnO1xuY29uc3QgeyBnbG9iYWxEYXRhOiBhIH0gPSBnZXRBcHAoKTtcbmNvbnN0IG1hbmFnZXIgPSB3eC5nZXRCYWNrZ3JvdW5kQXVkaW9NYW5hZ2VyKCk7XG5cbiRyZWdpc3RlcignbXVzaWMnLCB7XG4gIGRhdGE6IHtcbiAgICBjYW5wbGF5OiBmYWxzZSxcbiAgICBjdXJyZW50VGltZTogMCxcbiAgICBzb25nTGVuZ3RoOiAxLFxuICAgIGN1cnJlbnRTb25nOiB7fSxcbiAgICBzb25nTGlzdERpc3BsYXk6IGZhbHNlXG4gIH0sXG4gIG9uTmF2aWdhdGUoKSB7XG4gICAgY29uc3Qgc29uZ0xpc3QgPSAkZmlsZS5yZWFkSnNvbignZnVuY3Rpb24vc29uZycpO1xuXG4gICAgaWYgKCFzb25nTGlzdCkgJG15LnJlcXVlc3QoJ2Z1bmN0aW9uL3NvbmcnLCAoZGF0YTogYW55KSA9PiB7XG4gICAgICAvLyDlhpnlhaVKU09O5paH5Lu2XG4gICAgICAkZmlsZS53cml0ZUpzb24oJ2Z1bmN0aW9uJywgJ3NvbmcnLCBkYXRhKTtcbiAgICB9KTtcbiAgfSxcbiAgb25Mb2FkKG9wdGlvbjogYW55KSB7XG4gICAgLy8g5Yqg6L295a2X5L2TXG4gICAgd3gubG9hZEZvbnRGYWNlKHtcbiAgICAgIGZhbWlseTogJ0ZaU1NKVycsIHNvdXJjZTogJ3VybChcImh0dHBzOi8vbXAubmVudXlvdXRoLmNvbS9mb250cy9GWlNTSlcudHRmXCIpJyxcbiAgICAgIGNvbXBsZXRlOiByZXMgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygn5a6L5L2T5a2X5L2TJywgcmVzKTsgLy8g6LCD6K+VXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBsZXQgY3VycmVudFNvbmc7XG5cbiAgICBpZiAob3B0aW9uLmluZGV4KSBhLm11c2ljLmluZGV4ID0gb3B0aW9uLmluZGV4O1xuXG4gICAgY29uc3QgeyBpbmRleCB9ID0gYS5tdXNpYztcbiAgICBjb25zdCBzb25nTGlzdCA9ICRmaWxlLnJlYWRKc29uKCdmdW5jdGlvbi9zb25nJyk7XG4gICAgY29uc3QgbW9kZSA9IHd4LmdldFN0b3JhZ2VTeW5jKCdwbGF5TW9kZScpO1xuXG4gICAgLy8g5YaZ5YWl5Z+65pys5L+h5oGvXG4gICAgdGhpcy5zZXREYXRhISh7XG4gICAgICBzaGFyZTogb3B0aW9uLnNoYXJlID8gb3B0aW9uLnNoYXJlIDogZmFsc2UsXG4gICAgICBpbmRleCxcbiAgICAgIGluZm86IGEuaW5mbyxcbiAgICAgIG5tOiBhLm5tLFxuICAgICAgcGxheTogYS5tdXNpYy5wbGF5LFxuICAgICAgbW9kZTogbW9kZSA/IG1vZGUgOiAod3guc2V0U3RvcmFnZVN5bmMoJ3BsYXlNb2RlJywgMCksIDApXG4gICAgfSk7XG5cblxuICAgIGlmIChzb25nTGlzdCkge1xuICAgICAgLy8g5YaZ5YWl5q2M5puy5YiX6KGo5LiO5b2T5YmN5q2M5puy5L+h5oGvXG4gICAgICBjdXJyZW50U29uZyA9IHNvbmdMaXN0W2luZGV4XTtcbiAgICAgIHRoaXMuc2V0RGF0YSEoeyBzb25nTGlzdCwgY3VycmVudFNvbmcgfSk7XG5cbiAgICAgIC8vIOWmguaenOato+WcqOaSreaUvu+8jOiuvue9ruiDveWkn+aSreaUvlxuICAgICAgaWYgKGEubXVzaWMucGxheWVkKSB0aGlzLnNldERhdGEhKHsgY2FucGxheTogdHJ1ZSB9KTtcblxuICAgICAgLy8g5a+56Z+z6aKR566h55CG5Zmo6L+b6KGM6K6+572uXG4gICAgICBlbHNlIHtcbiAgICAgICAgbWFuYWdlci5lcG5hbWUgPSAnTmVudVlvdXRoJztcbiAgICAgICAgbWFuYWdlci5zcmMgPSBjdXJyZW50U29uZy5zcmM7XG4gICAgICAgIG1hbmFnZXIudGl0bGUgPSBjdXJyZW50U29uZy50aXRsZTtcbiAgICAgICAgbWFuYWdlci5zaW5nZXIgPSBjdXJyZW50U29uZy5zaW5nZXI7XG4gICAgICAgIG1hbmFnZXIuY292ZXJJbWdVcmwgPSBjdXJyZW50U29uZy5jb3ZlcjtcbiAgICAgIH1cblxuICAgICAgLy8g5Zyo57q/6I635Y+W5q2M5puy5YiX6KGoXG4gICAgfSBlbHNlICRteS5yZXF1ZXN0KCdmdW5jdGlvbi9zb25nJywgKGRhdGE6IGFueSkgPT4ge1xuICAgICAgY3VycmVudFNvbmcgPSBkYXRhW2luZGV4XTtcbiAgICAgIHRoaXMuc2V0RGF0YSEoeyBzb25nTGlzdDogZGF0YSwgY3VycmVudFNvbmcgfSk7XG5cbiAgICAgIC8vIOWmguaenOato+WcqOaSreaUvu+8jOiuvue9ruiDveWkn+aSreaUvlxuICAgICAgaWYgKGEubXVzaWMucGxheWVkKSB0aGlzLnNldERhdGEhKHsgY2FucGxheTogdHJ1ZSB9KTtcblxuICAgICAgLy8g5a+56Z+z6aKR566h55CG5Zmo6L+b6KGM6K6+572uXG4gICAgICBlbHNlIHtcbiAgICAgICAgbWFuYWdlci5lcG5hbWUgPSAnTmVudVlvdXRoJztcbiAgICAgICAgbWFuYWdlci5zcmMgPSBjdXJyZW50U29uZy5zcmM7XG4gICAgICAgIG1hbmFnZXIudGl0bGUgPSBjdXJyZW50U29uZy50aXRsZTtcbiAgICAgICAgbWFuYWdlci5zaW5nZXIgPSBjdXJyZW50U29uZy5zaW5nZXI7XG4gICAgICAgIG1hbmFnZXIuY292ZXJJbWdVcmwgPSBjdXJyZW50U29uZy5jb3ZlcjtcbiAgICAgIH1cblxuICAgICAgLy8g5YaZ5YWlSlNPTuaWh+S7tlxuICAgICAgJGZpbGUud3JpdGVKc29uKCdmdW5jdGlvbicsICdzb25nJywgZGF0YSk7XG4gICAgfSk7XG5cbiAgICAvL+OAgOiDveWkn+aSreaUvjEwMG1z5ZCO6K6+572u5Y+v5Lul5pKt5pS+XG4gICAgbWFuYWdlci5vbkNhbnBsYXkoKCkgPT4ge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdDYW5wbGF5Jyk7IC8vIOiwg+ivlVxuICAgICAgICB0aGlzLnNldERhdGEhKHsgY2FucGxheTogdHJ1ZSB9KTtcbiAgICAgIH0sIDEwMClcbiAgICB9KTtcblxuICAgIC8vIOWcqOebuOW6lOWKqOS9nOaXtuaUueWPmOeKtuaAgVxuICAgIG1hbmFnZXIub25QbGF5KCgpID0+IHtcbiAgICAgIHRoaXMuc2V0RGF0YSEoeyBwbGF5OiB0cnVlIH0pO1xuICAgICAgYS5tdXNpYy5wbGF5ID0gdHJ1ZTtcbiAgICB9KTtcblxuICAgIG1hbmFnZXIub25QYXVzZSgoKSA9PiB7XG4gICAgICB0aGlzLnNldERhdGEhKHsgcGxheTogZmFsc2UgfSk7XG4gICAgICBhLm11c2ljLnBsYXkgPSBmYWxzZTtcbiAgICB9KTtcblxuICAgIG1hbmFnZXIub25UaW1lVXBkYXRlKCgpID0+IHtcblxuICAgICAgLypcbiAgICAgICAqIOiwg+ivlVxuICAgICAgICogY29uc29sZS5sb2coYFRpbWVVcGRhdGUsY3VycmVudFRpbWXmmK8ke21hbmFnZXIuY3VycmVudFRpbWV9YCk7XG4gICAgICAgKiBjb25zb2xlLmxvZyhgYnVmZmVyZWRUaW1l5pivJHttYW5hZ2VyLmJ1ZmZlcmVkfSxkdXJhdGlvbuaYryR7bWFuYWdlci5kdXJhdGlvbn1gKTtcbiAgICAgICAqL1xuXG4gICAgICBjb25zdCBwcmVzZW50U2Vjb25kID0gTWF0aC5yb3VuZChtYW5hZ2VyLmN1cnJlbnRUaW1lICUgNjApLnRvU3RyaW5nKCk7XG4gICAgICBjb25zdCB0b3RhbFNlY29uZCA9IE1hdGgucm91bmQobWFuYWdlci5kdXJhdGlvbiAlIDYwKS50b1N0cmluZygpO1xuXG4gICAgICAvLyDmm7TmlrDmrYzmm7Lkv6Hmga9cbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBzb25nTGVuZ3RoOiBNYXRoLnJvdW5kKG1hbmFnZXIuZHVyYXRpb24gKiAxMDApIC8gMTAwLFxuICAgICAgICB0b3RhbDogW1xuICAgICAgICAgIE1hdGgucm91bmQobWFuYWdlci5kdXJhdGlvbiAvIDYwKS50b1N0cmluZygpLFxuICAgICAgICAgIHRvdGFsU2Vjb25kLmxlbmd0aCA9PT0gMSA/IGAwJHt0b3RhbFNlY29uZH1gIDogdG90YWxTZWNvbmRcbiAgICAgICAgXSxcbiAgICAgICAgY3VycmVudFRpbWU6IE1hdGgucm91bmQobWFuYWdlci5jdXJyZW50VGltZSAqIDEwMCkgLyAxMDAsXG4gICAgICAgIHByZXNlbnQ6IFtcbiAgICAgICAgICBNYXRoLnJvdW5kKG1hbmFnZXIuY3VycmVudFRpbWUgLyA2MCkudG9TdHJpbmcoKSxcbiAgICAgICAgICBwcmVzZW50U2Vjb25kLmxlbmd0aCA9PT0gMSA/IGAwJHtwcmVzZW50U2Vjb25kfWAgOiBwcmVzZW50U2Vjb25kXG4gICAgICAgIF0sXG4gICAgICAgIGJ1ZmZlcmVkVGltZTogbWFuYWdlci5idWZmZXJlZCxcbiAgICAgICAgY2FucGxheTogdHJ1ZVxuICAgICAgfSk7XG5cbiAgICAgIC8vIOiuvue9ruaSreaUvueKtuaAgVxuICAgICAgYS5tdXNpYy5wbGF5ZWQgPSB0cnVlO1xuICAgIH0pO1xuXG4gICAgLy8g57yT5Yay5LitXG4gICAgbWFuYWdlci5vbldhaXRpbmcoKCkgPT4ge1xuICAgICAgY29uc29sZS53YXJuKCd3YWl0aW5nJyk7XG4gICAgICB0aGlzLnNldERhdGEhKHsgY2FucGxheTogZmFsc2UgfSk7XG4gICAgfSk7XG5cbiAgICBtYW5hZ2VyLm9uUHJldigoKSA9PiB7XG4gICAgICB0aGlzLnByZXZpb3VzKCk7XG4gICAgfSk7XG5cbiAgICAvLyDmrYzmm7Lmkq3mlL7nu5PmnZ9cbiAgICBtYW5hZ2VyLm9uRW5kZWQoKCkgPT4ge1xuICAgICAgdGhpcy5lbmQoKTtcbiAgICB9KTtcblxuICAgIG1hbmFnZXIub25OZXh0KCgpID0+IHtcbiAgICAgIHRoaXMubmV4dCgpO1xuICAgIH0pO1xuXG4gICAgbWFuYWdlci5vbkVycm9yKCgpID0+IHtcbiAgICAgICRteS50aXAoJ+iOt+WPlumfs+S5kOWHuumUme+8jOivt+eojeWQjumHjeivlScpO1xuICAgIH0pO1xuXG4gICAgLy8g6K6+572u6IO25ZuK5ZKM6IOM5pmv6aKc6ImyXG4gICAgY29uc3QgeyBuYywgYmMgfSA9ICRwYWdlLmNvbG9yKGZhbHNlKTtcblxuICAgIHd4LnNldE5hdmlnYXRpb25CYXJDb2xvcihuYyk7XG4gICAgd3guc2V0QmFja2dyb3VuZENvbG9yKGJjKTtcblxuICAgICRwYWdlLk5vdGljZSgnbXVzaWMnKTtcbiAgfSxcbiAgbG9hZENvdmVyKGV2ZW50OiBhbnkpIHsgLy8g5Yqg6L295bCB6Z2iXG4gICAgaWYgKGV2ZW50LnR5cGUgPT09ICdsb2FkJykgdGhpcy5zZXREYXRhISh7IGNvdmVyTG9hZDogdHJ1ZSB9KTtcbiAgfSxcbiAgcGxheSgpIHsgLy8g5pKt5pS+XG4gICAgaWYgKHRoaXMuZGF0YS5wbGF5KSBtYW5hZ2VyLnBhdXNlKCk7XG4gICAgZWxzZSBtYW5hZ2VyLnBsYXkoKTtcbiAgfSxcbiAgZHJhZyhldmVudDogYW55KSB7IC8vIOaLluaLvei/m+W6plxuICAgIG1hbmFnZXIuc2VlayhldmVudC5kZXRhaWwudmFsdWUgLyAxMDApO1xuICAgIGlmIChldmVudC50eXBlID09PSAnY2hhbmdlJykge1xuICAgICAgdGhpcy5zZXREYXRhISh7IGN1cnJlbnRUaW1lOiBldmVudC5kZXRhaWwudmFsdWUgLyAxMDAgfSk7XG4gICAgICBjb25zb2xlLmxvZyhldmVudC5kZXRhaWwudmFsdWUpOyAvLyDosIPor5VcbiAgICB9XG4gIH0sXG4gIGVuZCgpIHsgLy8g57uT5p2f5Yqo5L2cXG4gICAgbGV0IHsgaW5kZXggfSA9IHRoaXMuZGF0YTtcbiAgICBjb25zdCB0b3RhbCA9IHRoaXMuZGF0YS5zb25nTGlzdC5sZW5ndGg7XG5cbiAgICBzd2l0Y2ggKHRoaXMuZGF0YS5tb2RlKSB7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGxldCB0ZW1wO1xuXG4gICAgICAgIGRvIHRlbXAgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiB0b3RhbCAtIDAuNSk7IHdoaWxlIChpbmRleCA9PT0gdGVtcCk7XG4gICAgICAgIGluZGV4ID0gdGVtcDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGluZGV4ID0gaW5kZXggKyAxID09PSB0b3RhbCA/ICdzdG9wJyA6IGluZGV4ICsgMTtcbiAgICAgICAgJG15LnRpcCgn5pKt5pS+5a6M5q+VJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAxOlxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMDpcbiAgICAgIGRlZmF1bHQ6IGluZGV4ID0gaW5kZXggKyAxID09PSB0b3RhbCA/IDAgOiBpbmRleCArIDE7XG4gICAgfVxuICAgIHRoaXMuU3dpdGNoKGluZGV4KTtcbiAgfSxcbiAgbmV4dCgpIHsgLy8g5LiL5LiA5puy5Yqo5L2cXG4gICAgbGV0IHsgaW5kZXggfSA9IHRoaXMuZGF0YTtcbiAgICBjb25zdCB0b3RhbCA9IHRoaXMuZGF0YS5zb25nTGlzdC5sZW5ndGg7XG5cbiAgICBzd2l0Y2ggKHRoaXMuZGF0YS5tb2RlKSB7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGxldCB0ZW1wO1xuXG4gICAgICAgIGRvIHRlbXAgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiB0b3RhbCAtIDAuNSk7IHdoaWxlIChpbmRleCA9PT0gdGVtcCk7XG4gICAgICAgIGluZGV4ID0gdGVtcDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGlmIChpbmRleCArIDEgPT09IHRvdGFsKSB7XG4gICAgICAgICAgaW5kZXggPSAnbm90aGluZyc7XG4gICAgICAgICAgJG15LnRpcCgn5bey5piv5pyA5ZCO5LiA5puyJyk7XG4gICAgICAgIH0gZWxzZSBpbmRleCArPSAxO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMTpcbiAgICAgIGNhc2UgMDpcbiAgICAgIGRlZmF1bHQ6IGluZGV4ID0gaW5kZXggKyAxID09PSB0b3RhbCA/IDAgOiBpbmRleCArIDE7XG4gICAgfVxuICAgIHRoaXMuU3dpdGNoKGluZGV4KTtcbiAgfSxcbiAgcHJldmlvdXMoKSB7IC8vIOS4iuS4gOabsuWKqOS9nFxuICAgIGxldCB7IGluZGV4IH0gPSB0aGlzLmRhdGE7XG4gICAgY29uc3QgeyBsZW5ndGg6IHRvdGFsIH0gPSB0aGlzLmRhdGEuc29uZ0xpc3Q7XG5cbiAgICBzd2l0Y2ggKHRoaXMuZGF0YS5tb2RlKSB7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGxldCB0ZW1wO1xuXG4gICAgICAgIGRvIHRlbXAgPSBNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiB0b3RhbCAtIDAuNSk7IHdoaWxlIChpbmRleCA9PT0gdGVtcCk7XG4gICAgICAgIGluZGV4ID0gdGVtcDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgIGluZGV4ID0gJ25vdGhpbmcnO1xuICAgICAgICAgICRteS50aXAoJ+W3suaYr+esrOS4gOabsicpO1xuICAgICAgICB9IGVsc2UgaW5kZXggLT0gMTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDE6XG4gICAgICBjYXNlIDA6XG4gICAgICBkZWZhdWx0OiBpbmRleCA9IGluZGV4ID09PSAwID8gdG90YWwgLSAxIDogaW5kZXggLSAxO1xuICAgIH1cbiAgICB0aGlzLlN3aXRjaChpbmRleCk7XG4gIH0sXG4gIFN3aXRjaChpbmRleDogYW55KSB7IC8vIOWIh+aNouatjOabslxuICAgIGlmIChpbmRleCA9PT0gJ3N0b3AnKSB7XG5cbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBwbGF5OiBmYWxzZSxcbiAgICAgICAgY2FuUGxheTogZmFsc2VcbiAgICAgIH0pO1xuXG4gICAgICBtYW5hZ2VyLnN0b3AoKTtcblxuICAgIH0gZWxzZSBpZiAoaW5kZXggIT09ICdub3RoaW5nJykge+OAgC8vIOato+W4uOi1i+WAvFxuXG4gICAgICBjb25zdCBjdXJyZW50U29uZyA9IHRoaXMuZGF0YS5zb25nTGlzdFtpbmRleF07XG5cbiAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICBpbmRleCxcbiAgICAgICAgY3VycmVudFNvbmcsXG4gICAgICAgIHBsYXk6IGZhbHNlLFxuICAgICAgICBjYW5QbGF5OiBmYWxzZVxuICAgICAgfSk7XG5cbiAgICAgIG1hbmFnZXIuc3JjID0gY3VycmVudFNvbmcuc3JjO1xuICAgICAgbWFuYWdlci50aXRsZSA9IGN1cnJlbnRTb25nLnRpdGxlO1xuICAgICAgbWFuYWdlci5zaW5nZXIgPSBjdXJyZW50U29uZy5zaW5nZXI7XG4gICAgICBtYW5hZ2VyLmNvdmVySW1nVXJsID0gY3VycmVudFNvbmcuY292ZXI7XG4gICAgICBhLm11c2ljLmluZGV4ID0gaW5kZXg7XG4gICAgfVxuICB9LFxuICBtb2RlU3dpdGNoKCkgeyAvLyDliIfmjaLmkq3mlL7mqKHlvI9cbiAgICBsZXQgbW9kZU5hbWU7XG4gICAgY29uc3QgbW9kZSA9IHRoaXMuZGF0YS5tb2RlID09PSAzID8gMCA6IHRoaXMuZGF0YS5tb2RlICsgMTtcblxuICAgIHRoaXMuc2V0RGF0YSEoeyBtb2RlIH0pO1xuICAgIHN3aXRjaCAobW9kZSkge1xuICAgICAgY2FzZSAxOiBtb2RlTmFtZSA9ICfljZXmm7Llvqrnjq8nO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjogbW9kZU5hbWUgPSAn6aG65bqP5pKt5pS+JztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6IG1vZGVOYW1lID0gJ+maj+acuuaSreaUvic7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAwOlxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbW9kZU5hbWUgPSAn5YiX6KGo5b6q546vJztcbiAgICB9XG4gICAgd3guc2V0U3RvcmFnZVN5bmMoJ3BsYXlNb2RlJywgbW9kZSk7XG4gICAgJG15LnRpcChgJHttb2RlTmFtZX3mqKHlvI9gKTtcbiAgfSxcbiAgbGlzdCgpIHsgLy8g5YiH5o2i5YiX6KGo5pi+6ZqQXG4gICAgdGhpcy5zZXREYXRhISh7IHNvbmdMaXN0RGlzcGxheTogIXRoaXMuZGF0YS5zb25nTGlzdERpc3BsYXkgfSk7XG4gIH0sXG4gIGNoYW5nZShyZXM6IGFueSkgeyAvLyDngrnlh7vliJfooajlhbfkvZPmrYzmm7Lpobnml7bop6blj5FcbiAgICB0aGlzLmxpc3QoKTtcbiAgICB0aGlzLlN3aXRjaChyZXMuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4KTtcbiAgfSxcbiAgY0EoZTogYW55KSB7XG4gICAgJGNvbXBvbmVudC50cmlnZ2VyKGUsIHRoaXMpO1xuICB9LFxuICBvblNoYXJlQXBwTWVzc2FnZSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdGl0bGU6IHRoaXMuZGF0YS50aXRsZSxcbiAgICAgIHBhdGg6IGAvZnVuY3Rpb24vcGxheWVyP2luZGV4PSR7dGhpcy5kYXRhLmluZGV4fSZzaGFyZT10cnVlYFxuICAgIH07XG4gIH0sXG4gIHJlZGlyZWN0KCkge1xuICAgIHd4LnN3aXRjaFRhYih7IHVybDogJy9wYWdlL21haW4nIH0pO1xuICB9XG59KTtcbiJdfQ==