"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var file_1 = require("./file");
var wx_1 = require("./wx");
var logger = wx.getLogManager({ level: 1 });
var globalData;
var init = function (data) {
    globalData = data;
};
var disposePage = function (page, option) {
    if (page)
        if (page[0].tag === 'head') {
            page[0].statusBarHeight = globalData.info.statusBarHeight;
            page[0].url = [];
            if (option && !page[0].action) {
                page[0].aim = 'aim' in option ? option.aim : page[0].title;
                if ('From' in option)
                    page[0].leftText = option.From;
                if ('depth' in option)
                    page[0].aimDepth = Number(option.depth) + 1;
                if ('share' in option) {
                    page[0].action = 'redirect';
                    console.info('redirect');
                }
                if (!page[0].leftText)
                    page[0].leftText = '返回';
            }
            page.forEach(function (element, index) {
                element.id = index;
                if (element.src) {
                    if (element.res)
                        page[0].url.push(element.res);
                    else {
                        page[0].url.push(element.src);
                        element.res = element.src;
                    }
                    if (!element.imgMode)
                        element.imgMode = 'widthFix';
                }
                if (element.docName) {
                    var temp = element.docName.split('.')[1];
                    element.docName = element.docName.split('.')[0];
                    element.docType = temp === 'docx' || temp === 'doc'
                        ? 'doc'
                        : temp === 'pptx' || temp === 'ppt'
                            ? 'ppt'
                            : temp === 'xlsx' || temp === 'xls'
                                ? 'xls'
                                : temp === 'jpg' || temp === 'jpeg'
                                    ? 'jpg'
                                    : temp === 'mp4' || temp === 'mov' || temp === 'avi' || temp === 'rmvb'
                                        ? 'video'
                                        : temp === 'pdf'
                                            ? 'pdf'
                                            : temp === 'png' || temp === 'gif'
                                                ? temp
                                                : 'document';
                }
                if ('content' in element)
                    element.content.forEach(function (listElement, listIndex) {
                        listElement.id = index + "-" + listIndex;
                        if ('url' in listElement)
                            listElement.url += "?From=" + page[0].title;
                        if ('aim' in listElement)
                            listElement.url =
                                "module" + page[0].aimDepth + "?From=" + page[0].title + "&aim=" + listElement.aim + "&depth=" + page[0].aimDepth;
                        if ('swiKey' in listElement)
                            listElement.status = wx.getStorageSync(listElement.swiKey);
                        if ('sliKey' in listElement)
                            listElement.value = wx.getStorageSync(listElement.sliKey);
                        if ('pickerValue' in listElement)
                            if (listElement.single) {
                                var pickerValue = wx.getStorageSync(listElement.key);
                                listElement.value = listElement.pickerValue[pickerValue];
                                listElement.currentValue = [pickerValue];
                            }
                            else {
                                var pickerValues = wx.getStorageSync(listElement.key).split('-');
                                listElement.currentValue = [];
                                listElement.value = [];
                                pickerValues.forEach(function (k, l) {
                                    listElement.value[l] = listElement.pickerValue[l][Number(k)];
                                    listElement.currentValue[l] = Number(k);
                                });
                            }
                    });
            });
            console.info(page[0].aim + "\u5904\u7406\u5B8C\u6BD5");
        }
        else {
            console.warn('No head tag in page!');
            logger.warn('No head tag');
            wx.reportMonitor('14', 1);
        }
    else {
        console.warn('No pageData!');
        wx.reportMonitor('15', 1);
    }
    return page;
};
var resolveAim = function (aim) {
    var length = aim.length;
    while (!isNaN(Number(aim.charAt(length))))
        length--;
    var folder = aim.substring(0, length + 1);
    return { folder: folder, path: folder + "/" + aim };
};
var preGetPage = function (page) {
    if (page)
        page.forEach(function (component) {
            if ('content' in component)
                component.content.forEach(function (element) {
                    if ('aim' in element) {
                        var path = resolveAim(element.aim).path;
                        file_1.default.getJson("page/" + path, function () { return null; });
                    }
                });
        });
    wx.reportMonitor('1', 1);
};
var resolvePage = function (option, page) {
    if (page === void 0) { page = null; }
    console.info('将要跳转：', option);
    var aim = option.query.aim;
    if (page)
        globalData.page.data = disposePage(page, option.query);
    else {
        var path = resolveAim(aim).path;
        file_1.default.getJson("page/" + path, function (pageData) {
            if (pageData)
                globalData.page.data = disposePage(pageData, option.query);
            else {
                globalData.page.data = disposePage([{ tag: 'error', statusBarHeight: globalData.info.statusBarHeight }], option.query);
                console.warn(aim + "\u8F7D\u5165\u5931\u8D25");
            }
        });
    }
    globalData.page.aim = aim;
    return globalData.page.data;
};
var setPage = function (_a, page, preload) {
    var option = _a.option, ctx = _a.ctx, set = _a.set;
    if (page === void 0) { page = null; }
    if (preload === void 0) { preload = true; }
    if (page)
        ctx.setData({
            T: globalData.T,
            nm: globalData.nm,
            page: set ? page : disposePage(page, option)
        });
    else if (globalData.page.aim === option.aim) {
        console.log(option.aim + "\u5DF2\u5904\u7406");
        ctx.setData({ T: globalData.T, nm: globalData.nm, page: globalData.page.data }, function () {
            console.log(option.aim + "\u5DF2\u5199\u5165");
            if (preload) {
                preGetPage(ctx.data.page);
                console.log(option.aim + "\u9884\u52A0\u8F7D\u5B50\u9875\u9762\u5B8C\u6210");
            }
        });
    }
    else {
        console.log(option.aim + "\u672A\u5904\u7406");
        ctx.setData({
            T: globalData.T,
            nm: globalData.nm,
            page: set ? ctx.data.page : disposePage(ctx.data.page, option)
        });
    }
};
var popNotice = function (aim) {
    if (wx.getStorageSync(aim + "Notify")) {
        var notice = wx.getStorageSync(aim + "notice");
        wx.showModal({
            title: notice[0], content: notice[1], showCancel: false,
            success: function () {
                wx.removeStorageSync(aim + "Notify");
            }
        });
        console.info('弹出通知');
    }
    wx.reportAnalytics('page_aim_count', { aim: aim });
};
var setOnlinePage = function (option, ctx, preload) {
    if (preload === void 0) { preload = true; }
    if (globalData.page.aim === option.aim) {
        console.log(option.aim + "\u5DF2\u5904\u7406");
        ctx.setData({ T: globalData.T, nm: globalData.nm, page: globalData.page.data }, function () {
            console.log(option.aim + "\u5DF2\u5199\u5165");
            if (preload) {
                preGetPage(ctx.data.page);
                console.log(option.aim + "\u9884\u52A0\u8F7D\u5B50\u9875\u9762\u5B8C\u6210");
            }
        });
    }
    else {
        console.info(option.aim + "onLoad\u5F00\u59CB\uFF0C\u53C2\u6570\u4E3A\uFF1A", option);
        var _a = resolveAim(option.aim), folder_1 = _a.folder, path = _a.path;
        ctx.aim = option.aim;
        var page = file_1.default.readJson("page/" + path);
        if (page) {
            setPage({ option: option, ctx: ctx }, page);
            popNotice(option.aim);
            console.info(option.aim + "onLoad\u6210\u529F\uFF1A", ctx.data);
            wx.reportMonitor('0', 1);
            if (preload) {
                preGetPage(ctx.data.page);
                console.log(option.aim + "\u754C\u9762\u9884\u52A0\u8F7D\u5B8C\u6210");
            }
        }
        else
            wx_1.default.request("page/" + path, function (data) {
                setPage({ option: option, ctx: ctx }, data);
                if (!option.share)
                    file_1.default.writeJson("page/" + folder_1, "" + option.aim, data);
                if (preload) {
                    preGetPage(ctx.data.page);
                    console.log(option.aim + "\u754C\u9762\u9884\u52A0\u8F7D\u5B8C\u6210");
                }
                popNotice(option.aim);
                console.info(option.aim + "onLoad\u6210\u529F");
                wx.reportMonitor('0', 1);
            }, function (res) {
                setPage({ option: option, ctx: ctx }, [{ tag: 'error', statusBarHeight: globalData.info.statusBarHeight }]);
                popNotice(option.aim);
                console.warn(option.aim + "onLoad\u5931\u8D25\uFF0C\u9519\u8BEF\u4E3A", res);
                logger.warn(option.aim + "onLoad\u5931\u8D25\uFF0C\u9519\u8BEF\u4E3A", res);
                wx.reportMonitor('13', 1);
            }, function () {
                setPage({ option: option, ctx: ctx }, [{ tag: 'error', statusBarHeight: globalData.info.statusBarHeight }]);
                console.warn(option.aim + "\u8D44\u6E90\u9519\u8BEF");
                wx.reportMonitor('12', 1);
                console.info(option.aim + "onLoad\u6210\u529F");
                wx.reportMonitor('0', 1);
            });
    }
};
var color = function (grey) {
    var _a = globalData.nm ? ['#ffffff', '#000000'] : ['#000000', '#ffffff'], frontColor = _a[0], backgroundColor = _a[1];
    var temp;
    if (globalData.nm && grey)
        switch (globalData.T) {
            case 'Andriod':
                temp = ['#10110b', '#10110b', '#10110b'];
                break;
            case 'iOS':
                temp = ['#10110b', '#0a0a08', '#10110b'];
                break;
            case 'NENU':
            default:
                temp = ['#070707', '#070707', '#070707'];
        }
    else if (globalData.nm && !grey)
        switch (globalData.T) {
            case 'iOS':
                temp = ['#000000', '#0a0a08', '#000000'];
                break;
            case 'Andriod':
            case 'NENU':
            default:
                temp = ['#000000', '#000000', '#000000'];
        }
    else if (!globalData.nm && grey)
        switch (globalData.T) {
            case 'Andriod':
                temp = ['#f8f8f8', '#f8f8f8', '#f8f8f8'];
                break;
            case 'NENU':
                temp = ['#f0f0f0', '#f0f0f0', '#f0f0f0'];
                break;
            case 'iOS':
            default: temp = ['#f4f4f4', '#efeef4', '#efeef4'];
        }
    else
        switch (globalData.T) {
            case 'Andriod':
                temp = ['#f8f8f8', '#f8f8f8', '#f8f8f8'];
                break;
            case 'NENU':
                temp = ['ffffff', 'ffffff', 'ffffff'];
                break;
            case 'iOS':
            default:
                temp = ['#f4f4f4', 'ffffff', 'ffffff'];
        }
    return {
        nc: { frontColor: frontColor, backgroundColor: backgroundColor },
        bc: { backgroundColorTop: temp[0], backgroundColor: temp[1], backgroundColorBottom: temp[2] }
    };
};
var loadFont = function (theme) {
    try {
        if (theme === 'Android')
            wx.loadFontFace({
                family: 'FZKTJW', source: 'url("https://mp.nenuyouth.com/fonts/FZKTJW.ttf")',
                complete: function (res) {
                    console.info('楷体字体', res);
                }
            });
        else if (theme === 'NENU')
            wx.loadFontFace({
                family: 'FZSSJW', source: 'url("https://mp.nenuyouth.com/fonts/FZSSJW.ttf")',
                complete: function (res) {
                    console.info('宋体字体', res);
                }
            });
        else
            throw theme;
    }
    catch (e) {
        console.warn("Theme " + e + " cannot be handled.");
    }
};
exports.default = {
    init: init,
    preGet: preGetPage,
    resolve: resolvePage,
    Set: setPage,
    Online: setOnlinePage,
    Notice: popNotice,
    color: color,
    loadFont: loadFont
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBhZ2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFHQSwrQkFBMkI7QUFDM0IsMkJBQXVCO0FBR3ZCLElBQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQyxhQUFhLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUc5QyxJQUFJLFVBQTJCLENBQUM7QUFPaEMsSUFBTSxJQUFJLEdBQUcsVUFBQyxJQUFxQjtJQUNqQyxVQUFVLEdBQUcsSUFBSSxDQUFDO0FBQ3BCLENBQUMsQ0FBQztBQVNGLElBQU0sV0FBVyxHQUFHLFVBQUMsSUFBUyxFQUFFLE1BQVc7SUFDekMsSUFBSSxJQUFJO1FBQ04sSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLE1BQU0sRUFBRTtZQUcxQixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsZUFBZSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDO1lBQzFELElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO1lBRWpCLElBQUksTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRTtnQkFDN0IsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxLQUFLLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO2dCQUMzRCxJQUFJLE1BQU0sSUFBSSxNQUFNO29CQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztnQkFDckQsSUFBSSxPQUFPLElBQUksTUFBTTtvQkFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUduRSxJQUFJLE9BQU8sSUFBSSxNQUFNLEVBQUU7b0JBQ3JCLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDO29CQUM1QixPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2lCQUMxQjtnQkFHRCxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVE7b0JBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7YUFDaEQ7WUFDRCxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQUMsT0FBWSxFQUFFLEtBQWE7Z0JBQ3ZDLE9BQU8sQ0FBQyxFQUFFLEdBQUcsS0FBSyxDQUFDO2dCQUduQixJQUFJLE9BQU8sQ0FBQyxHQUFHLEVBQUU7b0JBQ2YsSUFBSSxPQUFPLENBQUMsR0FBRzt3QkFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7eUJBQzFDO3dCQUNILElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQzt3QkFDOUIsT0FBTyxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDO3FCQUMzQjtvQkFDRCxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU87d0JBQUUsT0FBTyxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUM7aUJBQ3BEO2dCQUdELElBQUksT0FBTyxDQUFDLE9BQU8sRUFBRTtvQkFDWCxJQUFBLG9DQUFPLENBQWdDO29CQUUvQyxPQUFPLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNoRCxPQUFPLENBQUMsT0FBTyxHQUFHLElBQUksS0FBSyxNQUFNLElBQUksSUFBSSxLQUFLLEtBQUs7d0JBQ2pELENBQUMsQ0FBQyxLQUFLO3dCQUNQLENBQUMsQ0FBQyxJQUFJLEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxLQUFLOzRCQUNqQyxDQUFDLENBQUMsS0FBSzs0QkFDUCxDQUFDLENBQUMsSUFBSSxLQUFLLE1BQU0sSUFBSSxJQUFJLEtBQUssS0FBSztnQ0FDakMsQ0FBQyxDQUFDLEtBQUs7Z0NBQ1AsQ0FBQyxDQUFDLElBQUksS0FBSyxLQUFLLElBQUksSUFBSSxLQUFLLE1BQU07b0NBQ2pDLENBQUMsQ0FBQyxLQUFLO29DQUNQLENBQUMsQ0FBQyxJQUFJLEtBQUssS0FBSyxJQUFJLElBQUksS0FBSyxLQUFLLElBQUksSUFBSSxLQUFLLEtBQUssSUFBSSxJQUFJLEtBQUssTUFBTTt3Q0FDckUsQ0FBQyxDQUFDLE9BQU87d0NBQ1QsQ0FBQyxDQUFDLElBQUksS0FBSyxLQUFLOzRDQUNkLENBQUMsQ0FBQyxLQUFLOzRDQUNQLENBQUMsQ0FBQyxJQUFJLEtBQUssS0FBSyxJQUFJLElBQUksS0FBSyxLQUFLO2dEQUNoQyxDQUFDLENBQUMsSUFBSTtnREFDTixDQUFDLENBQUMsVUFBVSxDQUFDO2lCQUM1QjtnQkFHRCxJQUFJLFNBQVMsSUFBSSxPQUFPO29CQUFFLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUMsV0FBZ0IsRUFBRSxTQUFpQjt3QkFDcEYsV0FBVyxDQUFDLEVBQUUsR0FBTSxLQUFLLFNBQUksU0FBVyxDQUFDO3dCQUd6QyxJQUFJLEtBQUssSUFBSSxXQUFXOzRCQUFFLFdBQVcsQ0FBQyxHQUFHLElBQUksV0FBUyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBTyxDQUFDO3dCQUN0RSxJQUFJLEtBQUssSUFBSSxXQUFXOzRCQUN0QixXQUFXLENBQUMsR0FBRztnQ0FDYixXQUFTLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLGNBQVMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssYUFBUSxXQUFXLENBQUMsR0FBRyxlQUFVLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFVLENBQUM7d0JBR3ZHLElBQUksUUFBUSxJQUFJLFdBQVc7NEJBQUUsV0FBVyxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQzt3QkFDeEYsSUFBSSxRQUFRLElBQUksV0FBVzs0QkFBRSxXQUFXLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO3dCQUd2RixJQUFJLGFBQWEsSUFBSSxXQUFXOzRCQUM5QixJQUFJLFdBQVcsQ0FBQyxNQUFNLEVBQUU7Z0NBQ3RCLElBQU0sV0FBVyxHQUFHLEVBQUUsQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dDQUV2RCxXQUFXLENBQUMsS0FBSyxHQUFHLFdBQVcsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7Z0NBQ3pELFdBQVcsQ0FBQyxZQUFZLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQzs2QkFDMUM7aUNBQU07Z0NBQ0wsSUFBTSxZQUFZLEdBQUcsRUFBRSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dDQUVuRSxXQUFXLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQztnQ0FDOUIsV0FBVyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7Z0NBQ3ZCLFlBQVksQ0FBQyxPQUFPLENBQUMsVUFBQyxDQUFTLEVBQUUsQ0FBUztvQ0FDeEMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO29DQUM3RCxXQUFXLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQ0FDMUMsQ0FBQyxDQUFDLENBQUM7NkJBQ0o7b0JBRUwsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztZQUVILE9BQU8sQ0FBQyxJQUFJLENBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsNkJBQU0sQ0FBQyxDQUFDO1NBR3BDO2FBQU07WUFDTCxPQUFPLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7WUFDckMsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUMzQixFQUFFLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztTQUMzQjtTQUVFO1FBQ0gsT0FBTyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM3QixFQUFFLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztLQUMzQjtJQUVELE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQyxDQUFDO0FBT0YsSUFBTSxVQUFVLEdBQUcsVUFBQyxHQUFXO0lBQ3ZCLElBQUEsbUJBQU0sQ0FBUztJQUVyQixPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFBRSxNQUFNLEVBQUUsQ0FBQztJQUNwRCxJQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFFNUMsT0FBTyxFQUFFLE1BQU0sUUFBQSxFQUFFLElBQUksRUFBSyxNQUFNLFNBQUksR0FBSyxFQUFFLENBQUM7QUFDOUMsQ0FBQyxDQUFDO0FBT0YsSUFBTSxVQUFVLEdBQUcsVUFBQyxJQUFTO0lBQzNCLElBQUksSUFBSTtRQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBQyxTQUFjO1lBQ3BDLElBQUksU0FBUyxJQUFJLFNBQVM7Z0JBQ3hCLFNBQVMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUMsT0FBWTtvQkFDckMsSUFBSSxLQUFLLElBQUksT0FBTyxFQUFFO3dCQUNaLElBQUEsbUNBQUksQ0FBNkI7d0JBRXpDLGNBQUssQ0FBQyxPQUFPLENBQUMsVUFBUSxJQUFNLEVBQUUsY0FBTSxPQUFBLElBQUksRUFBSixDQUFJLENBQUMsQ0FBQztxQkFDM0M7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNILEVBQUUsQ0FBQyxhQUFhLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQzNCLENBQUMsQ0FBQztBQVFGLElBQU0sV0FBVyxHQUFHLFVBQUMsTUFBVyxFQUFFLElBQVc7SUFBWCxxQkFBQSxFQUFBLFdBQVc7SUFDM0MsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDdEIsSUFBQSxzQkFBRyxDQUFrQjtJQUU3QixJQUFJLElBQUk7UUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxXQUFXLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUM1RDtRQUNLLElBQUEsMkJBQUksQ0FBcUI7UUFFakMsY0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFRLElBQU0sRUFBRSxVQUFBLFFBQVE7WUFDcEMsSUFBSSxRQUFRO2dCQUFFLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLFdBQVcsQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUNwRTtnQkFDSCxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxXQUFXLENBQ2hDLENBQUMsRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDLEVBQ3BFLE1BQU0sQ0FBQyxLQUFLLENBQ2IsQ0FBQztnQkFDRixPQUFPLENBQUMsSUFBSSxDQUFJLEdBQUcsNkJBQU0sQ0FBQyxDQUFDO2FBQzVCO1FBQ0gsQ0FBQyxDQUFDLENBQUM7S0FDSjtJQUVELFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztJQUUxQixPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO0FBQzlCLENBQUMsQ0FBQztBQWVGLElBQU0sT0FBTyxHQUFHLFVBQUMsRUFBbUMsRUFBRSxJQUFnQixFQUFFLE9BQWM7UUFBbkUsa0JBQU0sRUFBRSxZQUFHLEVBQUUsWUFBRztJQUFtQixxQkFBQSxFQUFBLFdBQWdCO0lBQUUsd0JBQUEsRUFBQSxjQUFjO0lBRXBGLElBQUksSUFBSTtRQUNOLEdBQUcsQ0FBQyxPQUFPLENBQUM7WUFDVixDQUFDLEVBQUUsVUFBVSxDQUFDLENBQUM7WUFDZixFQUFFLEVBQUUsVUFBVSxDQUFDLEVBQUU7WUFDakIsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQztTQUM3QyxDQUFDLENBQUM7U0FFQSxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLE1BQU0sQ0FBQyxHQUFHLEVBQUU7UUFDM0MsT0FBTyxDQUFDLEdBQUcsQ0FBSSxNQUFNLENBQUMsR0FBRyx1QkFBSyxDQUFDLENBQUM7UUFDaEMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRSxVQUFVLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxVQUFVLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFO1lBQzlFLE9BQU8sQ0FBQyxHQUFHLENBQUksTUFBTSxDQUFDLEdBQUcsdUJBQUssQ0FBQyxDQUFDO1lBQ2hDLElBQUksT0FBTyxFQUFFO2dCQUNYLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUMxQixPQUFPLENBQUMsR0FBRyxDQUFJLE1BQU0sQ0FBQyxHQUFHLHFEQUFVLENBQUMsQ0FBQzthQUN0QztRQUNILENBQUMsQ0FBQyxDQUFDO0tBQ0o7U0FBTTtRQUNMLE9BQU8sQ0FBQyxHQUFHLENBQUksTUFBTSxDQUFDLEdBQUcsdUJBQUssQ0FBQyxDQUFDO1FBRWhDLEdBQUcsQ0FBQyxPQUFPLENBQUM7WUFDVixDQUFDLEVBQUUsVUFBVSxDQUFDLENBQUM7WUFDZixFQUFFLEVBQUUsVUFBVSxDQUFDLEVBQUU7WUFDakIsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUM7U0FDL0QsQ0FBQyxDQUFDO0tBQ0o7QUFDSCxDQUFDLENBQUM7QUFPRixJQUFNLFNBQVMsR0FBRyxVQUFDLEdBQVc7SUFDNUIsSUFBSSxFQUFFLENBQUMsY0FBYyxDQUFJLEdBQUcsV0FBUSxDQUFDLEVBQUU7UUFHckMsSUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDLGNBQWMsQ0FBSSxHQUFHLFdBQVEsQ0FBQyxDQUFDO1FBRWpELEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDWCxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLEtBQUs7WUFHdkQsT0FBTyxFQUFFO2dCQUNQLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBSSxHQUFHLFdBQVEsQ0FBQyxDQUFDO1lBQ3ZDLENBQUM7U0FFRixDQUFDLENBQUM7UUFDSCxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQ3RCO0lBQ0QsRUFBRSxDQUFDLGVBQWUsQ0FBQyxnQkFBZ0IsRUFBRSxFQUFFLEdBQUcsS0FBQSxFQUFFLENBQUMsQ0FBQztBQUNoRCxDQUFDLENBQUM7QUFTRixJQUFNLGFBQWEsR0FBRyxVQUFDLE1BQVcsRUFBRSxHQUFRLEVBQUUsT0FBYztJQUFkLHdCQUFBLEVBQUEsY0FBYztJQUcxRCxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLE1BQU0sQ0FBQyxHQUFHLEVBQUU7UUFDdEMsT0FBTyxDQUFDLEdBQUcsQ0FBSSxNQUFNLENBQUMsR0FBRyx1QkFBSyxDQUFDLENBQUM7UUFDaEMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRSxVQUFVLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxVQUFVLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFO1lBQzlFLE9BQU8sQ0FBQyxHQUFHLENBQUksTUFBTSxDQUFDLEdBQUcsdUJBQUssQ0FBQyxDQUFDO1lBQ2hDLElBQUksT0FBTyxFQUFFO2dCQUNYLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUMxQixPQUFPLENBQUMsR0FBRyxDQUFJLE1BQU0sQ0FBQyxHQUFHLHFEQUFVLENBQUMsQ0FBQzthQUN0QztRQUNILENBQUMsQ0FBQyxDQUFDO0tBR0o7U0FBTTtRQUNMLE9BQU8sQ0FBQyxJQUFJLENBQUksTUFBTSxDQUFDLEdBQUcscURBQWUsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUM3QyxJQUFBLDJCQUF5QyxFQUF2QyxvQkFBTSxFQUFFLGNBQStCLENBQUM7UUFFaEQsR0FBRyxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDO1FBRXJCLElBQU0sSUFBSSxHQUFHLGNBQUssQ0FBQyxRQUFRLENBQUMsVUFBUSxJQUFNLENBQUMsQ0FBQztRQUc1QyxJQUFJLElBQUksRUFBRTtZQUNSLE9BQU8sQ0FBQyxFQUFFLE1BQU0sUUFBQSxFQUFFLEdBQUcsS0FBQSxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDL0IsU0FBUyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0QixPQUFPLENBQUMsSUFBSSxDQUFJLE1BQU0sQ0FBQyxHQUFHLDZCQUFXLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2pELEVBQUUsQ0FBQyxhQUFhLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBR3pCLElBQUksT0FBTyxFQUFFO2dCQUNYLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUMxQixPQUFPLENBQUMsR0FBRyxDQUFJLE1BQU0sQ0FBQyxHQUFHLCtDQUFTLENBQUMsQ0FBQzthQUNyQztTQUNGOztZQUVDLFlBQUcsQ0FBQyxPQUFPLENBQUMsVUFBUSxJQUFNLEVBQUUsVUFBQSxJQUFJO2dCQUU5QixPQUFPLENBQUMsRUFBRSxNQUFNLFFBQUEsRUFBRSxHQUFHLEtBQUEsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQUcvQixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUs7b0JBQUUsY0FBSyxDQUFDLFNBQVMsQ0FBQyxVQUFRLFFBQVEsRUFBRSxLQUFHLE1BQU0sQ0FBQyxHQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7Z0JBRzVFLElBQUksT0FBTyxFQUFFO29CQUNYLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUMxQixPQUFPLENBQUMsR0FBRyxDQUFJLE1BQU0sQ0FBQyxHQUFHLCtDQUFTLENBQUMsQ0FBQztpQkFDckM7Z0JBR0QsU0FBUyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFHdEIsT0FBTyxDQUFDLElBQUksQ0FBSSxNQUFNLENBQUMsR0FBRyx1QkFBVSxDQUFDLENBQUM7Z0JBQ3RDLEVBQUUsQ0FBQyxhQUFhLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzNCLENBQUMsRUFBRSxVQUFBLEdBQUc7Z0JBRUosT0FBTyxDQUFDLEVBQUUsTUFBTSxRQUFBLEVBQUUsR0FBRyxLQUFBLEVBQUUsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxlQUFlLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQy9GLFNBQVMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBR3RCLE9BQU8sQ0FBQyxJQUFJLENBQUksTUFBTSxDQUFDLEdBQUcsK0NBQWMsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDL0MsTUFBTSxDQUFDLElBQUksQ0FBSSxNQUFNLENBQUMsR0FBRywrQ0FBYyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUM5QyxFQUFFLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM1QixDQUFDLEVBQUU7Z0JBRUQsT0FBTyxDQUFDLEVBQUUsTUFBTSxRQUFBLEVBQUUsR0FBRyxLQUFBLEVBQUUsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxlQUFlLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBRy9GLE9BQU8sQ0FBQyxJQUFJLENBQUksTUFBTSxDQUFDLEdBQUcsNkJBQU0sQ0FBQyxDQUFDO2dCQUNsQyxFQUFFLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDMUIsT0FBTyxDQUFDLElBQUksQ0FBSSxNQUFNLENBQUMsR0FBRyx1QkFBVSxDQUFDLENBQUM7Z0JBQ3RDLEVBQUUsQ0FBQyxhQUFhLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzNCLENBQUMsQ0FBQyxDQUFDO0tBQ047QUFDSCxDQUFDLENBQUM7QUFPRixJQUFNLEtBQUssR0FBRyxVQUFDLElBQWE7SUFDcEIsSUFBQSxvRUFBK0YsRUFBOUYsa0JBQVUsRUFBRSx1QkFBa0YsQ0FBQztJQUN0RyxJQUFJLElBQUksQ0FBQztJQUVULElBQUksVUFBVSxDQUFDLEVBQUUsSUFBSSxJQUFJO1FBQ3ZCLFFBQVEsVUFBVSxDQUFDLENBQUMsRUFBRTtZQUNwQixLQUFLLFNBQVM7Z0JBQUUsSUFBSSxHQUFHLENBQUMsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztnQkFDdkQsTUFBTTtZQUNSLEtBQUssS0FBSztnQkFBRSxJQUFJLEdBQUcsQ0FBQyxTQUFTLEVBQUUsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO2dCQUNuRCxNQUFNO1lBQ1IsS0FBSyxNQUFNLENBQUM7WUFDWjtnQkFDRSxJQUFJLEdBQUcsQ0FBQyxTQUFTLEVBQUUsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1NBQzVDO1NBQ0UsSUFBSSxVQUFVLENBQUMsRUFBRSxJQUFJLENBQUMsSUFBSTtRQUM3QixRQUFRLFVBQVUsQ0FBQyxDQUFDLEVBQUU7WUFDcEIsS0FBSyxLQUFLO2dCQUFFLElBQUksR0FBRyxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7Z0JBQ25ELE1BQU07WUFDUixLQUFLLFNBQVMsQ0FBQztZQUNmLEtBQUssTUFBTSxDQUFDO1lBQ1o7Z0JBQ0UsSUFBSSxHQUFHLENBQUMsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztTQUM1QztTQUNFLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxJQUFJLElBQUk7UUFDN0IsUUFBUSxVQUFVLENBQUMsQ0FBQyxFQUFFO1lBQ3BCLEtBQUssU0FBUztnQkFBRSxJQUFJLEdBQUcsQ0FBQyxTQUFTLEVBQUUsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO2dCQUN2RCxNQUFNO1lBQ1IsS0FBSyxNQUFNO2dCQUFFLElBQUksR0FBRyxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7Z0JBQ3BELE1BQU07WUFDUixLQUFLLEtBQUssQ0FBQztZQUNYLE9BQU8sQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7U0FDbkQ7O1FBRUQsUUFBUSxVQUFVLENBQUMsQ0FBQyxFQUFFO1lBQ3BCLEtBQUssU0FBUztnQkFBRSxJQUFJLEdBQUcsQ0FBQyxTQUFTLEVBQUUsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO2dCQUN2RCxNQUFNO1lBQ1IsS0FBSyxNQUFNO2dCQUFFLElBQUksR0FBRyxDQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7Z0JBQ2pELE1BQU07WUFDUixLQUFLLEtBQUssQ0FBQztZQUNYO2dCQUNFLElBQUksR0FBRyxDQUFDLFNBQVMsRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7U0FDMUM7SUFFSCxPQUFPO1FBQ0wsRUFBRSxFQUFFLEVBQUUsVUFBVSxZQUFBLEVBQUUsZUFBZSxpQkFBQSxFQUFFO1FBQ25DLEVBQUUsRUFBRSxFQUFFLGtCQUFrQixFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxlQUFlLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLHFCQUFxQixFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRTtLQUM5RixDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBT0YsSUFBTSxRQUFRLEdBQUcsVUFBQyxLQUFhO0lBQzdCLElBQUk7UUFDRixJQUFJLEtBQUssS0FBSyxTQUFTO1lBQ3JCLEVBQUUsQ0FBQyxZQUFZLENBQUM7Z0JBQ2QsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsa0RBQWtEO2dCQUM1RSxRQUFRLEVBQUUsVUFBQSxHQUFHO29CQUNYLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUM1QixDQUFDO2FBQ0YsQ0FBQyxDQUFDO2FBQ0EsSUFBSSxLQUFLLEtBQUssTUFBTTtZQUN2QixFQUFFLENBQUMsWUFBWSxDQUFDO2dCQUNkLE1BQU0sRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLGtEQUFrRDtnQkFDNUUsUUFBUSxFQUFFLFVBQUEsR0FBRztvQkFDWCxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDNUIsQ0FBQzthQUNGLENBQUMsQ0FBQzs7WUFDQSxNQUFNLEtBQUssQ0FBQztLQUNsQjtJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1YsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFTLENBQUMsd0JBQXFCLENBQUMsQ0FBQztLQUMvQztBQUNILENBQUMsQ0FBQztBQUVGLGtCQUFlO0lBQ2IsSUFBSSxNQUFBO0lBQ0osTUFBTSxFQUFFLFVBQVU7SUFDbEIsT0FBTyxFQUFFLFdBQVc7SUFDcEIsR0FBRyxFQUFFLE9BQU87SUFDWixNQUFNLEVBQUUsYUFBYTtJQUNyQixNQUFNLEVBQUUsU0FBUztJQUNqQixLQUFLLE9BQUE7SUFDTCxRQUFRLFVBQUE7Q0FDVCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIHd4Ki9cblxuLy8g5byV5YWl5paH5Lu2566h55CGXG5pbXBvcnQgJGZpbGUgZnJvbSAnLi9maWxlJztcbmltcG9ydCAkbXkgZnJvbSAnLi93eCc7XG5cbi8vIOWjsOaYjuaXpeW/l+euoeeQhuWZqFxuY29uc3QgbG9nZ2VyID0gd3guZ2V0TG9nTWFuYWdlcih7IGxldmVsOiAxIH0pO1xuXG4vLyDlo7DmmI7lhajlsYDmlbDmja5cbmxldCBnbG9iYWxEYXRhOiBHbG9iYWxEYXRhLkRhdGE7XG5cbi8qKlxuICog5Zyo6ISa5pys5YaF5Yid5aeL5YyW5YWo5bGA5pWw5o2uXG4gKlxuICogQHBhcmFtIGRhdGEg5YWo5bGA5pWw5o2uXG4gKi9cbmNvbnN0IGluaXQgPSAoZGF0YTogR2xvYmFsRGF0YS5EYXRhKSA9PiB7XG4gIGdsb2JhbERhdGEgPSBkYXRhO1xufTtcblxuLyoqXG4gKiDojrflvpfnlYzpnaLmlbDmja7vvIznlJ/miJDmraPnoa7nmoTnlYzpnaLmlbDmja5cbiAqXG4gKiBAcGFyYW0geyp9IHBhZ2Ug6aG16Z2i5pWw5o2uXG4gKiBAcGFyYW0geyp9IG9wdGlvbiDpobXpnaLkvKDlj4JcbiAqIEByZXR1cm5zIHsqfSDlpITnkIbkuYvlkI7nmoRwYWdlXG4gKi9cbmNvbnN0IGRpc3Bvc2VQYWdlID0gKHBhZ2U6IGFueSwgb3B0aW9uOiBhbnkpID0+IHtcbiAgaWYgKHBhZ2UpICAvLyDlpoLmnpxwYWdl5Y+C5pWw5Lyg5YWlXG4gICAgaWYgKHBhZ2VbMF0udGFnID09PSAnaGVhZCcpIHtcblxuICAgICAgLy8g5a+5cGFnZeS4rWhlYWTmoIfnrb7miafooYzliJ3lp4vljJZcbiAgICAgIHBhZ2VbMF0uc3RhdHVzQmFySGVpZ2h0ID0gZ2xvYmFsRGF0YS5pbmZvLnN0YXR1c0JhckhlaWdodDtcbiAgICAgIHBhZ2VbMF0udXJsID0gW107XG5cbiAgICAgIGlmIChvcHRpb24gJiYgIXBhZ2VbMF0uYWN0aW9uKSB7XG4gICAgICAgIHBhZ2VbMF0uYWltID0gJ2FpbScgaW4gb3B0aW9uID8gb3B0aW9uLmFpbSA6IHBhZ2VbMF0udGl0bGU7IC8vIOiuvue9rueVjOmdouWQjeensFxuICAgICAgICBpZiAoJ0Zyb20nIGluIG9wdGlvbikgcGFnZVswXS5sZWZ0VGV4dCA9IG9wdGlvbi5Gcm9tOyAvLyDorr7nva7pobXpnaLmnaXmupBcbiAgICAgICAgaWYgKCdkZXB0aCcgaW4gb3B0aW9uKSBwYWdlWzBdLmFpbURlcHRoID0gTnVtYmVyKG9wdGlvbi5kZXB0aCkgKyAxOyAvLyDorr7nva7nlYzpnaLot6/lvoTmt7HluqZcblxuICAgICAgICAvLyDliKTmlq3mmK/lkKbmnaXoh6rliIbkuqvvvIzliIbkuqvpobXlt6bkuIrop5LliqjkvZzpu5jorqTkuLrph43lrprlkJFcbiAgICAgICAgaWYgKCdzaGFyZScgaW4gb3B0aW9uKSB7XG4gICAgICAgICAgcGFnZVswXS5hY3Rpb24gPSAncmVkaXJlY3QnO1xuICAgICAgICAgIGNvbnNvbGUuaW5mbygncmVkaXJlY3QnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOa3u+WKoOi/lOWbnuaWh+Wtl1xuICAgICAgICBpZiAoIXBhZ2VbMF0ubGVmdFRleHQpIHBhZ2VbMF0ubGVmdFRleHQgPSAn6L+U5ZueJztcbiAgICAgIH1cbiAgICAgIHBhZ2UuZm9yRWFjaCgoZWxlbWVudDogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgIGVsZW1lbnQuaWQgPSBpbmRleDsgLy8g5a+5cGFnZeavj+mhueWFg+e0oOa3u+WKoGlkXG5cbiAgICAgICAgLy8g5aSE55CG5Zu+54mHXG4gICAgICAgIGlmIChlbGVtZW50LnNyYykge1xuICAgICAgICAgIGlmIChlbGVtZW50LnJlcykgcGFnZVswXS51cmwucHVzaChlbGVtZW50LnJlcyk7XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwYWdlWzBdLnVybC5wdXNoKGVsZW1lbnQuc3JjKTtcbiAgICAgICAgICAgIGVsZW1lbnQucmVzID0gZWxlbWVudC5zcmM7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghZWxlbWVudC5pbWdNb2RlKSBlbGVtZW50LmltZ01vZGUgPSAnd2lkdGhGaXgnO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5aSE55CG5paH5qGjXG4gICAgICAgIGlmIChlbGVtZW50LmRvY05hbWUpIHtcbiAgICAgICAgICBjb25zdCB7IDE6IHRlbXAgfSA9IGVsZW1lbnQuZG9jTmFtZS5zcGxpdCgnLicpO1xuXG4gICAgICAgICAgZWxlbWVudC5kb2NOYW1lID0gZWxlbWVudC5kb2NOYW1lLnNwbGl0KCcuJylbMF07XG4gICAgICAgICAgZWxlbWVudC5kb2NUeXBlID0gdGVtcCA9PT0gJ2RvY3gnIHx8IHRlbXAgPT09ICdkb2MnXG4gICAgICAgICAgICA/ICdkb2MnXG4gICAgICAgICAgICA6IHRlbXAgPT09ICdwcHR4JyB8fCB0ZW1wID09PSAncHB0J1xuICAgICAgICAgICAgICA/ICdwcHQnXG4gICAgICAgICAgICAgIDogdGVtcCA9PT0gJ3hsc3gnIHx8IHRlbXAgPT09ICd4bHMnXG4gICAgICAgICAgICAgICAgPyAneGxzJ1xuICAgICAgICAgICAgICAgIDogdGVtcCA9PT0gJ2pwZycgfHwgdGVtcCA9PT0gJ2pwZWcnXG4gICAgICAgICAgICAgICAgICA/ICdqcGcnXG4gICAgICAgICAgICAgICAgICA6IHRlbXAgPT09ICdtcDQnIHx8IHRlbXAgPT09ICdtb3YnIHx8IHRlbXAgPT09ICdhdmknIHx8IHRlbXAgPT09ICdybXZiJ1xuICAgICAgICAgICAgICAgICAgICA/ICd2aWRlbydcbiAgICAgICAgICAgICAgICAgICAgOiB0ZW1wID09PSAncGRmJ1xuICAgICAgICAgICAgICAgICAgICAgID8gJ3BkZidcbiAgICAgICAgICAgICAgICAgICAgICA6IHRlbXAgPT09ICdwbmcnIHx8IHRlbXAgPT09ICdnaWYnXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRlbXBcbiAgICAgICAgICAgICAgICAgICAgICAgIDogJ2RvY3VtZW50JztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIOiuvue9rmxpc3Tnu4Tku7ZcbiAgICAgICAgaWYgKCdjb250ZW50JyBpbiBlbGVtZW50KSBlbGVtZW50LmNvbnRlbnQuZm9yRWFjaCgobGlzdEVsZW1lbnQ6IGFueSwgbGlzdEluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgICBsaXN0RWxlbWVudC5pZCA9IGAke2luZGV4fS0ke2xpc3RJbmRleH1gOyAvLyDliJfooajmr4/pobnmt7vliqBpZFxuXG4gICAgICAgICAgLy8g6K6+572u5YiX6KGo5a+86IiqXG4gICAgICAgICAgaWYgKCd1cmwnIGluIGxpc3RFbGVtZW50KSBsaXN0RWxlbWVudC51cmwgKz0gYD9Gcm9tPSR7cGFnZVswXS50aXRsZX1gO1xuICAgICAgICAgIGlmICgnYWltJyBpbiBsaXN0RWxlbWVudClcbiAgICAgICAgICAgIGxpc3RFbGVtZW50LnVybCA9XG4gICAgICAgICAgICAgIGBtb2R1bGUke3BhZ2VbMF0uYWltRGVwdGh9P0Zyb209JHtwYWdlWzBdLnRpdGxlfSZhaW09JHtsaXN0RWxlbWVudC5haW19JmRlcHRoPSR7cGFnZVswXS5haW1EZXB0aH1gO1xuXG4gICAgICAgICAgLy8g6K6+572u5YiX6KGo5byA5YWz5LiO5ruR5Z2XXG4gICAgICAgICAgaWYgKCdzd2lLZXknIGluIGxpc3RFbGVtZW50KSBsaXN0RWxlbWVudC5zdGF0dXMgPSB3eC5nZXRTdG9yYWdlU3luYyhsaXN0RWxlbWVudC5zd2lLZXkpO1xuICAgICAgICAgIGlmICgnc2xpS2V5JyBpbiBsaXN0RWxlbWVudCkgbGlzdEVsZW1lbnQudmFsdWUgPSB3eC5nZXRTdG9yYWdlU3luYyhsaXN0RWxlbWVudC5zbGlLZXkpO1xuXG4gICAgICAgICAgLy8g6K6+572u5YiX6KGo6YCJ5oup5ZmoXG4gICAgICAgICAgaWYgKCdwaWNrZXJWYWx1ZScgaW4gbGlzdEVsZW1lbnQpXG4gICAgICAgICAgICBpZiAobGlzdEVsZW1lbnQuc2luZ2xlKSB7IC8vIOWNleWIl+mAieaLqeWZqFxuICAgICAgICAgICAgICBjb25zdCBwaWNrZXJWYWx1ZSA9IHd4LmdldFN0b3JhZ2VTeW5jKGxpc3RFbGVtZW50LmtleSk7XG5cbiAgICAgICAgICAgICAgbGlzdEVsZW1lbnQudmFsdWUgPSBsaXN0RWxlbWVudC5waWNrZXJWYWx1ZVtwaWNrZXJWYWx1ZV07XG4gICAgICAgICAgICAgIGxpc3RFbGVtZW50LmN1cnJlbnRWYWx1ZSA9IFtwaWNrZXJWYWx1ZV07XG4gICAgICAgICAgICB9IGVsc2UgeyAvLyDlpJrliJfpgInmi6nlmahcbiAgICAgICAgICAgICAgY29uc3QgcGlja2VyVmFsdWVzID0gd3guZ2V0U3RvcmFnZVN5bmMobGlzdEVsZW1lbnQua2V5KS5zcGxpdCgnLScpO1xuXG4gICAgICAgICAgICAgIGxpc3RFbGVtZW50LmN1cnJlbnRWYWx1ZSA9IFtdO1xuICAgICAgICAgICAgICBsaXN0RWxlbWVudC52YWx1ZSA9IFtdO1xuICAgICAgICAgICAgICBwaWNrZXJWYWx1ZXMuZm9yRWFjaCgoazogc3RyaW5nLCBsOiBudW1iZXIpID0+IHtcbiAgICAgICAgICAgICAgICBsaXN0RWxlbWVudC52YWx1ZVtsXSA9IGxpc3RFbGVtZW50LnBpY2tlclZhbHVlW2xdW051bWJlcihrKV07XG4gICAgICAgICAgICAgICAgbGlzdEVsZW1lbnQuY3VycmVudFZhbHVlW2xdID0gTnVtYmVyKGspO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgLy8g6LCD6K+VXG4gICAgICBjb25zb2xlLmluZm8oYCR7cGFnZVswXS5haW195aSE55CG5a6M5q+VYCk7XG5cbiAgICAgIC8vIOiwg+ivle+8muacquaJvuWIsGhlYWQgdGFnXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybignTm8gaGVhZCB0YWcgaW4gcGFnZSEnKTtcbiAgICAgIGxvZ2dlci53YXJuKCdObyBoZWFkIHRhZycpO1xuICAgICAgd3gucmVwb3J0TW9uaXRvcignMTQnLCAxKTtcbiAgICB9XG4gIC8vIOiwg+ivle+8muacquS8oOWFpXBhZ2VcbiAgZWxzZSB7XG4gICAgY29uc29sZS53YXJuKCdObyBwYWdlRGF0YSEnKTtcbiAgICB3eC5yZXBvcnRNb25pdG9yKCcxNScsIDEpO1xuICB9XG5cbiAgcmV0dXJuIHBhZ2U7IC8vIOi/lOWbnuWkhOeQhuWQjueahHBhZ2Vcbn07XG5cbi8qKlxuICog6I635Y+W5paH5Lu25aS55LiO6Lev5b6E5ZCN56ewXG4gKlxuICogQHBhcmFtIGFpbSDpobXpnaLlkI3np7BcbiAqL1xuY29uc3QgcmVzb2x2ZUFpbSA9IChhaW06IHN0cmluZykgPT4ge1xuICBsZXQgeyBsZW5ndGggfSA9IGFpbTtcblxuICB3aGlsZSAoIWlzTmFOKE51bWJlcihhaW0uY2hhckF0KGxlbmd0aCkpKSkgbGVuZ3RoLS07XG4gIGNvbnN0IGZvbGRlciA9IGFpbS5zdWJzdHJpbmcoMCwgbGVuZ3RoICsgMSk7XG5cbiAgcmV0dXJuIHsgZm9sZGVyLCBwYXRoOiBgJHtmb2xkZXJ9LyR7YWltfWAgfTtcbn07XG5cbi8qKlxuICog5o+Q5YmN6I635b6X5a2Q55WM6Z2i44CC5Zyo55WM6Z2i5Yqg6L295a6M5q+V5pe277yM5qOA5p+l55WM6Z2i5YyF5ZCr55qE5omA5pyJ6ZO+5o6l5piv5ZCm5bey5a2Y5Zyo5pys5ZywanNvbu+8jOWmguaenOayoeacieeri+WNs+iOt+WPluW5tuWkhOeQhuWQjuWGmeWFpeWtmOWCqFxuICpcbiAqIEBwYXJhbSBwYWdlIOmhtemdouaVsOaNrlxuICovXG5jb25zdCBwcmVHZXRQYWdlID0gKHBhZ2U6IGFueSkgPT4ge1xuICBpZiAocGFnZSkgcGFnZS5mb3JFYWNoKChjb21wb25lbnQ6IGFueSkgPT4ge1xuICAgIGlmICgnY29udGVudCcgaW4gY29tcG9uZW50KSAvLyDor6Xnu4Tku7bmmK/liJfooajvvIzpnIDopoHpooTliqDovb3nlYzpnaLvvIzmj5DliY3ojrflj5bnlYzpnaLliLDlrZjlgqhcbiAgICAgIGNvbXBvbmVudC5jb250ZW50LmZvckVhY2goKGVsZW1lbnQ6IGFueSkgPT4ge1xuICAgICAgICBpZiAoJ2FpbScgaW4gZWxlbWVudCkge1xuICAgICAgICAgIGNvbnN0IHsgcGF0aCB9ID0gcmVzb2x2ZUFpbShlbGVtZW50LmFpbSk7XG5cbiAgICAgICAgICAkZmlsZS5nZXRKc29uKGBwYWdlLyR7cGF0aH1gLCAoKSA9PiBudWxsKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH0pO1xuICB3eC5yZXBvcnRNb25pdG9yKCcxJywgMSk7IC8vIOe7n+iuoeaKpeWRilxufTtcblxuLyoqXG4gKiDorr7nva7nlYzpnaLvvIzlnKhvbk5hdmlnYXRl5pe26LCD55So77yM6aKE5aSE55CGcGFnZeaVsOaNruWGmeWFpeWFqOWxgOaVsOaNrlxuICpcbiAqIEBwYXJhbSBvcHRpb24g6aG16Z2i5Lyg5Y+CXG4gKiBAcGFyYW0gcGFnZSBwYWdl5pWw57uEXG4gKi9cbmNvbnN0IHJlc29sdmVQYWdlID0gKG9wdGlvbjogYW55LCBwYWdlID0gbnVsbCkgPT4ge1xuICBjb25zb2xlLmluZm8oJ+Wwhuimgei3s+i9rO+8micsIG9wdGlvbik7IC8vIOaOp+WItuWPsOi+k+WHuuWPguaVsFxuICBjb25zdCB7IGFpbSB9ID0gb3B0aW9uLnF1ZXJ5O1xuXG4gIGlmIChwYWdlKSBnbG9iYWxEYXRhLnBhZ2UuZGF0YSA9IGRpc3Bvc2VQYWdlKHBhZ2UsIG9wdGlvbi5xdWVyeSk7XG4gIGVsc2Uge1xuICAgIGNvbnN0IHsgcGF0aCB9ID0gcmVzb2x2ZUFpbShhaW0pO1xuXG4gICAgJGZpbGUuZ2V0SnNvbihgcGFnZS8ke3BhdGh9YCwgcGFnZURhdGEgPT4ge1xuICAgICAgaWYgKHBhZ2VEYXRhKSBnbG9iYWxEYXRhLnBhZ2UuZGF0YSA9IGRpc3Bvc2VQYWdlKHBhZ2VEYXRhLCBvcHRpb24ucXVlcnkpO1xuICAgICAgZWxzZSB7XG4gICAgICAgIGdsb2JhbERhdGEucGFnZS5kYXRhID0gZGlzcG9zZVBhZ2UoXG4gICAgICAgICAgW3sgdGFnOiAnZXJyb3InLCBzdGF0dXNCYXJIZWlnaHQ6IGdsb2JhbERhdGEuaW5mby5zdGF0dXNCYXJIZWlnaHQgfV0sXG4gICAgICAgICAgb3B0aW9uLnF1ZXJ5XG4gICAgICAgICk7XG4gICAgICAgIGNvbnNvbGUud2FybihgJHthaW196L295YWl5aSx6LSlYCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgLy8g6K6+572uYWlt5YC8XG4gIGdsb2JhbERhdGEucGFnZS5haW0gPSBhaW07XG5cbiAgcmV0dXJuIGdsb2JhbERhdGEucGFnZS5kYXRhO1xufTtcblxuaW50ZXJmYWNlIFNldFBhZ2VPcHRpb24ge1xuICBvcHRpb246IGFueTtcbiAgY3R4OiBhbnk7XG4gIHNldD86IGJvb2xlYW47XG59XG5cbi8qKlxuICog6K6+572u5pys5Zyw55WM6Z2i5pWw5o2u77yM5Zyo55WM6Z2ib25Mb2Fk5pe25L2/55SoXG4gKlxuICogQHBhcmFtIHsqfSBvcHRpb24g6aG16Z2i5Lyg5Y+CXG4gKiBAcGFyYW0geyp9IFtwYWdlXSBwYWdl5pWw57uEXG4gKiBAcGFyYW0ge2Jvb2xlYW59IFtwcmVsb2FkPXRydWVdIHBhZ2XmlbDnu4RcbiAqL1xuY29uc3Qgc2V0UGFnZSA9ICh7IG9wdGlvbiwgY3R4LCBzZXQgfTogU2V0UGFnZU9wdGlvbiwgcGFnZTogYW55ID0gbnVsbCwgcHJlbG9hZCA9IHRydWUpID0+IHtcbiAgLy8g6K6+572u6aG16Z2i5pWw5o2uXG4gIGlmIChwYWdlKVxuICAgIGN0eC5zZXREYXRhKHtcbiAgICAgIFQ6IGdsb2JhbERhdGEuVCxcbiAgICAgIG5tOiBnbG9iYWxEYXRhLm5tLFxuICAgICAgcGFnZTogc2V0ID8gcGFnZSA6IGRpc3Bvc2VQYWdlKHBhZ2UsIG9wdGlvbilcbiAgICB9KTtcbiAgLy8g6aG16Z2i5bey57uP6aKE5aSE55CG5a6M5q+V77yM56uL5Y2z5YaZ5YWlcGFnZeS5puiusOW5tuaJp+ihjOacrOeVjOmdoueahOmihOWKoOi9vVxuICBlbHNlIGlmIChnbG9iYWxEYXRhLnBhZ2UuYWltID09PSBvcHRpb24uYWltKSB7XG4gICAgY29uc29sZS5sb2coYCR7b3B0aW9uLmFpbX3lt7LlpITnkIZgKTtcbiAgICBjdHguc2V0RGF0YSh7IFQ6IGdsb2JhbERhdGEuVCwgbm06IGdsb2JhbERhdGEubm0sIHBhZ2U6IGdsb2JhbERhdGEucGFnZS5kYXRhIH0sICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGAke29wdGlvbi5haW195bey5YaZ5YWlYCk7XG4gICAgICBpZiAocHJlbG9hZCkge1xuICAgICAgICBwcmVHZXRQYWdlKGN0eC5kYXRhLnBhZ2UpO1xuICAgICAgICBjb25zb2xlLmxvZyhgJHtvcHRpb24uYWltfemihOWKoOi9veWtkOmhtemdouWujOaIkGApO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKGAke29wdGlvbi5haW195pyq5aSE55CGYCk7XG4gICAgLy8g6K6+572u6aG16Z2i5pWw5o2uXG4gICAgY3R4LnNldERhdGEoe1xuICAgICAgVDogZ2xvYmFsRGF0YS5ULFxuICAgICAgbm06IGdsb2JhbERhdGEubm0sXG4gICAgICBwYWdlOiBzZXQgPyBjdHguZGF0YS5wYWdlIDogZGlzcG9zZVBhZ2UoY3R4LmRhdGEucGFnZSwgb3B0aW9uKVxuICAgIH0pO1xuICB9XG59O1xuXG4vKipcbiAqIOW8ueWHuumAmuefpe+8jOWcqG9uTG9hZOaXtuiiq+iwg+eUqFxuICpcbiAqIEBwYXJhbSBhaW0g5b2T5YmN55WM6Z2i55qEYWlt5YC8XG4gKi9cbmNvbnN0IHBvcE5vdGljZSA9IChhaW06IHN0cmluZykgPT4ge1xuICBpZiAod3guZ2V0U3RvcmFnZVN5bmMoYCR7YWltfU5vdGlmeWApKSB7IC8vIOWIpOaWreaYr+WQpumcgOimgeW8ueeql1xuXG4gICAgLy8g5LuO5a2Y5YKo5Lit6I635Y+W6YCa55+l5YaF5a655bm25bGV56S6XG4gICAgY29uc3Qgbm90aWNlID0gd3guZ2V0U3RvcmFnZVN5bmMoYCR7YWltfW5vdGljZWApO1xuXG4gICAgd3guc2hvd01vZGFsKHtcbiAgICAgIHRpdGxlOiBub3RpY2VbMF0sIGNvbnRlbnQ6IG5vdGljZVsxXSwgc2hvd0NhbmNlbDogZmFsc2UsXG5cbiAgICAgIC8vIOmYsuatouS6jOasoeW8ueeql1xuICAgICAgc3VjY2VzczogKCkgPT4ge1xuICAgICAgICB3eC5yZW1vdmVTdG9yYWdlU3luYyhgJHthaW19Tm90aWZ5YCk7XG4gICAgICB9XG5cbiAgICB9KTtcbiAgICBjb25zb2xlLmluZm8oJ+W8ueWHuumAmuefpScpOy8vIOiwg+ivlVxuICB9XG4gIHd4LnJlcG9ydEFuYWx5dGljcygncGFnZV9haW1fY291bnQnLCB7IGFpbSB9KTsvLyBBaW3nu5/orqHliIbmnpBcbn07XG5cbi8qKlxuICog6K6+572u5Zyo57q/55WM6Z2i5pWw5o2u77yM5Zyo55WM6Z2i5Yid5aeL5YyW5LmL5ZCO5L2/55SoXG4gKlxuICogQHBhcmFtIG9wdGlvbiDpobXpnaLkvKDlj4JcbiAqIEBwYXJhbSBjdHgg6aG16Z2i5oyH6ZKIXG4gKiBAcGFyYW0gcHJlbG9hZCDmmK/lkKbpnIDopoHpooTliqDovb0o6buY6K6k6ZyA6KaBKVxuICovXG5jb25zdCBzZXRPbmxpbmVQYWdlID0gKG9wdGlvbjogYW55LCBjdHg6IGFueSwgcHJlbG9hZCA9IHRydWUpID0+IHtcblxuICAvLyDpobXpnaLlt7Lnu4/pooTlpITnkIblrozmr5XvvIznq4vljbPlhpnlhaVwYWdl5Lmm6K6w5bm25omn6KGM5pys55WM6Z2i55qE6aKE5Yqg6L29XG4gIGlmIChnbG9iYWxEYXRhLnBhZ2UuYWltID09PSBvcHRpb24uYWltKSB7XG4gICAgY29uc29sZS5sb2coYCR7b3B0aW9uLmFpbX3lt7LlpITnkIZgKTtcbiAgICBjdHguc2V0RGF0YSh7IFQ6IGdsb2JhbERhdGEuVCwgbm06IGdsb2JhbERhdGEubm0sIHBhZ2U6IGdsb2JhbERhdGEucGFnZS5kYXRhIH0sICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGAke29wdGlvbi5haW195bey5YaZ5YWlYCk7XG4gICAgICBpZiAocHJlbG9hZCkge1xuICAgICAgICBwcmVHZXRQYWdlKGN0eC5kYXRhLnBhZ2UpO1xuICAgICAgICBjb25zb2xlLmxvZyhgJHtvcHRpb24uYWltfemihOWKoOi9veWtkOmhtemdouWujOaIkGApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8g6ZyA6KaB6YeN5paw6L295YWl55WM6Z2iXG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5pbmZvKGAke29wdGlvbi5haW19b25Mb2Fk5byA5aeL77yM5Y+C5pWw5Li677yaYCwgb3B0aW9uKTtcbiAgICBjb25zdCB7IGZvbGRlciwgcGF0aCB9ID0gcmVzb2x2ZUFpbShvcHRpb24uYWltKTtcblxuICAgIGN0eC5haW0gPSBvcHRpb24uYWltO1xuXG4gICAgY29uc3QgcGFnZSA9ICRmaWxlLnJlYWRKc29uKGBwYWdlLyR7cGF0aH1gKTtcblxuICAgIC8vIOWmguaenOacrOWcsOWtmOWCqOS4reWQq+aciXBhZ2Xnm7TmjqXlpITnkIZcbiAgICBpZiAocGFnZSkge1xuICAgICAgc2V0UGFnZSh7IG9wdGlvbiwgY3R4IH0sIHBhZ2UpO1xuICAgICAgcG9wTm90aWNlKG9wdGlvbi5haW0pO1xuICAgICAgY29uc29sZS5pbmZvKGAke29wdGlvbi5haW19b25Mb2Fk5oiQ5Yqf77yaYCwgY3R4LmRhdGEpO1xuICAgICAgd3gucmVwb3J0TW9uaXRvcignMCcsIDEpO1xuXG4gICAgICAvLyDlpoLmnpzpnIDopoHmiafooYzpooTliqDovb3vvIzliJnmiafooYxcbiAgICAgIGlmIChwcmVsb2FkKSB7XG4gICAgICAgIHByZUdldFBhZ2UoY3R4LmRhdGEucGFnZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKGAke29wdGlvbi5haW1955WM6Z2i6aKE5Yqg6L295a6M5oiQYCk7XG4gICAgICB9XG4gICAgfSBlbHNlXG4gICAgICAvLyDor7fmsYLpobXpnaJKc29uXG4gICAgICAkbXkucmVxdWVzdChgcGFnZS8ke3BhdGh9YCwgZGF0YSA9PiB7XG4gICAgICAgIC8vIOiuvue9rueVjOmdolxuICAgICAgICBzZXRQYWdlKHsgb3B0aW9uLCBjdHggfSwgZGF0YSk7XG5cbiAgICAgICAgLy8g6Z2e5YiG5Lqr55WM6Z2i5LiL5bCG6aG16Z2i5pWw5o2u5YaZ5YWl5a2Y5YKoXG4gICAgICAgIGlmICghb3B0aW9uLnNoYXJlKSAkZmlsZS53cml0ZUpzb24oYHBhZ2UvJHtmb2xkZXJ9YCwgYCR7b3B0aW9uLmFpbX1gLCBkYXRhKTtcblxuICAgICAgICAvLyDlpoLmnpzpnIDopoHmiafooYzpooTliqDovb3vvIzliJnmiafooYxcbiAgICAgICAgaWYgKHByZWxvYWQpIHtcbiAgICAgICAgICBwcmVHZXRQYWdlKGN0eC5kYXRhLnBhZ2UpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGAke29wdGlvbi5haW1955WM6Z2i6aKE5Yqg6L295a6M5oiQYCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyDlvLnlh7rpgJrnn6VcbiAgICAgICAgcG9wTm90aWNlKG9wdGlvbi5haW0pO1xuXG4gICAgICAgIC8vIOiwg+ivlVxuICAgICAgICBjb25zb2xlLmluZm8oYCR7b3B0aW9uLmFpbX1vbkxvYWTmiJDlip9gKTtcbiAgICAgICAgd3gucmVwb3J0TW9uaXRvcignMCcsIDEpO1xuICAgICAgfSwgcmVzID0+IHtcbiAgICAgICAgLy8g6K6+572uZXJyb3LpobXpnaLlubblvLnlh7rpgJrnn6VcbiAgICAgICAgc2V0UGFnZSh7IG9wdGlvbiwgY3R4IH0sIFt7IHRhZzogJ2Vycm9yJywgc3RhdHVzQmFySGVpZ2h0OiBnbG9iYWxEYXRhLmluZm8uc3RhdHVzQmFySGVpZ2h0IH1dKTtcbiAgICAgICAgcG9wTm90aWNlKG9wdGlvbi5haW0pO1xuXG4gICAgICAgIC8vIOiwg+ivlVxuICAgICAgICBjb25zb2xlLndhcm4oYCR7b3B0aW9uLmFpbX1vbkxvYWTlpLHotKXvvIzplJnor6/kuLpgLCByZXMpO1xuICAgICAgICBsb2dnZXIud2FybihgJHtvcHRpb24uYWltfW9uTG9hZOWksei0pe+8jOmUmeivr+S4umAsIHJlcyk7XG4gICAgICAgIHd4LnJlcG9ydE1vbml0b3IoJzEzJywgMSk7XG4gICAgICB9LCAoKSA9PiB7XG4gICAgICAgIC8vIOiuvue9rmVycm9y55WM6Z2iXG4gICAgICAgIHNldFBhZ2UoeyBvcHRpb24sIGN0eCB9LCBbeyB0YWc6ICdlcnJvcicsIHN0YXR1c0JhckhlaWdodDogZ2xvYmFsRGF0YS5pbmZvLnN0YXR1c0JhckhlaWdodCB9XSk7XG5cbiAgICAgICAgLy8g6LCD6K+VXG4gICAgICAgIGNvbnNvbGUud2FybihgJHtvcHRpb24uYWltfei1hOa6kOmUmeivr2ApO1xuICAgICAgICB3eC5yZXBvcnRNb25pdG9yKCcxMicsIDEpO1xuICAgICAgICBjb25zb2xlLmluZm8oYCR7b3B0aW9uLmFpbX1vbkxvYWTmiJDlip9gKTtcbiAgICAgICAgd3gucmVwb3J0TW9uaXRvcignMCcsIDEpO1xuICAgICAgfSk7XG4gIH1cbn07XG5cbi8qKlxuICog6K6+572u6IO25ZuK5LiO6IOM5pmv6aKc6ImyXG4gKlxuICogQHBhcmFtIGdyZXkg6aG16Z2i5piv5ZCm5Li654Gw6Imy6IOM5pmvXG4gKi9cbmNvbnN0IGNvbG9yID0gKGdyZXk6IGJvb2xlYW4pID0+IHtcbiAgY29uc3QgW2Zyb250Q29sb3IsIGJhY2tncm91bmRDb2xvcl0gPSBnbG9iYWxEYXRhLm5tID8gWycjZmZmZmZmJywgJyMwMDAwMDAnXSA6IFsnIzAwMDAwMCcsICcjZmZmZmZmJ107XG4gIGxldCB0ZW1wO1xuXG4gIGlmIChnbG9iYWxEYXRhLm5tICYmIGdyZXkpXG4gICAgc3dpdGNoIChnbG9iYWxEYXRhLlQpIHtcbiAgICAgIGNhc2UgJ0FuZHJpb2QnOiB0ZW1wID0gWycjMTAxMTBiJywgJyMxMDExMGInLCAnIzEwMTEwYiddO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2lPUyc6IHRlbXAgPSBbJyMxMDExMGInLCAnIzBhMGEwOCcsICcjMTAxMTBiJ107XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnTkVOVSc6XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0ZW1wID0gWycjMDcwNzA3JywgJyMwNzA3MDcnLCAnIzA3MDcwNyddO1xuICAgIH1cbiAgZWxzZSBpZiAoZ2xvYmFsRGF0YS5ubSAmJiAhZ3JleSlcbiAgICBzd2l0Y2ggKGdsb2JhbERhdGEuVCkge1xuICAgICAgY2FzZSAnaU9TJzogdGVtcCA9IFsnIzAwMDAwMCcsICcjMGEwYTA4JywgJyMwMDAwMDAnXTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdBbmRyaW9kJzpcbiAgICAgIGNhc2UgJ05FTlUnOlxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGVtcCA9IFsnIzAwMDAwMCcsICcjMDAwMDAwJywgJyMwMDAwMDAnXTtcbiAgICB9XG4gIGVsc2UgaWYgKCFnbG9iYWxEYXRhLm5tICYmIGdyZXkpXG4gICAgc3dpdGNoIChnbG9iYWxEYXRhLlQpIHtcbiAgICAgIGNhc2UgJ0FuZHJpb2QnOiB0ZW1wID0gWycjZjhmOGY4JywgJyNmOGY4ZjgnLCAnI2Y4ZjhmOCddO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ05FTlUnOiB0ZW1wID0gWycjZjBmMGYwJywgJyNmMGYwZjAnLCAnI2YwZjBmMCddO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2lPUyc6XG4gICAgICBkZWZhdWx0OiB0ZW1wID0gWycjZjRmNGY0JywgJyNlZmVlZjQnLCAnI2VmZWVmNCddO1xuICAgIH1cbiAgZWxzZVxuICAgIHN3aXRjaCAoZ2xvYmFsRGF0YS5UKSB7XG4gICAgICBjYXNlICdBbmRyaW9kJzogdGVtcCA9IFsnI2Y4ZjhmOCcsICcjZjhmOGY4JywgJyNmOGY4ZjgnXTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdORU5VJzogdGVtcCA9IFsnZmZmZmZmJywgJ2ZmZmZmZicsICdmZmZmZmYnXTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdpT1MnOlxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGVtcCA9IFsnI2Y0ZjRmNCcsICdmZmZmZmYnLCAnZmZmZmZmJ107XG4gICAgfVxuXG4gIHJldHVybiB7XG4gICAgbmM6IHsgZnJvbnRDb2xvciwgYmFja2dyb3VuZENvbG9yIH0sXG4gICAgYmM6IHsgYmFja2dyb3VuZENvbG9yVG9wOiB0ZW1wWzBdLCBiYWNrZ3JvdW5kQ29sb3I6IHRlbXBbMV0sIGJhY2tncm91bmRDb2xvckJvdHRvbTogdGVtcFsyXSB9XG4gIH07XG59O1xuXG4vKipcbiAqIOWKoOi9veWtl+S9k1xuICpcbiAqIEBwYXJhbSB0aGVtZSDkuLvpophcbiAqL1xuY29uc3QgbG9hZEZvbnQgPSAodGhlbWU6IHN0cmluZykgPT4ge1xuICB0cnkge1xuICAgIGlmICh0aGVtZSA9PT0gJ0FuZHJvaWQnKVxuICAgICAgd3gubG9hZEZvbnRGYWNlKHtcbiAgICAgICAgZmFtaWx5OiAnRlpLVEpXJywgc291cmNlOiAndXJsKFwiaHR0cHM6Ly9tcC5uZW51eW91dGguY29tL2ZvbnRzL0ZaS1RKVy50dGZcIiknLFxuICAgICAgICBjb21wbGV0ZTogcmVzID0+IHtcbiAgICAgICAgICBjb25zb2xlLmluZm8oJ+alt+S9k+Wtl+S9kycsIHJlcyk7Ly8g6LCD6K+VXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIGVsc2UgaWYgKHRoZW1lID09PSAnTkVOVScpXG4gICAgICB3eC5sb2FkRm9udEZhY2Uoe1xuICAgICAgICBmYW1pbHk6ICdGWlNTSlcnLCBzb3VyY2U6ICd1cmwoXCJodHRwczovL21wLm5lbnV5b3V0aC5jb20vZm9udHMvRlpTU0pXLnR0ZlwiKScsXG4gICAgICAgIGNvbXBsZXRlOiByZXMgPT4ge1xuICAgICAgICAgIGNvbnNvbGUuaW5mbygn5a6L5L2T5a2X5L2TJywgcmVzKTsvLyDosIPor5VcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgZWxzZSB0aHJvdyB0aGVtZTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUud2FybihgVGhlbWUgJHtlfSBjYW5ub3QgYmUgaGFuZGxlZC5gKTtcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQge1xuICBpbml0LFxuICBwcmVHZXQ6IHByZUdldFBhZ2UsXG4gIHJlc29sdmU6IHJlc29sdmVQYWdlLFxuICBTZXQ6IHNldFBhZ2UsXG4gIE9ubGluZTogc2V0T25saW5lUGFnZSxcbiAgTm90aWNlOiBwb3BOb3RpY2UsXG4gIGNvbG9yLFxuICBsb2FkRm9udFxufTtcbiJdfQ==