"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var file_1 = require("./file");
var page_1 = require("./page");
var wx_1 = require("./wx");
var logger = wx.getLogManager({ level: 1 });
var resDownload = function (name) {
    wx.showLoading({ title: '更新中...', mask: true });
    wx.setStorageSync(name + "Download", false);
    var downLoadTask = wx.downloadFile({
        url: "https://mp.nenuyouth.com/" + name + ".zip",
        success: function (res) {
            console.log(name + " statusCode is " + res.statusCode);
            if (res.statusCode === 200) {
                wx.showLoading({ title: '保存中...', mask: true });
                file_1.default.saveFile(res.tempFilePath, name + "Zip");
                console.log("save " + name + " success");
                wx.showLoading({ title: '解压中...', mask: true });
                file_1.default.unzip(name + "Zip", '', function () {
                    console.log("unzip " + name + " sucess");
                    file_1.default.Delete(name + "Zip", false);
                    wx.setStorageSync(name + "Download", true);
                    console.log("delete " + name + " sucess");
                    wx.hideLoading();
                });
            }
        },
        fail: function (failMsg) { return console.error("download " + name + " fail:", failMsg); }
    });
    downLoadTask.onProgressUpdate(function (res) {
        wx.showLoading({ title: "\u4E0B\u8F7D\u4E2D..." + res.progress + "%", mask: true });
    });
};
var checkResUpdate = function (name, dataUsage) {
    var notify = wx.getStorageSync(name + "ResNotify");
    var localVersion = file_1.default.readJson(name + "Version");
    var localTime = wx.getStorageSync(name + "UpdateTime");
    var currentTime = Math.round(new Date().getTime() / 1000);
    console.log(name + "\u901A\u77E5\u72B6\u6001\u4E3A" + notify, '本地版本文件为：', localVersion);
    console.log(name + "\u66F4\u65B0\u4E8E" + localTime + ", \u73B0\u5728\u65F6\u95F4\u662F" + currentTime);
    if (notify || currentTime > localTime + 1000000)
        wx_1.default.request(name + "Version", function (data) {
            if (Number(localVersion) === Number(data))
                console.info(name + "Version match");
            else {
                console.info(name + "not match");
                if (notify)
                    wx.showModal({
                        title: '发现资源更新', content: "\u662F\u5426\u7ACB\u5373\u66F4\u65B0\u8D44\u6E90\uFF1F\n(\u4F1A\u6D88\u8017" + dataUsage + "\u6D41\u91CF)",
                        cancelText: '否', cancelColor: '#ff0000', confirmText: '是',
                        success: function (choice) {
                            if (choice.confirm)
                                resDownload(name);
                            else if (choice.cancel)
                                wx.showModal({
                                    title: '开启资源更新提示？', content: '在资源有更新时会提示您更新资源文件。',
                                    cancelText: '残忍关闭', cancelColor: '#ff0000', confirmText: '保持开启',
                                    success: function (choice2) {
                                        if (choice2.cancel)
                                            wx.showModal({
                                                title: '更新提示已关闭', showCancel: false,
                                                content: '您可以在设置中重新打开提示。请注意：小程序会每半个月对界面文件进行强制更新。',
                                                success: function () {
                                                    wx.setStorageSync(name + "ResNotify", false);
                                                }
                                            });
                                    }
                                });
                        }
                    });
                else
                    resDownload(name);
            }
        });
};
var tabBarChanger = function (nightmode) {
    var color = nightmode ? ['#000000', 'white'] : ['#ffffff', 'black'];
    wx.setTabBarStyle({ backgroundColor: color[0], borderStyle: color[1] });
};
var refreshPage = function (name, ctx, globalData) {
    var test = wx.getStorageSync('test');
    if (test)
        wx_1.default.request("config/" + name + "Test", function (data) {
            wx.setStorageSync(name, data);
            page_1.default.Set({ option: { aim: name }, ctx: ctx }, data);
        });
    else
        wx_1.default.request("config/" + globalData.version + "/" + name, function (data) {
            page_1.default.Set({ option: { aim: name }, ctx: ctx }, data);
        });
};
var initMarker = function (markers) {
    markers.forEach(function (marker) {
        var markerOrigin = {
            iconPath: '/function/icon/marker.png', width: 25, height: 25, alpha: 0.8,
            label: {
                content: marker.name, color: '#1A9D5E', fontSize: '10', anchorX: -4 - 5 * marker.name.length, anchorY: 0,
                bgColor: '#ffffff', borderWidth: 1, borderColor: '#efeef4', borderRadius: 2, padding: '3'
            },
            callout: {
                content: marker.detail, color: '#ffffff', fontSize: '16',
                borderRadius: '10', bgColor: '#1A9D5E', padding: '10', display: 'BYCLICK'
            }
        };
        if (!('title' in marker))
            marker.title = marker.detail;
        delete marker.name;
        delete marker.detail;
        Object.assign(marker, markerOrigin);
    });
    return markers;
};
var setMarker = function (data, name) {
    var marker = initMarker(data.points);
    var category = data.category;
    wx.setStorageSync(name + "-all", marker);
    Object.keys(category).forEach(function (i) {
        var markerDetail = [];
        for (var j = category[i][0]; j <= category[i][1]; j++)
            markerDetail.push(marker[j]);
        wx.setStorageSync(name + "-" + i, markerDetail);
    });
    return true;
};
var markerSet = function () {
    var markerVersion = wx.getStorageSync('markerVersion');
    var functionVersion = file_1.default.readJson('functionVersion');
    if (markerVersion === functionVersion)
        console.log('Marker 已设置就绪');
    else {
        var markerData = file_1.default.readJson('function/marker');
        if (markerData)
            if (setMarker(markerData[0], 'benbu') && setMarker(markerData[1], 'jingyue'))
                wx.setStorageSync('markerVersion', markerVersion);
            else {
                console.warn('Marker set failure.');
                wx.reportMonitor('25', 1);
            }
        else {
            console.log('get Marker error');
            logger.warn('get Marker error');
            wx_1.default.request('function/marker', function (data) {
                file_1.default.writeJson('function', 'marker', data);
                if (setMarker(data, 'benbu') && setMarker(data, 'jingyue') && markerVersion)
                    wx.setStorageSync('markerVersion', markerVersion);
                else {
                    console.warn('Marker set failure.');
                    wx.reportMonitor('25', 1);
                }
            });
        }
    }
};
exports.default = { update: checkResUpdate, tabBarChanger: tabBarChanger, refresh: refreshPage, markerSet: markerSet, resDownload: resDownload };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidGFiLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBUUEsK0JBQTJCO0FBQzNCLCtCQUEyQjtBQUMzQiwyQkFBdUI7QUFHdkIsSUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDLGFBQWEsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBTzlDLElBQU0sV0FBVyxHQUFHLFVBQUMsSUFBWTtJQUMvQixFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUNoRCxFQUFFLENBQUMsY0FBYyxDQUFJLElBQUksYUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzVDLElBQU0sWUFBWSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUM7UUFDbkMsR0FBRyxFQUFFLDhCQUE0QixJQUFJLFNBQU07UUFDM0MsT0FBTyxFQUFFLFVBQUEsR0FBRztZQUNWLE9BQU8sQ0FBQyxHQUFHLENBQUksSUFBSSx1QkFBa0IsR0FBRyxDQUFDLFVBQVksQ0FBQyxDQUFDO1lBQ3ZELElBQUksR0FBRyxDQUFDLFVBQVUsS0FBSyxHQUFHLEVBQUU7Z0JBQzFCLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO2dCQUdoRCxjQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUssSUFBSSxRQUFLLENBQUMsQ0FBQztnQkFDL0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFRLElBQUksYUFBVSxDQUFDLENBQUM7Z0JBRXBDLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO2dCQUdoRCxjQUFLLENBQUMsS0FBSyxDQUFJLElBQUksUUFBSyxFQUFF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a0JBQWUsRUFBRSxNQUFNLEVBQUUsY0FBYyxFQUFFLGFBQWEsZUFBQSxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsU0FBUyxXQUFBLEVBQUUsV0FBVyxhQUFBLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQEF1dGhvcjogTXIuSG9wZVxuICogQExhc3RFZGl0b3JzOiBNci5Ib3BlXG4gKiBARGVzY3JpcHRpb246IHRhYuWHveaVsFxuICogQERhdGU6IDIwMTktMDItMTIgMTY6NDU6NDRcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMTktMDQtMDggMTE6MzQ6MzlcbiAqL1xuLyogZ2xvYmFsIHd4ICovXG5pbXBvcnQgJGZpbGUgZnJvbSAnLi9maWxlJztcbmltcG9ydCAkcGFnZSBmcm9tICcuL3BhZ2UnO1xuaW1wb3J0ICRteSBmcm9tICcuL3d4JztcblxuLy8g5Yid5aeL5YyW5paH5Lu2566h55CG5Zmo44CB5pel5b+X566h55CG5ZmoXG5jb25zdCBsb2dnZXIgPSB3eC5nZXRMb2dNYW5hZ2VyKHsgbGV2ZWw6IDEgfSk7XG5cbi8qKlxuICog6LWE5rqQ5LiL6L29IGZyb20gZnVjdGlvbi5qcyAmIGd1aWRlLmpzIOiiq2NoZWNrUmVzVXBkYXRl6LCD55SoXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWUg5LiL6L296LWE5rqQ5ZCN56ewXG4gKi9cbmNvbnN0IHJlc0Rvd25sb2FkID0gKG5hbWU6IHN0cmluZykgPT4ge1xuICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiAn5pu05paw5LitLi4uJywgbWFzazogdHJ1ZSB9KTtcbiAgd3guc2V0U3RvcmFnZVN5bmMoYCR7bmFtZX1Eb3dubG9hZGAsIGZhbHNlKTtcbiAgY29uc3QgZG93bkxvYWRUYXNrID0gd3guZG93bmxvYWRGaWxlKHtcbiAgICB1cmw6IGBodHRwczovL21wLm5lbnV5b3V0aC5jb20vJHtuYW1lfS56aXBgLFxuICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhgJHtuYW1lfSBzdGF0dXNDb2RlIGlzICR7cmVzLnN0YXR1c0NvZGV9YCk7Ly8g6LCD6K+VXG4gICAgICBpZiAocmVzLnN0YXR1c0NvZGUgPT09IDIwMCkge1xuICAgICAgICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiAn5L+d5a2Y5LitLi4uJywgbWFzazogdHJ1ZSB9KTtcblxuICAgICAgICAvLyDkv53lrZjljovnvKnmlofku7bliLDljovnvKnnm67lvZVcbiAgICAgICAgJGZpbGUuc2F2ZUZpbGUocmVzLnRlbXBGaWxlUGF0aCwgYCR7bmFtZX1aaXBgKTtcbiAgICAgICAgY29uc29sZS5sb2coYHNhdmUgJHtuYW1lfSBzdWNjZXNzYCk7Ly8g6LCD6K+VXG5cbiAgICAgICAgd3guc2hvd0xvYWRpbmcoeyB0aXRsZTogJ+ino+WOi+S4rS4uLicsIG1hc2s6IHRydWUgfSk7XG5cbiAgICAgICAgLy8g6Kej5Y6L5paH5Lu25Yiw5qC555uu5b2VXG4gICAgICAgICRmaWxlLnVuemlwKGAke25hbWV9WmlwYCwgJycsICgpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgdW56aXAgJHtuYW1lfSBzdWNlc3NgKTsvLyDosIPor5VcblxuICAgICAgICAgIC8vIOWIoOmZpOWOi+e8qeebruW9le+8jOW5tuWwhuS4i+i9veaIkOWKn+S/oeaBr+WGmeWFpeWtmOWCqOOAgeWIpOaWreWPlua2iOaPkOekulxuICAgICAgICAgICRmaWxlLkRlbGV0ZShgJHtuYW1lfVppcGAsIGZhbHNlKTtcbiAgICAgICAgICB3eC5zZXRTdG9yYWdlU3luYyhgJHtuYW1lfURvd25sb2FkYCwgdHJ1ZSk7XG5cbiAgICAgICAgICBjb25zb2xlLmxvZyhgZGVsZXRlICR7bmFtZX0gc3VjZXNzYCk7Ly8g6LCD6K+VXG4gICAgICAgICAgd3guaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIOS4i+i9veWksei0pVxuICAgIGZhaWw6IGZhaWxNc2cgPT4gY29uc29sZS5lcnJvcihgZG93bmxvYWQgJHtuYW1lfSBmYWlsOmAsIGZhaWxNc2cpXG4gIH0pO1xuXG4gIGRvd25Mb2FkVGFzay5vblByb2dyZXNzVXBkYXRlKHJlcyA9PiB7XG4gICAgd3guc2hvd0xvYWRpbmcoeyB0aXRsZTogYOS4i+i9veS4rS4uLiR7cmVzLnByb2dyZXNzfSVgLCBtYXNrOiB0cnVlIH0pO1xuICB9KTtcbn07XG5cbi8qKlxuICog5qOA5p+l6LWE5rqQ5pu05pawXG4gKlxuICogQHBhcmFtIG5hbWUg5qOA5p+l6LWE5rqQ55qE5ZCN56ewXG4gKiBAcGFyYW0gZGF0YVVzYWdlIOa2iOiAl+eahOaVsOaNrua1gemHj1xuICovXG5jb25zdCBjaGVja1Jlc1VwZGF0ZSA9IChuYW1lOiBzdHJpbmcsIGRhdGFVc2FnZTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IG5vdGlmeSA9IHd4LmdldFN0b3JhZ2VTeW5jKGAke25hbWV9UmVzTm90aWZ5YCk7IC8vIOi1hOa6kOaPkOmGklxuICBjb25zdCBsb2NhbFZlcnNpb24gPSAkZmlsZS5yZWFkSnNvbihgJHtuYW1lfVZlcnNpb25gKTsgLy8g6K+75Y+W5pys5ZywVmVyc2lvbuaWh+S7tlxuICBjb25zdCBsb2NhbFRpbWUgPSB3eC5nZXRTdG9yYWdlU3luYyhgJHtuYW1lfVVwZGF0ZVRpbWVgKTtcbiAgY29uc3QgY3VycmVudFRpbWUgPSBNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7Ly8g6K+75Y+W5b2T5YmN5ZKM5LiK5qyh5pu05paw5pe26Ze0XG5cbiAgLy8g6LCD6K+VXG4gIGNvbnNvbGUubG9nKGAke25hbWV96YCa55+l54q25oCB5Li6JHtub3RpZnl9YCwgJ+acrOWcsOeJiOacrOaWh+S7tuS4uu+8micsIGxvY2FsVmVyc2lvbik7XG4gIGNvbnNvbGUubG9nKGAke25hbWV95pu05paw5LqOJHtsb2NhbFRpbWV9LCDnjrDlnKjml7bpl7TmmK8ke2N1cnJlbnRUaW1lfWApO1xuXG4gIGlmIChub3RpZnkgfHwgY3VycmVudFRpbWUgPiBsb2NhbFRpbWUgKyAxMDAwMDAwKS8vIOWmguaenOmcgOimgeabtOaWsFxuICAgICRteS5yZXF1ZXN0KGAke25hbWV9VmVyc2lvbmAsIGRhdGEgPT4ge1xuXG4gICAgICAvLyDotYTmupDkuLrmnIDmlrBcbiAgICAgIGlmIChOdW1iZXIobG9jYWxWZXJzaW9uKSA9PT0gTnVtYmVyKGRhdGEpKSBjb25zb2xlLmluZm8oYCR7bmFtZX1WZXJzaW9uIG1hdGNoYCk7Ly8g6LCD6K+VXG5cbiAgICAgIC8vIOmcgOimgeabtOaWsFxuICAgICAgZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuaW5mbyhgJHtuYW1lfW5vdCBtYXRjaGApOyAvLyDosIPor5VcblxuICAgICAgICAvLyDlpoLmnpzpnIDopoHmj5DphpLvvIzliJnlvLnnqpdcbiAgICAgICAgaWYgKG5vdGlmeSkgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICB0aXRsZTogJ+WPkeeOsOi1hOa6kOabtOaWsCcsIGNvbnRlbnQ6IGDmmK/lkKbnq4vljbPmm7TmlrDotYTmupDvvJ9cXG4o5Lya5raI6ICXJHtkYXRhVXNhZ2V95rWB6YePKWAsXG4gICAgICAgICAgY2FuY2VsVGV4dDogJ+WQpicsIGNhbmNlbENvbG9yOiAnI2ZmMDAwMCcsIGNvbmZpcm1UZXh0OiAn5pivJyxcbiAgICAgICAgICBzdWNjZXNzOiBjaG9pY2UgPT4ge1xuXG4gICAgICAgICAgICAvLyDnlKjmiLfnoa7orqTvvIzkuIvovb3mm7TmlrBcbiAgICAgICAgICAgIGlmIChjaG9pY2UuY29uZmlybSkgcmVzRG93bmxvYWQobmFtZSk7XG5cbiAgICAgICAgICAgIC8vIOeUqOaIt+WPlua2iO+8jOivoumXruaYr+WQpuWFs+mXreabtOaWsOaPkOekulxuICAgICAgICAgICAgZWxzZSBpZiAoY2hvaWNlLmNhbmNlbCkgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICAgICAgdGl0bGU6ICflvIDlkK/otYTmupDmm7TmlrDmj5DnpLrvvJ8nLCBjb250ZW50OiAn5Zyo6LWE5rqQ5pyJ5pu05paw5pe25Lya5o+Q56S65oKo5pu05paw6LWE5rqQ5paH5Lu244CCJyxcbiAgICAgICAgICAgICAgY2FuY2VsVGV4dDogJ+aui+W/jeWFs+mXrScsIGNhbmNlbENvbG9yOiAnI2ZmMDAwMCcsIGNvbmZpcm1UZXh0OiAn5L+d5oyB5byA5ZCvJyxcbiAgICAgICAgICAgICAgc3VjY2VzczogY2hvaWNlMiA9PiB7XG5cbiAgICAgICAgICAgICAgICAvLyDnlKjmiLfpgInmi6nlhbPpl61cbiAgICAgICAgICAgICAgICBpZiAoY2hvaWNlMi5jYW5jZWwpIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgICAgICAgICB0aXRsZTogJ+abtOaWsOaPkOekuuW3suWFs+mXrScsIHNob3dDYW5jZWw6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgY29udGVudDogJ+aCqOWPr+S7peWcqOiuvue9ruS4remHjeaWsOaJk+W8gOaPkOekuuOAguivt+azqOaEj++8muWwj+eoi+W6j+S8muavj+WNiuS4quaciOWvueeVjOmdouaWh+S7tui/m+ihjOW8uuWItuabtOaWsOOAgicsXG4gICAgICAgICAgICAgICAgICBzdWNjZXNzOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKGAke25hbWV9UmVzTm90aWZ5YCwgZmFsc2UpOy8vIOWFs+mXreabtOaWsOaPkOekulxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIOi3neS4iuasoeabtOaWsOW3sue7j+WNiuS4quaciOS6hu+8jOW8uuWItuabtOaWsFxuICAgICAgICBlbHNlIHJlc0Rvd25sb2FkKG5hbWUpO1xuICAgICAgfVxuICAgIH0pO1xufTtcblxuLyoqXG4gKiDliqjmgIHmoLnmja7lpJzpl7TmqKHlvI/mlLnlj5jlr7zoiKrmoI8gZnJvbSBtYWluLmpzICYgbWUuanNcbiAqXG4gKiBAcGFyYW0ge2Jvb2xlYW59IG5pZ2h0bW9kZSDlpJzpl7TmqKHlvI/lvIDlkK/nirbmgIFcbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5jb25zdCB0YWJCYXJDaGFuZ2VyID0gKG5pZ2h0bW9kZTogYm9vbGVhbikgPT4ge1xuICBjb25zdCBjb2xvciA9IG5pZ2h0bW9kZSA/IFsnIzAwMDAwMCcsICd3aGl0ZSddIDogWycjZmZmZmZmJywgJ2JsYWNrJ107XG5cbiAgd3guc2V0VGFiQmFyU3R5bGUoeyBiYWNrZ3JvdW5kQ29sb3I6IGNvbG9yWzBdLCBib3JkZXJTdHlsZTogY29sb3JbMV0gfSk7XG59O1xuXG4vKipcbiAqIOWKqOaAgeagueaNruWknOmXtOaooeW8j+aUueWPmOWvvOiIquagjyBmcm9tIG1haW4uanMgJiBtZS5qc1xuICpcbiAqIEBwYXJhbSBuYW1lIOmhtemdouWQjeensFxuICogQHBhcmFtIGdsb2JhbERhdGEg5YWo5bGA5pWw5o2uXG4gKiBAcGFyYW0gY3R4IOmhtemdouaMh+mSiFxuICovXG5jb25zdCByZWZyZXNoUGFnZSA9IChuYW1lOiBzdHJpbmcsIGN0eDogYW55LCBnbG9iYWxEYXRhOiBhbnkpID0+IHtcbiAgY29uc3QgdGVzdCA9IHd4LmdldFN0b3JhZ2VTeW5jKCd0ZXN0Jyk7XG5cbiAgLy8g5byA5ZCv5rWL6K+V5ZCO5bGV56S65rWL6K+V55WM6Z2iXG4gIGlmICh0ZXN0KSAkbXkucmVxdWVzdChgY29uZmlnLyR7bmFtZX1UZXN0YCwgZGF0YSA9PiB7XG4gICAgd3guc2V0U3RvcmFnZVN5bmMobmFtZSwgZGF0YSk7XG4gICAgJHBhZ2UuU2V0KHsgb3B0aW9uOiB7IGFpbTogbmFtZSB9LCBjdHggfSwgZGF0YSk7XG4gIH0pO1xuICAvLyDmma7pgJrnlYzpnaLliqDovb1cbiAgZWxzZSAkbXkucmVxdWVzdChgY29uZmlnLyR7Z2xvYmFsRGF0YS52ZXJzaW9ufS8ke25hbWV9YCwgZGF0YSA9PiB7XG4gICAgJHBhZ2UuU2V0KHsgb3B0aW9uOiB7IGFpbTogbmFtZSB9LCBjdHggfSwgZGF0YSk7XG4gIH0pO1xufTtcblxuLyoqXG4gKiDliJ3lp4vljJZtYXJrZXLvvIzooqtzZXRNYXJrZXLosIPnlKhcbiAqXG4gKiBAcGFyYW0gbWFya2VycyDlvoXlpITnkIbnmoRNYXJrZXLmlbDnu4RcbiAqIEByZXR1cm5zIHthbnlbXX0g5aSE55CG5ZCO55qEbWFya2VyXG4gKi9cbmNvbnN0IGluaXRNYXJrZXIgPSAobWFya2VyczogYW55W10pID0+IHtcbiAgbWFya2Vycy5mb3JFYWNoKG1hcmtlciA9PiB7XG4gICAgY29uc3QgbWFya2VyT3JpZ2luID0ge1xuICAgICAgaWNvblBhdGg6ICcvZnVuY3Rpb24vaWNvbi9tYXJrZXIucG5nJywgd2lkdGg6IDI1LCBoZWlnaHQ6IDI1LCBhbHBoYTogMC44LFxuICAgICAgbGFiZWw6IHtcbiAgICAgICAgY29udGVudDogbWFya2VyLm5hbWUsIGNvbG9yOiAnIzFBOUQ1RScsIGZvbnRTaXplOiAnMTAnLCBhbmNob3JYOiAtNCAtIDUgKiBtYXJrZXIubmFtZS5sZW5ndGgsIGFuY2hvclk6IDAsXG4gICAgICAgIGJnQ29sb3I6ICcjZmZmZmZmJywgYm9yZGVyV2lkdGg6IDEsIGJvcmRlckNvbG9yOiAnI2VmZWVmNCcsIGJvcmRlclJhZGl1czogMiwgcGFkZGluZzogJzMnXG4gICAgICB9LFxuICAgICAgY2FsbG91dDoge1xuICAgICAgICBjb250ZW50OiBtYXJrZXIuZGV0YWlsLCBjb2xvcjogJyNmZmZmZmYnLCBmb250U2l6ZTogJzE2JyxcbiAgICAgICAgYm9yZGVyUmFkaXVzOiAnMTAnLCBiZ0NvbG9yOiAnIzFBOUQ1RScsIHBhZGRpbmc6ICcxMCcsIGRpc3BsYXk6ICdCWUNMSUNLJ1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpZiAoISgndGl0bGUnIGluIG1hcmtlcikpIG1hcmtlci50aXRsZSA9IG1hcmtlci5kZXRhaWw7XG4gICAgZGVsZXRlIG1hcmtlci5uYW1lO1xuICAgIGRlbGV0ZSBtYXJrZXIuZGV0YWlsO1xuICAgIE9iamVjdC5hc3NpZ24obWFya2VyLCBtYXJrZXJPcmlnaW4pO1xuICB9KTtcblxuICByZXR1cm4gbWFya2Vycztcbn07XG5cbi8qKlxuICog6K6+572uTWFya2VyXG4gKlxuICogQHBhcmFtIGRhdGEgbWFya2Vy5pWw5o2uXG4gKiBAcGFyYW0gbmFtZSBtYXJrZXLlkI3np7BcbiAqIEByZXR1cm5zIHtib29sZWFufSDmiJDlip/lkI7ov5Tlm55cbiAqL1xuY29uc3Qgc2V0TWFya2VyID0gKGRhdGE6IGFueSwgbmFtZTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IG1hcmtlciA9IGluaXRNYXJrZXIoZGF0YS5wb2ludHMpO1xuICBjb25zdCB7IGNhdGVnb3J5IH0gPSBkYXRhO1xuXG4gIHd4LnNldFN0b3JhZ2VTeW5jKGAke25hbWV9LWFsbGAsIG1hcmtlcik7XG4gIE9iamVjdC5rZXlzKGNhdGVnb3J5KS5mb3JFYWNoKGkgPT4ge1xuICAgIGNvbnN0IG1hcmtlckRldGFpbCA9IFtdO1xuXG4gICAgZm9yIChsZXQgaiA9IGNhdGVnb3J5W2ldWzBdOyBqIDw9IGNhdGVnb3J5W2ldWzFdOyBqKyspIG1hcmtlckRldGFpbC5wdXNoKG1hcmtlcltqXSk7XG4gICAgd3guc2V0U3RvcmFnZVN5bmMoYCR7bmFtZX0tJHtpfWAsIG1hcmtlckRldGFpbCk7XG4gIH0pO1xuXG4gIHJldHVybiB0cnVlO1xufTtcblxuLyoqIOiuvue9rm1hcmtlciAqL1xuY29uc3QgbWFya2VyU2V0ID0gKCkgPT4ge1xuICBjb25zdCBtYXJrZXJWZXJzaW9uID0gd3guZ2V0U3RvcmFnZVN5bmMoJ21hcmtlclZlcnNpb24nKTtcbiAgY29uc3QgZnVuY3Rpb25WZXJzaW9uID0gJGZpbGUucmVhZEpzb24oJ2Z1bmN0aW9uVmVyc2lvbicpO1xuXG4gIGlmIChtYXJrZXJWZXJzaW9uID09PSBmdW5jdGlvblZlcnNpb24pLy8gTWFya2Vy5bey57uP6K6+572u5a6M5q+VXG4gICAgY29uc29sZS5sb2coJ01hcmtlciDlt7Lorr7nva7lsLHnu6onKTtcblxuICAvLyDpnIDopoHorr7nva5NYXJrZXJcbiAgZWxzZSB7XG4gICAgY29uc3QgbWFya2VyRGF0YSA9ICRmaWxlLnJlYWRKc29uKCdmdW5jdGlvbi9tYXJrZXInKTtcblxuICAgIC8vIOaJvuWIsE1hcmtlckRhdGHvvIznm7TmjqXorr7nva5NYXJrZXJcbiAgICBpZiAobWFya2VyRGF0YSlcbiAgICAgIGlmIChzZXRNYXJrZXIobWFya2VyRGF0YVswXSwgJ2JlbmJ1JykgJiYgc2V0TWFya2VyKG1hcmtlckRhdGFbMV0sICdqaW5neXVlJykpXG4gICAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKCdtYXJrZXJWZXJzaW9uJywgbWFya2VyVmVyc2lvbik7XG4gICAgICBlbHNlIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdNYXJrZXIgc2V0IGZhaWx1cmUuJyk7XG4gICAgICAgIHd4LnJlcG9ydE1vbml0b3IoJzI1JywgMSk7XG4gICAgICB9XG5cbiAgICAvLyDmsqHmnInmib7liLBNYXJrZXJEYXRh77yM5Y+v6IO95Y+I5Yid5aeL5YyW5Lit5pat6YCg5oiQXG4gICAgZWxzZSB7XG4gICAgICAvLyDosIPor5VcbiAgICAgIGNvbnNvbGUubG9nKCdnZXQgTWFya2VyIGVycm9yJyk7XG4gICAgICBsb2dnZXIud2FybignZ2V0IE1hcmtlciBlcnJvcicpO1xuXG4gICAgICAkbXkucmVxdWVzdCgnZnVuY3Rpb24vbWFya2VyJywgZGF0YSA9PiB7XG4gICAgICAgIC8vIOWwhk1hcmtlcuaVsOaNruS/neWtmOaWh+S7tlxuICAgICAgICAkZmlsZS53cml0ZUpzb24oJ2Z1bmN0aW9uJywgJ21hcmtlcicsIGRhdGEpO1xuXG4gICAgICAgIC8vIOiuvue9rk1hcmtlclxuICAgICAgICBpZiAoc2V0TWFya2VyKGRhdGEgYXMgYW55W11bMF0sICdiZW5idScpICYmIHNldE1hcmtlcihkYXRhIGFzIGFueVtdWzFdLCAnamluZ3l1ZScpICYmIG1hcmtlclZlcnNpb24pXG4gICAgICAgICAgd3guc2V0U3RvcmFnZVN5bmMoJ21hcmtlclZlcnNpb24nLCBtYXJrZXJWZXJzaW9uKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCdNYXJrZXIgc2V0IGZhaWx1cmUuJyk7XG4gICAgICAgICAgd3gucmVwb3J0TW9uaXRvcignMjUnLCAxKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCB7IHVwZGF0ZTogY2hlY2tSZXNVcGRhdGUsIHRhYkJhckNoYW5nZXIsIHJlZnJlc2g6IHJlZnJlc2hQYWdlLCBtYXJrZXJTZXQsIHJlc0Rvd25sb2FkIH07XG4iXX0=