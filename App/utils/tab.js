"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var file_1 = require("./file");
var setpage_1 = require("./setpage");
var wx_1 = require("./wx");
var logger = wx.getLogManager({ level: 1 });
var resDownload = function (name) {
    wx.showLoading({ title: '更新中...', mask: true });
    wx.setStorageSync(name + "Download", false);
    var downLoadTask = wx.downloadFile({
        url: "https://mp.nenuyouth.com/" + name + ".zip",
        success: function (res) {
            console.log(name + " statusCode is " + res.statusCode);
            if (res.statusCode === 200) {
                wx.showLoading({ title: '保存中...', mask: true });
                file_1.default.saveFile(res.tempFilePath, name + "Zip");
                console.log("save " + name + " success");
                wx.showLoading({ title: '解压中...', mask: true });
                file_1.default.unzip(name + "Zip", '', function () {
                    console.log("unzip " + name + " sucess");
                    file_1.default.Delete(name + "Zip", false);
                    wx.setStorageSync(name + "Download", true);
                    console.log("delete " + name + " sucess");
                    wx.hideLoading();
                });
            }
        },
        fail: function (failMsg) { return console.error("download " + name + " fail:", failMsg); }
    });
    downLoadTask.onProgressUpdate(function (res) {
        wx.showLoading({ title: "\u4E0B\u8F7D\u4E2D..." + res.progress + "%", mask: true });
    });
};
var checkResUpdate = function (name, dataUsage) {
    var notify = wx.getStorageSync(name + "ResNotify");
    var localVersion = file_1.default.readJson(name + "Version");
    var localTime = wx.getStorageSync(name + "UpdateTime");
    var currentTime = Math.round(new Date().getTime() / 1000);
    console.log(name + "\u901A\u77E5\u72B6\u6001\u4E3A" + notify, '本地版本文件为：', localVersion);
    console.log(name + "\u66F4\u65B0\u4E8E" + localTime + ", \u73B0\u5728\u65F6\u95F4\u662F" + currentTime);
    if (notify || currentTime > localTime + 1000000)
        wx_1.default.request(name + "Version", function (data) {
            if (Number(localVersion) === Number(data))
                console.info(name + "Version match");
            else {
                console.info(name + "not match");
                if (notify)
                    wx.showModal({
                        title: '发现资源更新', content: "\u662F\u5426\u7ACB\u5373\u66F4\u65B0\u8D44\u6E90\uFF1F\n(\u4F1A\u6D88\u8017" + dataUsage + "\u6D41\u91CF)",
                        cancelText: '否', cancelColor: '#ff0000', confirmText: '是',
                        success: function (choice) {
                            if (choice.confirm)
                                resDownload(name);
                            else if (choice.cancel)
                                wx.showModal({
                                    title: '开启资源更新提示？', content: '在资源有更新时会提示您更新资源文件。',
                                    cancelText: '残忍关闭', cancelColor: '#ff0000', confirmText: '保持开启',
                                    success: function (choice2) {
                                        if (choice2.cancel)
                                            wx.showModal({
                                                title: '更新提示已关闭', showCancel: false,
                                                content: '您可以在设置中重新打开提示。请注意：小程序会每半个月对界面文件进行强制更新。',
                                                success: function () {
                                                    wx.setStorageSync(name + "ResNotify", false);
                                                }
                                            });
                                    }
                                });
                        }
                    });
                else
                    resDownload(name);
            }
        });
};
var tabBarChanger = function (nightmode) {
    var color = nightmode ? ['#000000', 'white'] : ['#ffffff', 'black'];
    wx.setTabBarStyle({ backgroundColor: color[0], borderStyle: color[1] });
};
var refreshPage = function (name, ctx, globalData) {
    var test = wx.getStorageSync('test');
    if (test)
        wx_1.default.request("config/" + name + "Test", function (data) {
            wx.setStorageSync(name, data);
            setpage_1.default.Set({ option: { aim: name }, ctx: ctx }, data);
        });
    else
        wx_1.default.request("config/" + globalData.version + "/" + name, function (data) {
            setpage_1.default.Set({ option: { aim: name }, ctx: ctx }, data);
        });
};
var initMarker = function (markers) {
    markers.forEach(function (marker) {
        var markerOrigin = {
            iconPath: '/function/icon/marker.png', width: 25, height: 25, alpha: 0.8,
            label: {
                content: marker.name, color: '#1A9D5E', fontSize: '10', anchorX: -4 - 5 * marker.name.length, anchorY: 0,
                bgColor: '#ffffff', borderWidth: 1, borderColor: '#efeef4', borderRadius: 2, padding: '3'
            },
            callout: {
                content: marker.detail, color: '#ffffff', fontSize: '16',
                borderRadius: '10', bgColor: '#1A9D5E', padding: '10', display: 'BYCLICK'
            }
        };
        if (!('title' in marker))
            marker.title = marker.detail;
        delete marker.name;
        delete marker.detail;
        Object.assign(marker, markerOrigin);
    });
    return markers;
};
var setMarker = function (data, name) {
    var marker = initMarker(data.points);
    var category = data.category;
    wx.setStorageSync(name + "-all", marker);
    Object.keys(category).forEach(function (i) {
        var markerDetail = [];
        for (var j = category[i][0]; j <= category[i][1]; j++)
            markerDetail.push(marker[j]);
        wx.setStorageSync(name + "-" + i, markerDetail);
    });
    return true;
};
var markerSet = function () {
    var markerVersion = wx.getStorageSync('markerVersion');
    var functionVersion = file_1.default.readJson('functionVersion');
    if (markerVersion === functionVersion)
        console.log('Marker 已设置就绪');
    else {
        var markerData = file_1.default.readJson('function/marker');
        if (markerData)
            if (setMarker(markerData[0], 'benbu') && setMarker(markerData[1], 'jingyue'))
                wx.setStorageSync('markerVersion', markerVersion);
            else {
                console.warn('Marker set failure.');
                wx.reportMonitor('25', 1);
            }
        else {
            console.log('get Marker error');
            logger.warn('get Marker error');
            wx_1.default.request('function/marker', function (data) {
                file_1.default.writeJson('function', 'marker', data);
                if (setMarker(data, 'benbu') && setMarker(data, 'jingyue') && markerVersion)
                    wx.setStorageSync('markerVersion', markerVersion);
                else {
                    console.warn('Marker set failure.');
                    wx.reportMonitor('25', 1);
                }
            });
        }
    }
};
exports.default = { update: checkResUpdate, tabBarChanger: tabBarChanger, refresh: refreshPage, markerSet: markerSet, resDownload: resDownload };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFiLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidGFiLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBUUEsK0JBQTJCO0FBQzNCLHFDQUE4QjtBQUM5QiwyQkFBdUI7QUFHdkIsSUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDLGFBQWEsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBTzlDLElBQU0sV0FBVyxHQUFHLFVBQUMsSUFBWTtJQUMvQixFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUNoRCxFQUFFLENBQUMsY0FBYyxDQUFJLElBQUksYUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzVDLElBQU0sWUFBWSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUM7UUFDbkMsR0FBRyxFQUFFLDhCQUE0QixJQUFJLFNBQU07UUFDM0MsT0FBTyxFQUFFLFVBQUEsR0FBRztZQUNWLE9BQU8sQ0FBQyxHQUFHLENBQUksSUFBSSx1QkFBa0IsR0FBRyxDQUFDLFVBQVksQ0FBQyxDQUFDO1lBQ3ZELElBQUksR0FBRyxDQUFDLFVBQVUsS0FBSyxHQUFHLEVBQUU7Z0JBQzFCLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO2dCQUdoRCxjQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUssSUFBSSxRQUFLLENBQUMsQ0FBQztnQkFDL0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFRLElBQUksYUFBVSxDQUFDLENBQUM7Z0JBRXBDLEVBQUUsQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO2dCQUdoRCxjQUFLLENBQUMsS0FBSyxDQUFJLElBQUksUUFBSyxFQUFF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RixrQkFBZSxFQUFFLE1BQU0sRUFBRSxjQUFjLEVBQUUsYUFBYSxlQUFBLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxTQUFTLFdBQUEsRUFBRSxXQUFXLGFBQUEsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAQXV0aG9yOiBNci5Ib3BlXG4gKiBATGFzdEVkaXRvcnM6IE1yLkhvcGVcbiAqIEBEZXNjcmlwdGlvbjogdGFi5Ye95pWwXG4gKiBARGF0ZTogMjAxOS0wMi0xMiAxNjo0NTo0NFxuICogQExhc3RFZGl0VGltZTogMjAxOS0wNC0wOCAxMTozNDozOVxuICovXG4vKiBnbG9iYWwgd3ggKi9cbmltcG9ydCAkZmlsZSBmcm9tICcuL2ZpbGUnO1xuaW1wb3J0ICRwYWdlIGZyb20gJy4vc2V0cGFnZSc7XG5pbXBvcnQgJG15IGZyb20gJy4vd3gnO1xuXG4vLyDliJ3lp4vljJbmlofku7bnrqHnkIblmajjgIHml6Xlv5fnrqHnkIblmahcbmNvbnN0IGxvZ2dlciA9IHd4LmdldExvZ01hbmFnZXIoeyBsZXZlbDogMSB9KTtcblxuLyoqXG4gKiDotYTmupDkuIvovb0gZnJvbSBmdWN0aW9uLmpzICYgZ3VpZGUuanMg6KKrY2hlY2tSZXNVcGRhdGXosIPnlKhcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZSDkuIvovb3otYTmupDlkI3np7BcbiAqL1xuY29uc3QgcmVzRG93bmxvYWQgPSAobmFtZTogc3RyaW5nKSA9PiB7XG4gIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICfmm7TmlrDkuK0uLi4nLCBtYXNrOiB0cnVlIH0pO1xuICB3eC5zZXRTdG9yYWdlU3luYyhgJHtuYW1lfURvd25sb2FkYCwgZmFsc2UpO1xuICBjb25zdCBkb3duTG9hZFRhc2sgPSB3eC5kb3dubG9hZEZpbGUoe1xuICAgIHVybDogYGh0dHBzOi8vbXAubmVudXlvdXRoLmNvbS8ke25hbWV9LnppcGAsXG4gICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGAke25hbWV9IHN0YXR1c0NvZGUgaXMgJHtyZXMuc3RhdHVzQ29kZX1gKTsvLyDosIPor5VcbiAgICAgIGlmIChyZXMuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XG4gICAgICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICfkv53lrZjkuK0uLi4nLCBtYXNrOiB0cnVlIH0pO1xuXG4gICAgICAgIC8vIOS/neWtmOWOi+e8qeaWh+S7tuWIsOWOi+e8qeebruW9lVxuICAgICAgICAkZmlsZS5zYXZlRmlsZShyZXMudGVtcEZpbGVQYXRoLCBgJHtuYW1lfVppcGApO1xuICAgICAgICBjb25zb2xlLmxvZyhgc2F2ZSAke25hbWV9IHN1Y2Nlc3NgKTsvLyDosIPor5VcblxuICAgICAgICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiAn6Kej5Y6L5LitLi4uJywgbWFzazogdHJ1ZSB9KTtcblxuICAgICAgICAvLyDop6Pljovmlofku7bliLDmoLnnm67lvZVcbiAgICAgICAgJGZpbGUudW56aXAoYCR7bmFtZX1aaXBgLCAnJywgKCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGB1bnppcCAke25hbWV9IHN1Y2Vzc2ApOy8vIOiwg+ivlVxuXG4gICAgICAgICAgLy8g5Yig6Zmk5Y6L57yp55uu5b2V77yM5bm25bCG5LiL6L295oiQ5Yqf5L+h5oGv5YaZ5YWl5a2Y5YKo44CB5Yik5pat5Y+W5raI5o+Q56S6XG4gICAgICAgICAgJGZpbGUuRGVsZXRlKGAke25hbWV9WmlwYCwgZmFsc2UpO1xuICAgICAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKGAke25hbWV9RG93bmxvYWRgLCB0cnVlKTtcblxuICAgICAgICAgIGNvbnNvbGUubG9nKGBkZWxldGUgJHtuYW1lfSBzdWNlc3NgKTsvLyDosIPor5VcbiAgICAgICAgICB3eC5oaWRlTG9hZGluZygpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8g5LiL6L295aSx6LSlXG4gICAgZmFpbDogZmFpbE1zZyA9PiBjb25zb2xlLmVycm9yKGBkb3dubG9hZCAke25hbWV9IGZhaWw6YCwgZmFpbE1zZylcbiAgfSk7XG5cbiAgZG93bkxvYWRUYXNrLm9uUHJvZ3Jlc3NVcGRhdGUocmVzID0+IHtcbiAgICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiBg5LiL6L295LitLi4uJHtyZXMucHJvZ3Jlc3N9JWAsIG1hc2s6IHRydWUgfSk7XG4gIH0pO1xufTtcblxuLyoqXG4gKiDmo4Dmn6XotYTmupDmm7TmlrBcbiAqXG4gKiBAcGFyYW0gbmFtZSDmo4Dmn6XotYTmupDnmoTlkI3np7BcbiAqIEBwYXJhbSBkYXRhVXNhZ2Ug5raI6ICX55qE5pWw5o2u5rWB6YePXG4gKi9cbmNvbnN0IGNoZWNrUmVzVXBkYXRlID0gKG5hbWU6IHN0cmluZywgZGF0YVVzYWdlOiBzdHJpbmcpID0+IHtcbiAgY29uc3Qgbm90aWZ5ID0gd3guZ2V0U3RvcmFnZVN5bmMoYCR7bmFtZX1SZXNOb3RpZnlgKTsgLy8g6LWE5rqQ5o+Q6YaSXG4gIGNvbnN0IGxvY2FsVmVyc2lvbiA9ICRmaWxlLnJlYWRKc29uKGAke25hbWV9VmVyc2lvbmApOyAvLyDor7vlj5bmnKzlnLBWZXJzaW9u5paH5Lu2XG4gIGNvbnN0IGxvY2FsVGltZSA9IHd4LmdldFN0b3JhZ2VTeW5jKGAke25hbWV9VXBkYXRlVGltZWApO1xuICBjb25zdCBjdXJyZW50VGltZSA9IE1hdGgucm91bmQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKTsvLyDor7vlj5blvZPliY3lkozkuIrmrKHmm7TmlrDml7bpl7RcblxuICAvLyDosIPor5VcbiAgY29uc29sZS5sb2coYCR7bmFtZX3pgJrnn6XnirbmgIHkuLoke25vdGlmeX1gLCAn5pys5Zyw54mI5pys5paH5Lu25Li677yaJywgbG9jYWxWZXJzaW9uKTtcbiAgY29uc29sZS5sb2coYCR7bmFtZX3mm7TmlrDkuo4ke2xvY2FsVGltZX0sIOeOsOWcqOaXtumXtOaYryR7Y3VycmVudFRpbWV9YCk7XG5cbiAgaWYgKG5vdGlmeSB8fCBjdXJyZW50VGltZSA+IGxvY2FsVGltZSArIDEwMDAwMDApLy8g5aaC5p6c6ZyA6KaB5pu05pawXG4gICAgJG15LnJlcXVlc3QoYCR7bmFtZX1WZXJzaW9uYCwgZGF0YSA9PiB7XG5cbiAgICAgIC8vIOi1hOa6kOS4uuacgOaWsFxuICAgICAgaWYgKE51bWJlcihsb2NhbFZlcnNpb24pID09PSBOdW1iZXIoZGF0YSkpIGNvbnNvbGUuaW5mbyhgJHtuYW1lfVZlcnNpb24gbWF0Y2hgKTsvLyDosIPor5VcblxuICAgICAgLy8g6ZyA6KaB5pu05pawXG4gICAgICBlbHNlIHtcbiAgICAgICAgY29uc29sZS5pbmZvKGAke25hbWV9bm90IG1hdGNoYCk7IC8vIOiwg+ivlVxuXG4gICAgICAgIC8vIOWmguaenOmcgOimgeaPkOmGku+8jOWImeW8ueeql1xuICAgICAgICBpZiAobm90aWZ5KSB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgIHRpdGxlOiAn5Y+R546w6LWE5rqQ5pu05pawJywgY29udGVudDogYOaYr+WQpueri+WNs+abtOaWsOi1hOa6kO+8n1xcbijkvJrmtojogJcke2RhdGFVc2FnZX3mtYHph48pYCxcbiAgICAgICAgICBjYW5jZWxUZXh0OiAn5ZCmJywgY2FuY2VsQ29sb3I6ICcjZmYwMDAwJywgY29uZmlybVRleHQ6ICfmmK8nLFxuICAgICAgICAgIHN1Y2Nlc3M6IGNob2ljZSA9PiB7XG5cbiAgICAgICAgICAgIC8vIOeUqOaIt+ehruiupO+8jOS4i+i9veabtOaWsFxuICAgICAgICAgICAgaWYgKGNob2ljZS5jb25maXJtKSByZXNEb3dubG9hZChuYW1lKTtcblxuICAgICAgICAgICAgLy8g55So5oi35Y+W5raI77yM6K+i6Zeu5piv5ZCm5YWz6Zet5pu05paw5o+Q56S6XG4gICAgICAgICAgICBlbHNlIGlmIChjaG9pY2UuY2FuY2VsKSB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgICAgICB0aXRsZTogJ+W8gOWQr+i1hOa6kOabtOaWsOaPkOekuu+8nycsIGNvbnRlbnQ6ICflnKjotYTmupDmnInmm7TmlrDml7bkvJrmj5DnpLrmgqjmm7TmlrDotYTmupDmlofku7bjgIInLFxuICAgICAgICAgICAgICBjYW5jZWxUZXh0OiAn5q6L5b+N5YWz6ZetJywgY2FuY2VsQ29sb3I6ICcjZmYwMDAwJywgY29uZmlybVRleHQ6ICfkv53mjIHlvIDlkK8nLFxuICAgICAgICAgICAgICBzdWNjZXNzOiBjaG9pY2UyID0+IHtcblxuICAgICAgICAgICAgICAgIC8vIOeUqOaIt+mAieaLqeWFs+mXrVxuICAgICAgICAgICAgICAgIGlmIChjaG9pY2UyLmNhbmNlbCkgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5pu05paw5o+Q56S65bey5YWz6ZetJywgc2hvd0NhbmNlbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICBjb250ZW50OiAn5oKo5Y+v5Lul5Zyo6K6+572u5Lit6YeN5paw5omT5byA5o+Q56S644CC6K+35rOo5oSP77ya5bCP56iL5bqP5Lya5q+P5Y2K5Liq5pyI5a+555WM6Z2i5paH5Lu26L+b6KGM5by65Yi25pu05paw44CCJyxcbiAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgd3guc2V0U3RvcmFnZVN5bmMoYCR7bmFtZX1SZXNOb3RpZnlgLCBmYWxzZSk7Ly8g5YWz6Zet5pu05paw5o+Q56S6XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8g6Led5LiK5qyh5pu05paw5bey57uP5Y2K5Liq5pyI5LqG77yM5by65Yi25pu05pawXG4gICAgICAgIGVsc2UgcmVzRG93bmxvYWQobmFtZSk7XG4gICAgICB9XG4gICAgfSk7XG59O1xuXG4vKipcbiAqIOWKqOaAgeagueaNruWknOmXtOaooeW8j+aUueWPmOWvvOiIquagjyBmcm9tIG1haW4uanMgJiBtZS5qc1xuICpcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gbmlnaHRtb2RlIOWknOmXtOaooeW8j+W8gOWQr+eKtuaAgVxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmNvbnN0IHRhYkJhckNoYW5nZXIgPSAobmlnaHRtb2RlOiBib29sZWFuKSA9PiB7XG4gIGNvbnN0IGNvbG9yID0gbmlnaHRtb2RlID8gWycjMDAwMDAwJywgJ3doaXRlJ10gOiBbJyNmZmZmZmYnLCAnYmxhY2snXTtcblxuICB3eC5zZXRUYWJCYXJTdHlsZSh7IGJhY2tncm91bmRDb2xvcjogY29sb3JbMF0sIGJvcmRlclN0eWxlOiBjb2xvclsxXSB9KTtcbn07XG5cbi8qKlxuICog5Yqo5oCB5qC55o2u5aSc6Ze05qih5byP5pS55Y+Y5a+86Iiq5qCPIGZyb20gbWFpbi5qcyAmIG1lLmpzXG4gKlxuICogQHBhcmFtIG5hbWUg6aG16Z2i5ZCN56ewXG4gKiBAcGFyYW0gZ2xvYmFsRGF0YSDlhajlsYDmlbDmja5cbiAqIEBwYXJhbSBjdHgg6aG16Z2i5oyH6ZKIXG4gKi9cbmNvbnN0IHJlZnJlc2hQYWdlID0gKG5hbWU6IHN0cmluZywgY3R4OiBhbnksIGdsb2JhbERhdGE6IGFueSkgPT4ge1xuICBjb25zdCB0ZXN0ID0gd3guZ2V0U3RvcmFnZVN5bmMoJ3Rlc3QnKTtcblxuICAvLyDlvIDlkK/mtYvor5XlkI7lsZXnpLrmtYvor5XnlYzpnaJcbiAgaWYgKHRlc3QpICRteS5yZXF1ZXN0KGBjb25maWcvJHtuYW1lfVRlc3RgLCBkYXRhID0+IHtcbiAgICB3eC5zZXRTdG9yYWdlU3luYyhuYW1lLCBkYXRhKTtcbiAgICAkcGFnZS5TZXQoeyBvcHRpb246IHsgYWltOiBuYW1lIH0sIGN0eCB9LCBkYXRhKTtcbiAgfSk7XG4gIC8vIOaZrumAmueVjOmdouWKoOi9vVxuICBlbHNlICRteS5yZXF1ZXN0KGBjb25maWcvJHtnbG9iYWxEYXRhLnZlcnNpb259LyR7bmFtZX1gLCBkYXRhID0+IHtcbiAgICAkcGFnZS5TZXQoeyBvcHRpb246IHsgYWltOiBuYW1lIH0sIGN0eCB9LCBkYXRhKTtcbiAgfSk7XG59O1xuXG4vKipcbiAqIOWIneWni+WMlm1hcmtlcu+8jOiiq3NldE1hcmtlcuiwg+eUqFxuICpcbiAqIEBwYXJhbSBtYXJrZXJzIOW+heWkhOeQhueahE1hcmtlcuaVsOe7hFxuICogQHJldHVybnMge2FueVtdfSDlpITnkIblkI7nmoRtYXJrZXJcbiAqL1xuY29uc3QgaW5pdE1hcmtlciA9IChtYXJrZXJzOiBhbnlbXSkgPT4ge1xuICBtYXJrZXJzLmZvckVhY2gobWFya2VyID0+IHtcbiAgICBjb25zdCBtYXJrZXJPcmlnaW4gPSB7XG4gICAgICBpY29uUGF0aDogJy9mdW5jdGlvbi9pY29uL21hcmtlci5wbmcnLCB3aWR0aDogMjUsIGhlaWdodDogMjUsIGFscGhhOiAwLjgsXG4gICAgICBsYWJlbDoge1xuICAgICAgICBjb250ZW50OiBtYXJrZXIubmFtZSwgY29sb3I6ICcjMUE5RDVFJywgZm9udFNpemU6ICcxMCcsIGFuY2hvclg6IC00IC0gNSAqIG1hcmtlci5uYW1lLmxlbmd0aCwgYW5jaG9yWTogMCxcbiAgICAgICAgYmdDb2xvcjogJyNmZmZmZmYnLCBib3JkZXJXaWR0aDogMSwgYm9yZGVyQ29sb3I6ICcjZWZlZWY0JywgYm9yZGVyUmFkaXVzOiAyLCBwYWRkaW5nOiAnMydcbiAgICAgIH0sXG4gICAgICBjYWxsb3V0OiB7XG4gICAgICAgIGNvbnRlbnQ6IG1hcmtlci5kZXRhaWwsIGNvbG9yOiAnI2ZmZmZmZicsIGZvbnRTaXplOiAnMTYnLFxuICAgICAgICBib3JkZXJSYWRpdXM6ICcxMCcsIGJnQ29sb3I6ICcjMUE5RDVFJywgcGFkZGluZzogJzEwJywgZGlzcGxheTogJ0JZQ0xJQ0snXG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmICghKCd0aXRsZScgaW4gbWFya2VyKSkgbWFya2VyLnRpdGxlID0gbWFya2VyLmRldGFpbDtcbiAgICBkZWxldGUgbWFya2VyLm5hbWU7XG4gICAgZGVsZXRlIG1hcmtlci5kZXRhaWw7XG4gICAgT2JqZWN0LmFzc2lnbihtYXJrZXIsIG1hcmtlck9yaWdpbik7XG4gIH0pO1xuXG4gIHJldHVybiBtYXJrZXJzO1xufTtcblxuLyoqXG4gKiDorr7nva5NYXJrZXJcbiAqXG4gKiBAcGFyYW0gZGF0YSBtYXJrZXLmlbDmja5cbiAqIEBwYXJhbSBuYW1lIG1hcmtlcuWQjeensFxuICogQHJldHVybnMge2Jvb2xlYW59IOaIkOWKn+WQjui/lOWbnlxuICovXG5jb25zdCBzZXRNYXJrZXIgPSAoZGF0YTogYW55LCBuYW1lOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgbWFya2VyID0gaW5pdE1hcmtlcihkYXRhLnBvaW50cyk7XG4gIGNvbnN0IHsgY2F0ZWdvcnkgfSA9IGRhdGE7XG5cbiAgd3guc2V0U3RvcmFnZVN5bmMoYCR7bmFtZX0tYWxsYCwgbWFya2VyKTtcbiAgT2JqZWN0LmtleXMoY2F0ZWdvcnkpLmZvckVhY2goaSA9PiB7XG4gICAgY29uc3QgbWFya2VyRGV0YWlsID0gW107XG5cbiAgICBmb3IgKGxldCBqID0gY2F0ZWdvcnlbaV1bMF07IGogPD0gY2F0ZWdvcnlbaV1bMV07IGorKykgbWFya2VyRGV0YWlsLnB1c2gobWFya2VyW2pdKTtcbiAgICB3eC5zZXRTdG9yYWdlU3luYyhgJHtuYW1lfS0ke2l9YCwgbWFya2VyRGV0YWlsKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vKiog6K6+572ubWFya2VyICovXG5jb25zdCBtYXJrZXJTZXQgPSAoKSA9PiB7XG4gIGNvbnN0IG1hcmtlclZlcnNpb24gPSB3eC5nZXRTdG9yYWdlU3luYygnbWFya2VyVmVyc2lvbicpO1xuICBjb25zdCBmdW5jdGlvblZlcnNpb24gPSAkZmlsZS5yZWFkSnNvbignZnVuY3Rpb25WZXJzaW9uJyk7XG5cbiAgaWYgKG1hcmtlclZlcnNpb24gPT09IGZ1bmN0aW9uVmVyc2lvbikvLyBNYXJrZXLlt7Lnu4/orr7nva7lrozmr5VcbiAgICBjb25zb2xlLmxvZygnTWFya2VyIOW3suiuvue9ruWwsee7qicpO1xuXG4gIC8vIOmcgOimgeiuvue9rk1hcmtlclxuICBlbHNlIHtcbiAgICBjb25zdCBtYXJrZXJEYXRhID0gJGZpbGUucmVhZEpzb24oJ2Z1bmN0aW9uL21hcmtlcicpO1xuXG4gICAgLy8g5om+5YiwTWFya2VyRGF0Ye+8jOebtOaOpeiuvue9rk1hcmtlclxuICAgIGlmIChtYXJrZXJEYXRhKVxuICAgICAgaWYgKHNldE1hcmtlcihtYXJrZXJEYXRhWzBdLCAnYmVuYnUnKSAmJiBzZXRNYXJrZXIobWFya2VyRGF0YVsxXSwgJ2ppbmd5dWUnKSlcbiAgICAgICAgd3guc2V0U3RvcmFnZVN5bmMoJ21hcmtlclZlcnNpb24nLCBtYXJrZXJWZXJzaW9uKTtcbiAgICAgIGVsc2Uge1xuICAgICAgICBjb25zb2xlLndhcm4oJ01hcmtlciBzZXQgZmFpbHVyZS4nKTtcbiAgICAgICAgd3gucmVwb3J0TW9uaXRvcignMjUnLCAxKTtcbiAgICAgIH1cblxuICAgIC8vIOayoeacieaJvuWIsE1hcmtlckRhdGHvvIzlj6/og73lj4jliJ3lp4vljJbkuK3mlq3pgKDmiJBcbiAgICBlbHNlIHtcbiAgICAgIC8vIOiwg+ivlVxuICAgICAgY29uc29sZS5sb2coJ2dldCBNYXJrZXIgZXJyb3InKTtcbiAgICAgIGxvZ2dlci53YXJuKCdnZXQgTWFya2VyIGVycm9yJyk7XG5cbiAgICAgICRteS5yZXF1ZXN0KCdmdW5jdGlvbi9tYXJrZXInLCBkYXRhID0+IHtcbiAgICAgICAgLy8g5bCGTWFya2Vy5pWw5o2u5L+d5a2Y5paH5Lu2XG4gICAgICAgICRmaWxlLndyaXRlSnNvbignZnVuY3Rpb24nLCAnbWFya2VyJywgZGF0YSk7XG5cbiAgICAgICAgLy8g6K6+572uTWFya2VyXG4gICAgICAgIGlmIChzZXRNYXJrZXIoZGF0YSBhcyBhbnlbXVswXSwgJ2JlbmJ1JykgJiYgc2V0TWFya2VyKGRhdGEgYXMgYW55W11bMV0sICdqaW5neXVlJykgJiYgbWFya2VyVmVyc2lvbilcbiAgICAgICAgICB3eC5zZXRTdG9yYWdlU3luYygnbWFya2VyVmVyc2lvbicsIG1hcmtlclZlcnNpb24pO1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ01hcmtlciBzZXQgZmFpbHVyZS4nKTtcbiAgICAgICAgICB3eC5yZXBvcnRNb25pdG9yKCcyNScsIDEpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IHsgdXBkYXRlOiBjaGVja1Jlc1VwZGF0ZSwgdGFiQmFyQ2hhbmdlciwgcmVmcmVzaDogcmVmcmVzaFBhZ2UsIG1hcmtlclNldCwgcmVzRG93bmxvYWQgfTtcbiJdfQ==