"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var file_1 = require("./file");
var wx_1 = require("./wx");
var logger = wx.getLogManager({ level: 1 });
var appOption = {
    theme: 'auto',
    themeNum: 0,
    nightmode: false,
    nightmodeAutoChange: true,
    dayBrightnessChange: false,
    nightBrightnessChange: false,
    dayBrightness: 70,
    nightBrightness: 30,
    nightmodeStartTime: '0-0',
    nightmodeEndTime: '5-0',
    functionResNotify: true,
    pageResNotify: true
};
var resDownload = function (list) {
    var listenNumber = list.length;
    list.forEach(function (name) {
        wx.downloadFile({
            url: "https://mp.nenuyouth.com/" + name + ".zip",
            success: function (res) {
                console.log(name + " statusCode is " + res.statusCode);
                if (res.statusCode === 200) {
                    file_1.default.saveFile(res.tempFilePath, name + "Zip");
                    console.log("save " + name + " success");
                    file_1.default.unzip(name + "Zip", '', function () {
                        console.log("unzip " + name + " sucess");
                        file_1.default.Delete(name + "Zip", false);
                        wx.setStorageSync(name + "Download", true);
                        console.log("delete " + name + " sucess");
                        listenNumber--;
                        if (!listenNumber)
                            wx.hideLoading();
                    });
                }
            },
            fail: function (failMsg) {
                wx_1.default.netReport();
                console.error("download " + name + " fail:", failMsg);
                logger.warn("\u521D\u59CB\u5316\u5C0F\u7A0B\u5E8F\u65F6\u4E0B\u8F7D" + name + "\u5931\u8D25");
            }
        });
    });
};
var appInit = function () {
    wx.showLoading({ title: '初始化中...', mask: true });
    console.info('初次启动');
    if (appOption.theme === 'auto') {
        var num = void 0;
        var theme = void 0;
        var platform = wx.getSystemInfoSync().platform;
        switch (platform) {
            case 'iOS':
                theme = 'iOS';
                num = 0;
                break;
            case 'Android':
                theme = 'Android';
                num = 1;
                break;
            default:
                theme = 'iOS';
                num = 0;
        }
        wx.setStorageSync('theme', theme);
        wx.setStorageSync('themeNum', num);
    }
    else {
        wx.setStorageSync('theme', appOption.theme);
        wx.setStorageSync('themeNum', appOption.themeNum);
    }
    for (var data in appOption)
        if (data !== 'theme')
            wx.setStorageSync(data, appOption[data]);
    var timeStamp = new Date().getTime();
    resDownload(['page', 'function']);
    wx.setStorageSync('pageUpdateTime', Math.round(timeStamp / 1000));
    wx.setStorageSync('functionUpdateTime', Math.round(timeStamp / 1000));
    wx.setStorageSync('inited', true);
};
var noticeCheck = function (version) {
    wx_1.default.request("config/" + version + "/notice", function (noticeList) {
        var category = Object.keys(noticeList);
        category.forEach(function (page) {
            if (noticeList[page][3]) {
                wx.setStorageSync(page + "notice", [noticeList[page][0], noticeList[page][1]]);
                wx.setStorageSync(page + "Notify", true);
            }
            else if (noticeList[page][2] !== wx.getStorageSync(page + "noticeVersion")) {
                wx.setStorageSync(page + "notice", [noticeList[page][0], noticeList[page][1]]);
                wx.setStorageSync(page + "noticeVersion", noticeList[page][2]);
                wx.setStorageSync(page + "Notify", true);
            }
        });
        if ('app' in category)
            wx.showModal({
                title: noticeList.app[0], content: noticeList.app[1], showCancel: false,
                success: function () { return wx.removeStorageSync('appNotify'); }
            });
    }, function () {
        console.error('Get noticeList fail');
        logger.warn('noticeList error', 'Net Error');
        wx.reportMonitor('24', 1);
    }, function () {
        console.error('NoticeList address error');
        logger.warn('noticeList error', 'Address Error');
        wx.reportMonitor('24', 1);
    });
};
exports.nightmode = function () {
    var date = new Date();
    var time = date.getHours() * 100 + date.getMinutes();
    var nightModeCondition = wx.getStorageSync('nightmode');
    var nightmodeAutoChange = wx.getStorageSync('nightmodeAutoChange');
    var nightBrightness = wx.getStorageSync('nightBrightness');
    var dayBrightness = wx.getStorageSync('dayBrightness');
    var nightBrightnessChange = wx.getStorageSync('nightBrightnessChange');
    var dayBrightnessChange = wx.getStorageSync('dayBrightnessChange');
    var nmStart = wx.getStorageSync('nightmodeStartTime').split('-');
    var nmEnd = wx.getStorageSync('nightmodeEndTime').split('-');
    var nightmodeStartTime = Number(nmStart[0]) * 100 + Number(nmStart[1]);
    var nightmodeEndTime = Number(nmEnd[0]) * 100 + Number(nmEnd[1]);
    var currentNightModeStatus;
    if (nightmodeAutoChange) {
        currentNightModeStatus =
            nightmodeStartTime <= nightmodeEndTime
                ? time >= nightmodeStartTime && time <= nightmodeEndTime
                : !(time <= nightmodeStartTime && time >= nightmodeEndTime);
        if (currentNightModeStatus && nightBrightnessChange)
            wx.setScreenBrightness({ value: nightBrightness / 100 });
        else if (!currentNightModeStatus && dayBrightnessChange)
            wx.setScreenBrightness({ value: dayBrightness / 100 });
        wx.setStorageSync('nightmode', currentNightModeStatus);
    }
    else {
        if (nightModeCondition && nightBrightnessChange)
            wx.setScreenBrightness({ value: nightBrightness / 100 });
        else if (!nightModeCondition && dayBrightnessChange)
            wx.setScreenBrightness({ value: dayBrightness / 100 });
        currentNightModeStatus = nightModeCondition;
    }
    return currentNightModeStatus;
};
var appUpdate = function (localVersion) {
    var updateManager = wx.getUpdateManager();
    var version;
    var forceUpdate = true;
    var reset = false;
    updateManager.onCheckForUpdate(function (status) {
        if (status.hasUpdate)
            wx_1.default.tip('发现小程序更新，下载中...');
    });
    updateManager.onUpdateReady(function () {
        wx_1.default.request("config/" + localVersion + "/config", function (data) {
            var _a;
            (_a = data, forceUpdate = _a.forceUpdate, reset = _a.reset, version = _a.version);
            if (forceUpdate)
                wx.showModal({
                    title: '已找到新版本',
                    content: "\u65B0\u7248\u672C" + version + "\u5DF2\u4E0B\u8F7D\uFF0C\u8BF7\u91CD\u542F\u5E94\u7528\u66F4\u65B0\u3002" + (reset ? '该版本会初始化小程序。' : ''),
                    showCancel: !reset, confirmText: '应用', cancelText: '取消',
                    success: function (res) {
                        if (res.confirm) {
                            if (reset) {
                                wx.showLoading({ title: '初始化中', mask: true });
                                file_1.default.listFile('').forEach(function (filePath) {
                                    file_1.default.Delete(filePath);
                                });
                                wx.clearStorageSync();
                                wx.hideLoading();
                            }
                            updateManager.applyUpdate();
                        }
                    }
                });
        });
    });
    updateManager.onUpdateFailed(function () {
        wx_1.default.tip('小程序更新下载失败，请检查您的网络！');
        console.warn('Update failure');
        wx.reportMonitor('23', 1);
        logger.warn('Upate App error because of Net Error');
    });
};
var startup = function (version) {
    noticeCheck(version);
    appUpdate(version);
    wx.onMemoryWarning(function (res) {
        wx_1.default.tip('内存不足');
        console.warn('onMemoryWarningReceive');
        wx.reportAnalytics('memory_warning', {
            memory_warning: res && res.level ? res.level : 0,
        });
    });
    wx.getNetworkType({
        success: function (res) {
            var networkType = res.networkType;
            if (networkType === 'none' || networkType === 'unknown')
                wx_1.default.tip('您的网络状态不佳');
        }
    });
    wx.onNetworkStatusChange(function (res) {
        if (!res.isConnected) {
            wx_1.default.tip('网络连接中断,部分小程序功能暂不可用');
            wx.setStorageSync('networkError', true);
        }
        else if (wx.getStorageSync('network')) {
            wx.setStorageSync('networkError', false);
            wx_1.default.tip('网络链接恢复');
        }
    });
    wx.onUserCaptureScreen(function () {
        wx_1.default.tip('您可以点击右上角——转发或点击页面右下角——保存二维码分享小程序');
    });
};
exports.default = { appInit: appInit, appUpdate: appUpdate, nightmode: exports.nightmode, noticeCheck: noticeCheck, startup: startup };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsK0JBQTJCO0FBQzNCLDJCQUF1QjtBQUN2QixJQUFNLE1BQU0sR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7QUFPOUMsSUFBTSxTQUFTLEdBQWM7SUFFM0IsS0FBSyxFQUFFLE1BQU07SUFFYixRQUFRLEVBQUUsQ0FBQztJQUVYLFNBQVMsRUFBRSxLQUFLO0lBRWhCLG1CQUFtQixFQUFFLElBQUk7SUFFekIsbUJBQW1CLEVBQUUsS0FBSztJQUUxQixxQkFBcUIsRUFBRSxLQUFLO0lBRTVCLGFBQWEsRUFBRSxFQUFFO0lBRWpCLGVBQWUsRUFBRSxFQUFFO0lBRW5CLGtCQUFrQixFQUFFLEtBQUs7SUFFekIsZ0JBQWdCLEVBQUUsS0FBSztJQUV2QixpQkFBaUIsRUFBRSxJQUFJO0lBRXZCLGFBQWEsRUFBRSxJQUFJO0NBQ3BCLENBQUM7QUFPRixJQUFNLFdBQVcsR0FBRyxVQUFDLElBQWM7SUFDakMsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUUvQixJQUFJLENBQUMsT0FBTyxDQUFDLFVBQUEsSUFBSTtRQUVmLEVBQUUsQ0FBQyxZQUFZLENBQUM7WUFDZCxHQUFHLEVBQUUsOEJBQTRCLElBQUksU0FBTTtZQUMzQyxPQUFPLEVBQUUsVUFBQSxHQUFHO2dCQUNWLE9BQU8sQ0FBQyxHQUFHLENBQUksSUFBSSx1QkFBa0IsR0FBRyxDQUFDLFVBQVksQ0FBQyxDQUFDO2dCQUN2RCxJQUFJLEdBQUcsQ0FBQyxVQUFVLEtBQUssR0FBRyxFQUFFO29CQUcxQixjQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUssSUFBSSxRQUFLLENBQUMsQ0FBQztvQkFDL0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFRLElBQUksYUFBVSxDQUFDLENBQUM7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LFlBQUcsQ0FBQyxHQUFHLENBQUMsa0NBQWtDLENBQUMsQ0FBQztJQUM5QyxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQztBQUVGLGtCQUFlLEVBQUUsT0FBTyxTQUFBLEVBQUUsU0FBUyxXQUFBLEVBQUUsU0FBUyxtQkFBQSxFQUFFLFdBQVcsYUFBQSxFQUFFLE9BQU8sU0FBQSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyDliJ3lp4vljJbmlofku7bnrqHnkIblmajjgIHml6Xlv5fnrqHnkIblmahcbmltcG9ydCAkZmlsZSBmcm9tICcuL2ZpbGUnO1xuaW1wb3J0ICRteSBmcm9tICcuL3d4JztcbmNvbnN0IGxvZ2dlciA9IHd4LmdldExvZ01hbmFnZXIoeyBsZXZlbDogMSB9KTtcblxuaW50ZXJmYWNlIEFwcE9wdGlvbiB7XG4gIFtwcm9wczogc3RyaW5nXTogc3RyaW5nIHwgYm9vbGVhbiB8IG51bWJlcjtcbn1cblxuLy8g5bCP56iL5bqP6YWN572uXG5jb25zdCBhcHBPcHRpb246IEFwcE9wdGlvbiA9IHtcbiAgLyoqIOS4u+mimOiuvue9riAqL1xuICB0aGVtZTogJ2F1dG8nLFxuICAvKiog6YCJ5oup55qE5Li76aKY5bqP5YiX5Y+3ICovXG4gIHRoZW1lTnVtOiAwLFxuICAvKiog5piv5ZCm5byA5ZCv5aSc6Ze05qih5byPICovXG4gIG5pZ2h0bW9kZTogZmFsc2UsXG4gIC8qKiDml6Xpl7TmqKHlvI/mmK/lkKbmlLnlj5jkuq7luqYgKi9cbiAgbmlnaHRtb2RlQXV0b0NoYW5nZTogdHJ1ZSxcbiAgLyoqIOaXpemXtOaooeW8j+aYr+WQpuaUueWPmOS6ruW6piAqL1xuICBkYXlCcmlnaHRuZXNzQ2hhbmdlOiBmYWxzZSxcbiAgLyoqIOWknOmXtOaooeW8j+aYr+WQpuaUueWPmOS6ruW6piAqL1xuICBuaWdodEJyaWdodG5lc3NDaGFuZ2U6IGZhbHNlLFxuICAvKiog5pel6Ze05qih5byP5Lqu5bqmKOeZvuWIhuavlCkgKi9cbiAgZGF5QnJpZ2h0bmVzczogNzAsXG4gIC8qKiDlpJzpl7TmqKHlvI/kuq7luqYo55m+5YiG5q+UKSAqL1xuICBuaWdodEJyaWdodG5lc3M6IDMwLFxuICAvKiog5aSc6Ze05qih5byP5byA5aeL5pe26Ze0ICovXG4gIG5pZ2h0bW9kZVN0YXJ0VGltZTogJzAtMCcsXG4gIC8qKiDlpJzpl7TmqKHlvI/nu5PmnZ/ml7bpl7QgKi9cbiAgbmlnaHRtb2RlRW5kVGltZTogJzUtMCcsXG4gIC8qKiDlip/og73mm7TmlrDmj5DnpLogKi9cbiAgZnVuY3Rpb25SZXNOb3RpZnk6IHRydWUsXG4gIC8qKiDpobXpnaLmm7TmlrDmj5DnpLogKi9cbiAgcGFnZVJlc05vdGlmeTogdHJ1ZVxufTtcblxuLyoqXG4gKiDkuIvovb1saXN05Lit55qE5a+55bqU6LWE5rqQXG4gKlxuICogQHBhcmFtIGxpc3Qg6ZyA6KaB5LiL6L2955qE6LWE5rqQ5YiX6KGoXG4gKi9cbmNvbnN0IHJlc0Rvd25sb2FkID0gKGxpc3Q6IHN0cmluZ1tdKSA9PiB7XG4gIGxldCBsaXN0ZW5OdW1iZXIgPSBsaXN0Lmxlbmd0aDtcblxuICBsaXN0LmZvckVhY2gobmFtZSA9PiB7XG4gICAgLy8g5LiL6L29emlw5YyFXG4gICAgd3guZG93bmxvYWRGaWxlKHtcbiAgICAgIHVybDogYGh0dHBzOi8vbXAubmVudXlvdXRoLmNvbS8ke25hbWV9LnppcGAsXG4gICAgICBzdWNjZXNzOiByZXMgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhgJHtuYW1lfSBzdGF0dXNDb2RlIGlzICR7cmVzLnN0YXR1c0NvZGV9YCk7Ly8g6LCD6K+VXG4gICAgICAgIGlmIChyZXMuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XG5cbiAgICAgICAgICAvLyDkv53lrZjljovnvKnmlofku7bliLDljovnvKnnm67lvZVcbiAgICAgICAgICAkZmlsZS5zYXZlRmlsZShyZXMudGVtcEZpbGVQYXRoLCBgJHtuYW1lfVppcGApO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBzYXZlICR7bmFtZX0gc3VjY2Vzc2ApOy8vIOiwg+ivlVxuXG4gICAgICAgICAgLy8g6Kej5Y6L5paH5Lu25Yiw5qC555uu5b2VXG4gICAgICAgICAgJGZpbGUudW56aXAoYCR7bmFtZX1aaXBgLCAnJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYHVuemlwICR7bmFtZX0gc3VjZXNzYCk7Ly8g6LCD6K+VXG5cbiAgICAgICAgICAgIC8vIOWIoOmZpOWOi+e8qeebruW9le+8jOW5tuWwhuS4i+i9veaIkOWKn+S/oeaBr+WGmeWFpeWtmOWCqOOAgeWIpOaWreWPlua2iOaPkOekulxuICAgICAgICAgICAgJGZpbGUuRGVsZXRlKGAke25hbWV9WmlwYCwgZmFsc2UpO1xuICAgICAgICAgICAgd3guc2V0U3RvcmFnZVN5bmMoYCR7bmFtZX1Eb3dubG9hZGAsIHRydWUpO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgZGVsZXRlICR7bmFtZX0gc3VjZXNzYCk7Ly8g6LCD6K+VXG5cbiAgICAgICAgICAgIC8vIOaUueWPmOebkeWQrOaVsFxuICAgICAgICAgICAgbGlzdGVuTnVtYmVyLS07XG4gICAgICAgICAgICBpZiAoIWxpc3Rlbk51bWJlcikgd3guaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcblxuICAgICAgLy8g5LiL6L295aSx6LSlXG4gICAgICBmYWlsOiBmYWlsTXNnID0+IHtcbiAgICAgICAgJG15Lm5ldFJlcG9ydCgpO1xuICAgICAgICBjb25zb2xlLmVycm9yKGBkb3dubG9hZCAke25hbWV9IGZhaWw6YCwgZmFpbE1zZyk7XG4gICAgICAgIGxvZ2dlci53YXJuKGDliJ3lp4vljJblsI/nqIvluo/ml7bkuIvovb0ke25hbWV95aSx6LSlYCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufTtcblxuLyoqIOWIneWni+WMluWwj+eoi+W6jyAqL1xuY29uc3QgYXBwSW5pdCA9ICgpID0+IHtcbiAgLy8g5o+Q56S655So5oi35q2j5Zyo5Yid5aeL5YyWXG4gIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICfliJ3lp4vljJbkuK0uLi4nLCBtYXNrOiB0cnVlIH0pO1xuICBjb25zb2xlLmluZm8oJ+WIneasoeWQr+WKqCcpO1xuXG4gIC8vIOiuvue9ruS4u+mimFxuICBpZiAoYXBwT3B0aW9uLnRoZW1lID09PSAnYXV0bycpIHsgLy8g5Li76aKY5Li6YXV0b1xuICAgIGxldCBudW07XG4gICAgbGV0IHRoZW1lO1xuICAgIGNvbnN0IHsgcGxhdGZvcm0gfSA9IHd4LmdldFN5c3RlbUluZm9TeW5jKCk7XG5cbiAgICAvLyDmoLnmja7lubPlj7Dorr7nva7kuLvpophcbiAgICBzd2l0Y2ggKHBsYXRmb3JtKSB7XG4gICAgICBjYXNlICdpT1MnOlxuICAgICAgICB0aGVtZSA9ICdpT1MnO1xuICAgICAgICBudW0gPSAwO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0FuZHJvaWQnOlxuICAgICAgICB0aGVtZSA9ICdBbmRyb2lkJztcbiAgICAgICAgbnVtID0gMTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aGVtZSA9ICdpT1MnO1xuICAgICAgICBudW0gPSAwO1xuICAgIH1cblxuICAgIHd4LnNldFN0b3JhZ2VTeW5jKCd0aGVtZScsIHRoZW1lKTtcbiAgICB3eC5zZXRTdG9yYWdlU3luYygndGhlbWVOdW0nLCBudW0pO1xuXG4gIH0gZWxzZSB7XG4gICAgd3guc2V0U3RvcmFnZVN5bmMoJ3RoZW1lJywgYXBwT3B0aW9uLnRoZW1lKTtcbiAgICB3eC5zZXRTdG9yYWdlU3luYygndGhlbWVOdW0nLCBhcHBPcHRpb24udGhlbWVOdW0pO1xuICB9XG5cbiAgLy8g5YaZ5YWl6aKE6K6+5pWw5o2uXG4gIGZvciAoY29uc3QgZGF0YSBpbiBhcHBPcHRpb24pIGlmIChkYXRhICE9PSAndGhlbWUnKSB3eC5zZXRTdG9yYWdlU3luYyhkYXRhLCBhcHBPcHRpb25bZGF0YV0pO1xuXG4gIC8vIOS4i+i9vei1hOa6kOaWh+S7tuW5tuWGmeWFpeabtOaWsOaXtumXtFxuICBjb25zdCB0aW1lU3RhbXAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcblxuICByZXNEb3dubG9hZChbJ3BhZ2UnLCAnZnVuY3Rpb24nXSk7XG4gIHd4LnNldFN0b3JhZ2VTeW5jKCdwYWdlVXBkYXRlVGltZScsIE1hdGgucm91bmQodGltZVN0YW1wIC8gMTAwMCkpO1xuICB3eC5zZXRTdG9yYWdlU3luYygnZnVuY3Rpb25VcGRhdGVUaW1lJywgTWF0aC5yb3VuZCh0aW1lU3RhbXAgLyAxMDAwKSk7XG5cbiAgLy8g5oiQ5Yqf5Yid5aeL5YyWXG4gIHd4LnNldFN0b3JhZ2VTeW5jKCdpbml0ZWQnLCB0cnVlKTtcbn07XG5cbi8qKlxuICog5by556qX6YCa55+l5qOA5p+lXG4gKlxuICogQHBhcmFtIHZlcnNpb24g5bCP56iL5bqP55qE54mI5pysXG4gKi9cbmNvbnN0IG5vdGljZUNoZWNrID0gKHZlcnNpb246IHN0cmluZykgPT4ge1xuICAvKiog6YCa55+l5YiX6KGo5qC85byPICovXG4gIGludGVyZmFjZSBOb3RpY2VMaXN0IHtcbiAgICBbcHJvcHM6IHN0cmluZ106IHtcbiAgICAgIDA6IHN0cmluZztcbiAgICAgIDE6IHN0cmluZztcbiAgICAgIDI6IG51bWJlcjtcbiAgICAgIDM6IGJvb2xlYW5cbiAgICB9O1xuICB9XG5cbiAgJG15LnJlcXVlc3QoYGNvbmZpZy8ke3ZlcnNpb259L25vdGljZWAsIChub3RpY2VMaXN0OiBOb3RpY2VMaXN0KSA9PiB7XG4gICAgY29uc3QgY2F0ZWdvcnkgPSBPYmplY3Qua2V5cyhub3RpY2VMaXN0KTtcblxuICAgIGNhdGVnb3J5LmZvckVhY2gocGFnZSA9PiB7XG5cbiAgICAgIC8vIOWmguaenOivu+WPluWIsOW8uuWItumAmuefpeiuvue9ru+8jOavj+asoemDveimgemAmuefpe+8jOebtOaOpeWGmeWFpemAmuefpeS/oeaBr1xuICAgICAgaWYgKG5vdGljZUxpc3RbcGFnZV1bM10pIHtcbiAgICAgICAgd3guc2V0U3RvcmFnZVN5bmMoYCR7cGFnZX1ub3RpY2VgLCBbbm90aWNlTGlzdFtwYWdlXVswXSwgbm90aWNlTGlzdFtwYWdlXVsxXV0pO1xuICAgICAgICB3eC5zZXRTdG9yYWdlU3luYyhgJHtwYWdlfU5vdGlmeWAsIHRydWUpO1xuXG4gICAgICAgIC8vIOWmguaenOWcqOe6v+mAmuefpeeJiOacrOWPt+abtOmrmO+8jOWGmeWFpemAmuefpeWGheWuueOAgemAmuefpeaPkOekuuS4jumAmuefpeeJiOacrFxuICAgICAgfSBlbHNlIGlmIChub3RpY2VMaXN0W3BhZ2VdWzJdICE9PSB3eC5nZXRTdG9yYWdlU3luYyhgJHtwYWdlfW5vdGljZVZlcnNpb25gKSkge1xuICAgICAgICB3eC5zZXRTdG9yYWdlU3luYyhgJHtwYWdlfW5vdGljZWAsIFtub3RpY2VMaXN0W3BhZ2VdWzBdLCBub3RpY2VMaXN0W3BhZ2VdWzFdXSk7XG4gICAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKGAke3BhZ2V9bm90aWNlVmVyc2lvbmAsIG5vdGljZUxpc3RbcGFnZV1bMl0pOyAvLyDlhpnlhaVcbiAgICAgICAgd3guc2V0U3RvcmFnZVN5bmMoYCR7cGFnZX1Ob3RpZnlgLCB0cnVlKTsvLyDlhpnlhaVcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIOWmguaenOaJvuWIsEFQUOe6p+mAmuefpe+8jOeri+WNs+aPkOmGklxuICAgIGlmICgnYXBwJyBpbiBjYXRlZ29yeSkgd3guc2hvd01vZGFsKHtcbiAgICAgIHRpdGxlOiBub3RpY2VMaXN0LmFwcFswXSwgY29udGVudDogbm90aWNlTGlzdC5hcHBbMV0sIHNob3dDYW5jZWw6IGZhbHNlLFxuICAgICAgc3VjY2VzczogKCkgPT4gd3gucmVtb3ZlU3RvcmFnZVN5bmMoJ2FwcE5vdGlmeScpXG4gICAgfSk7XG4gIH0sICgpID0+IHsgLy8g6LCD6K+V5L+h5oGvXG4gICAgY29uc29sZS5lcnJvcignR2V0IG5vdGljZUxpc3QgZmFpbCcpO1xuICAgIGxvZ2dlci53YXJuKCdub3RpY2VMaXN0IGVycm9yJywgJ05ldCBFcnJvcicpO1xuICAgIHd4LnJlcG9ydE1vbml0b3IoJzI0JywgMSk7XG4gIH0sICgpID0+IHsgLy8g6LCD6K+V5L+h5oGvXG4gICAgY29uc29sZS5lcnJvcignTm90aWNlTGlzdCBhZGRyZXNzIGVycm9yJyk7XG4gICAgbG9nZ2VyLndhcm4oJ25vdGljZUxpc3QgZXJyb3InLCAnQWRkcmVzcyBFcnJvcicpO1xuICAgIHd4LnJlcG9ydE1vbml0b3IoJzI0JywgMSk7XG4gIH0pO1xufTtcblxuLyoqXG4gKiDmoLnmja7nlKjmiLforr7nva7vvIzliKTmlq3lvZPliY3lsI/nqIvluo/mmK/lkKblupTlkK/nlKjlpJzpl7TmqKHlvI9cbiAqXG4gKiBAcmV0dXJucyDlpJzpl7TmqKHlvI/nirbmgIFcbiAqL1xuZXhwb3J0IGNvbnN0IG5pZ2h0bW9kZSA9ICgpID0+IHtcbiAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gIGNvbnN0IHRpbWUgPSBkYXRlLmdldEhvdXJzKCkgKiAxMDAgKyBkYXRlLmdldE1pbnV0ZXMoKTsgLy8g6I635b6X5b2T5YmN5pe26Ze0XG4gIGNvbnN0IG5pZ2h0TW9kZUNvbmRpdGlvbiA9IHd4LmdldFN0b3JhZ2VTeW5jKCduaWdodG1vZGUnKTtcbiAgY29uc3QgbmlnaHRtb2RlQXV0b0NoYW5nZSA9IHd4LmdldFN0b3JhZ2VTeW5jKCduaWdodG1vZGVBdXRvQ2hhbmdlJyk7IC8vIOiOt+W+l+WknOmXtOaooeW8j+OAgeiHquWKqOW8gOWQr+WknOmXtOaooeW8j+iuvue9rlxuICBjb25zdCBuaWdodEJyaWdodG5lc3MgPSB3eC5nZXRTdG9yYWdlU3luYygnbmlnaHRCcmlnaHRuZXNzJyk7XG4gIGNvbnN0IGRheUJyaWdodG5lc3MgPSB3eC5nZXRTdG9yYWdlU3luYygnZGF5QnJpZ2h0bmVzcycpOyAvLyDojrflvpflpJzpl7TmqKHlvI/kuq7luqbvvIzml6XmuJDmqKHlvI/kuq7luqZcbiAgY29uc3QgbmlnaHRCcmlnaHRuZXNzQ2hhbmdlID0gd3guZ2V0U3RvcmFnZVN5bmMoJ25pZ2h0QnJpZ2h0bmVzc0NoYW5nZScpO1xuICBjb25zdCBkYXlCcmlnaHRuZXNzQ2hhbmdlID0gd3guZ2V0U3RvcmFnZVN5bmMoJ2RheUJyaWdodG5lc3NDaGFuZ2UnKTsgLy8g6I635b6X5pel5aSc6Ze05qih5byP5Lqu5bqm5pS55Y+Y54q25oCBXG4gIGNvbnN0IG5tU3RhcnQgPSB3eC5nZXRTdG9yYWdlU3luYygnbmlnaHRtb2RlU3RhcnRUaW1lJykuc3BsaXQoJy0nKTsgLy8g6I635b6X5aSc6Ze05qih5byP5byA5aeL5pe26Ze0XG4gIGNvbnN0IG5tRW5kID0gd3guZ2V0U3RvcmFnZVN5bmMoJ25pZ2h0bW9kZUVuZFRpbWUnKS5zcGxpdCgnLScpOyAvLyDojrflvpflpJzpl7TmqKHlvI/nu5PmnZ/ml7bpl7RcbiAgY29uc3QgbmlnaHRtb2RlU3RhcnRUaW1lID0gTnVtYmVyKG5tU3RhcnRbMF0pICogMTAwICsgTnVtYmVyKG5tU3RhcnRbMV0pO1xuICBjb25zdCBuaWdodG1vZGVFbmRUaW1lID0gTnVtYmVyKG5tRW5kWzBdKSAqIDEwMCArIE51bWJlcihubUVuZFsxXSk7XG4gIGxldCBjdXJyZW50TmlnaHRNb2RlU3RhdHVzO1xuXG4gIC8vIOWmguaenOW8gOWQr+S6huiHquWKqOWknOmXtOaooeW8j++8jOWIpOaWreaYr+WQpuWQr+eUqOWknOmXtOaooeW8j+WPiuW6lOeUqOS6ruW6plxuICBpZiAobmlnaHRtb2RlQXV0b0NoYW5nZSkge1xuICAgIGN1cnJlbnROaWdodE1vZGVTdGF0dXMgPVxuICAgICAgbmlnaHRtb2RlU3RhcnRUaW1lIDw9IG5pZ2h0bW9kZUVuZFRpbWVcbiAgICAgICAgPyB0aW1lID49IG5pZ2h0bW9kZVN0YXJ0VGltZSAmJiB0aW1lIDw9IG5pZ2h0bW9kZUVuZFRpbWVcbiAgICAgICAgOiAhKHRpbWUgPD0gbmlnaHRtb2RlU3RhcnRUaW1lICYmIHRpbWUgPj0gbmlnaHRtb2RlRW5kVGltZSk7XG5cbiAgICBpZiAoY3VycmVudE5pZ2h0TW9kZVN0YXR1cyAmJiBuaWdodEJyaWdodG5lc3NDaGFuZ2UpIHd4LnNldFNjcmVlbkJyaWdodG5lc3MoeyB2YWx1ZTogbmlnaHRCcmlnaHRuZXNzIC8gMTAwIH0pO1xuICAgIGVsc2UgaWYgKCFjdXJyZW50TmlnaHRNb2RlU3RhdHVzICYmIGRheUJyaWdodG5lc3NDaGFuZ2UpIHd4LnNldFNjcmVlbkJyaWdodG5lc3MoeyB2YWx1ZTogZGF5QnJpZ2h0bmVzcyAvIDEwMCB9KTtcblxuICAgIHd4LnNldFN0b3JhZ2VTeW5jKCduaWdodG1vZGUnLCBjdXJyZW50TmlnaHRNb2RlU3RhdHVzKTtcblxuICAgIC8vIOWQpuWImeafpeeci+WknOmXtOaooeW8j+W8gOWQr+eKtuaAge+8jOW5tuagueaNrueKtuaAgeW6lOeUqOWGs+WumuaYr+WQpuW6lOeUqOS6ruW6plxuICB9IGVsc2Uge1xuICAgIGlmIChuaWdodE1vZGVDb25kaXRpb24gJiYgbmlnaHRCcmlnaHRuZXNzQ2hhbmdlKSB3eC5zZXRTY3JlZW5CcmlnaHRuZXNzKHsgdmFsdWU6IG5pZ2h0QnJpZ2h0bmVzcyAvIDEwMCB9KTtcbiAgICBlbHNlIGlmICghbmlnaHRNb2RlQ29uZGl0aW9uICYmIGRheUJyaWdodG5lc3NDaGFuZ2UpIHd4LnNldFNjcmVlbkJyaWdodG5lc3MoeyB2YWx1ZTogZGF5QnJpZ2h0bmVzcyAvIDEwMCB9KTtcblxuICAgIGN1cnJlbnROaWdodE1vZGVTdGF0dXMgPSBuaWdodE1vZGVDb25kaXRpb247XG4gIH1cblxuICByZXR1cm4gY3VycmVudE5pZ2h0TW9kZVN0YXR1czsvLyDov5Tlm57lpJzpl7TmqKHlvI/nirbmgIFcbn07XG5cbmludGVyZmFjZSBWZXJzaW9uSW5mbyB7XG4gIGZvcmNlVXBkYXRlOiBib29sZWFuO1xuICByZXNldDogYm9vbGVhbjtcbiAgdmVyc2lvbjogc3RyaW5nO1xufVxuXG5cbi8qKlxuICog5qOA5p+l5bCP56iL5bqP5pu05pawXG4gKiBcbiAqIOWmguaenOajgOa1i+WIsOWwj+eoi+W6j+abtOaWsO+8jOiOt+WPluWNh+e6p+eKtuaAge+8iOaWsOeJiOacrOWPt++8jOaYr+WQpueri+WNs+abtOaWsOOAgeaYr+WQpumHjee9ruWwj+eoi+W6j++8ieW5tuWBmuebuOW6lOWkhOeQhlxuICpcbiAqIEBwYXJhbSBsb2NhbFZlcnNpb24g5bCP56iL5bqP55qE5pys5Zyw54mI5pysXG4gKi9cbmNvbnN0IGFwcFVwZGF0ZSA9IChsb2NhbFZlcnNpb246IHN0cmluZykgPT4ge1xuICBjb25zdCB1cGRhdGVNYW5hZ2VyID0gd3guZ2V0VXBkYXRlTWFuYWdlcigpO1xuICBsZXQgdmVyc2lvbjtcbiAgbGV0IGZvcmNlVXBkYXRlID0gdHJ1ZTtcbiAgbGV0IHJlc2V0ID0gZmFsc2U7XG5cbiAgLy8g5qOA5p+l5pu05pawXG4gIHVwZGF0ZU1hbmFnZXIub25DaGVja0ZvclVwZGF0ZShzdGF0dXMgPT4ge1xuXG4gICAgLy8g5om+5Yiw5pu05paw77yM5o+Q56S655So5oi36I635Y+W5Yiw5pu05pawXG4gICAgaWYgKHN0YXR1cy5oYXNVcGRhdGUpICRteS50aXAoJ+WPkeeOsOWwj+eoi+W6j+abtOaWsO+8jOS4i+i9veS4rS4uLicpO1xuICB9KTtcblxuICB1cGRhdGVNYW5hZ2VyLm9uVXBkYXRlUmVhZHkoKCkgPT4ge1xuXG4gICAgLy8g6K+35rGC6YWN572u5paH5Lu2XG4gICAgJG15LnJlcXVlc3QoYGNvbmZpZy8ke2xvY2FsVmVyc2lvbn0vY29uZmlnYCwgZGF0YSA9PiB7XG4gICAgICAoeyBmb3JjZVVwZGF0ZSwgcmVzZXQsIHZlcnNpb24gfSA9IGRhdGEgYXMgVmVyc2lvbkluZm8pO1xuXG4gICAgICAvLyDmm7TmlrDkuIvovb3lsLHnu6rvvIzmj5DnpLrnlKjmiLfph43mlrDlkK/liqhcbiAgICAgIGlmIChmb3JjZVVwZGF0ZSlcbiAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICB0aXRsZTogJ+W3suaJvuWIsOaWsOeJiOacrCcsXG4gICAgICAgICAgY29udGVudDogYOaWsOeJiOacrCR7dmVyc2lvbn3lt7LkuIvovb3vvIzor7fph43lkK/lupTnlKjmm7TmlrDjgIIkeyhyZXNldCA/ICfor6XniYjmnKzkvJrliJ3lp4vljJblsI/nqIvluo/jgIInIDogJycpfWAsXG4gICAgICAgICAgc2hvd0NhbmNlbDogIXJlc2V0LCBjb25maXJtVGV4dDogJ+W6lOeUqCcsIGNhbmNlbFRleHQ6ICflj5bmtognLFxuICAgICAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XG4gICAgICAgICAgICAvLyDnlKjmiLfnoa7orqTvvIzlupTnlKjmm7TmlrBcbiAgICAgICAgICAgIGlmIChyZXMuY29uZmlybSkge1xuXG4gICAgICAgICAgICAgIC8vIOmcgOimgeWIneWni+WMllxuICAgICAgICAgICAgICBpZiAocmVzZXQpIHtcbiAgICAgICAgICAgICAgICAvLyDmmL7npLrmj5DnpLpcbiAgICAgICAgICAgICAgICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiAn5Yid5aeL5YyW5LitJywgbWFzazogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgICAgIC8vIOa4hemZpOaWh+S7tuezu+e7n+aWh+S7tuS4juaVsOaNruWtmOWCqFxuICAgICAgICAgICAgICAgICRmaWxlLmxpc3RGaWxlKCcnKS5mb3JFYWNoKGZpbGVQYXRoID0+IHtcbiAgICAgICAgICAgICAgICAgICRmaWxlLkRlbGV0ZShmaWxlUGF0aCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgd3guY2xlYXJTdG9yYWdlU3luYygpO1xuXG4gICAgICAgICAgICAgICAgLy8g6ZqQ6JeP5o+Q56S6XG4gICAgICAgICAgICAgICAgd3guaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8vIOW6lOeUqOabtOaWsFxuICAgICAgICAgICAgICB1cGRhdGVNYW5hZ2VyLmFwcGx5VXBkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8g5pu05paw5LiL6L295aSx6LSlXG4gIHVwZGF0ZU1hbmFnZXIub25VcGRhdGVGYWlsZWQoKCkgPT4ge1xuXG4gICAgLy8g5o+Q56S655So5oi3572R57uc5Ye6546w6Zeu6aKYXG4gICAgJG15LnRpcCgn5bCP56iL5bqP5pu05paw5LiL6L295aSx6LSl77yM6K+35qOA5p+l5oKo55qE572R57uc77yBJyk7XG5cbiAgICAvLyDosIPor5VcbiAgICBjb25zb2xlLndhcm4oJ1VwZGF0ZSBmYWlsdXJlJyk7XG4gICAgd3gucmVwb3J0TW9uaXRvcignMjMnLCAxKTtcbiAgICBsb2dnZXIud2FybignVXBhdGUgQXBwIGVycm9yIGJlY2F1c2Ugb2YgTmV0IEVycm9yJyk7XG5cbiAgfSk7XG59O1xuXG4vKipcbiAqIOWwj+eoi+W6j+WQr+WKqOaXtueahOi/kOihjOWHveaVsFxuICogXG4gKiDotJ/otKPmo4Dmn6XpgJrnn6XkuI7lsI/nqIvluo/mm7TmlrDvvIzms6jlhoznvZHnu5zjgIHlhoXlrZjjgIHmiKrlsY/nmoTnm5HlkKxcbiAqXG4gKiBAcGFyYW0gdmVyc2lvbiDlsI/nqIvluo/nmoTniYjmnKxcbiAqL1xuY29uc3Qgc3RhcnR1cCA9ICh2ZXJzaW9uOiBzdHJpbmcpID0+IHtcbiAgLy8g5qOA5p+l6YCa55+l5pu05paw5LiO5bCP56iL5bqP5pu05pawXG4gIG5vdGljZUNoZWNrKHZlcnNpb24pO1xuICBhcHBVcGRhdGUodmVyc2lvbik7XG5cbiAgLy8g6K6+572u5YaF5a2Y5LiN6Laz6K2m5ZGKXG4gIHd4Lm9uTWVtb3J5V2FybmluZyhyZXMgPT4ge1xuICAgICRteS50aXAoJ+WGheWtmOS4jei2sycpO1xuICAgIGNvbnNvbGUud2Fybignb25NZW1vcnlXYXJuaW5nUmVjZWl2ZScpO1xuICAgIHd4LnJlcG9ydEFuYWx5dGljcygnbWVtb3J5X3dhcm5pbmcnLCB7XG4gICAgICBtZW1vcnlfd2FybmluZzogcmVzICYmIHJlcy5sZXZlbCA/IHJlcy5sZXZlbCA6IDAsXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIOiOt+WPlue9kee7nOS/oeaBr1xuICB3eC5nZXROZXR3b3JrVHlwZSh7XG4gICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgIGNvbnN0IHsgbmV0d29ya1R5cGUgfSA9IHJlcztcblxuICAgICAgaWYgKG5ldHdvcmtUeXBlID09PSAnbm9uZScgfHwgbmV0d29ya1R5cGUgPT09ICd1bmtub3duJykgJG15LnRpcCgn5oKo55qE572R57uc54q25oCB5LiN5L2zJyk7XG4gICAgfVxuICB9KTtcblxuICAvLyDnm5HlkKznvZHnu5znirbmgIFcbiAgd3gub25OZXR3b3JrU3RhdHVzQ2hhbmdlKHJlcyA9PiB7XG5cbiAgICAvLyDmmL7npLrmj5DnpLpcbiAgICBpZiAoIXJlcy5pc0Nvbm5lY3RlZCkge1xuICAgICAgJG15LnRpcCgn572R57uc6L+e5o6l5Lit5patLOmDqOWIhuWwj+eoi+W6j+WKn+iDveaaguS4jeWPr+eUqCcpO1xuICAgICAgd3guc2V0U3RvcmFnZVN5bmMoJ25ldHdvcmtFcnJvcicsIHRydWUpO1xuICAgIH0gZWxzZSBpZiAod3guZ2V0U3RvcmFnZVN5bmMoJ25ldHdvcmsnKSkge1xuICAgICAgd3guc2V0U3RvcmFnZVN5bmMoJ25ldHdvcmtFcnJvcicsIGZhbHNlKTtcbiAgICAgICRteS50aXAoJ+e9kee7nOmTvuaOpeaBouWkjScpO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8g55uR5ZCs55So5oi35oiq5bGPXG4gIHd4Lm9uVXNlckNhcHR1cmVTY3JlZW4oKCkgPT4ge1xuICAgICRteS50aXAoJ+aCqOWPr+S7peeCueWHu+WPs+S4iuinkuKAlOKAlOi9rOWPkeaIlueCueWHu+mhtemdouWPs+S4i+inkuKAlOKAlOS/neWtmOS6jOe7tOeggeWIhuS6q+Wwj+eoi+W6jycpO1xuICB9KTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHsgYXBwSW5pdCwgYXBwVXBkYXRlLCBuaWdodG1vZGUsIG5vdGljZUNoZWNrLCBzdGFydHVwIH07XG4iXX0=